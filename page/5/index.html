<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>é“ - è‡ªç„¶ ğŸƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="ç”Ÿæ´»ç‚¹æ»´å’ŒçŸ¥è¯†åˆ†äº«">
<meta property="og:type" content="website">
<meta property="og:title" content="é“ - è‡ªç„¶ ğŸƒ">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="é“ - è‡ªç„¶ ğŸƒ">
<meta property="og:description" content="ç”Ÿæ´»ç‚¹æ»´å’ŒçŸ¥è¯†åˆ†äº«">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ä¸‡æ¾">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="é“ - è‡ªç„¶ ğŸƒ" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/head/photo2.jpeg">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">é“ - è‡ªç„¶ ğŸƒ</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="detail-JAVAå¤šçº¿ç¨‹ä¹‹ExecutorService" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutorService/" class="article-date">
  <time class="dt-published" datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutorService/">Java thread å¤šçº¿ç¨‹ ExecutorService</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutorService/" data-id="cl7mgnxtu000xt2zads544njd" data-title="Java thread å¤šçº¿ç¨‹ ExecutorService" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutorService/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutorService/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-JAVAå¤šçº¿ç¨‹ä¹‹Executors" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutors/" class="article-date">
  <time class="dt-published" datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutors/">å¤šçº¿ç¨‹ Executors</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutors/" data-id="cl7mgnxtu0011t2za39dz7pfr" data-title="å¤šçº¿ç¨‹ Executors" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutors/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BExecutors/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-JAVAå¤šçº¿ç¨‹ä¹‹ThreadPoolExecutor" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadPoolExecutor/" class="article-date">
  <time class="dt-published" datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadPoolExecutor/">ThreadPoolExecutor æºç åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Written by Doug Lea with assistance from members of JCP JSR-166</span></span><br><span class="line"><span class="comment"> * Expert Group and released to the public domain, as explained at</span></span><br><span class="line"><span class="comment"> * http://creativecommons.org/publicdomain/zero/1.0/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util.concurrent;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.AbstractQueuedSynchronizer;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *ä¸€ä¸ªExecutorServiceæ‰§è¡Œæ¯ä¸ªè¢«æäº¤å…¥åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ï¼Œé€šè¿‡Executorså·¥å‚æ–¹æ³•è¿›è¡Œé…ç½®ã€‚</span></span><br><span class="line"><span class="comment"> *çº¿ç¨‹æ± å¤„ç†ä¸¤ç§ä¸åŒçš„é—®é¢˜ï¼šé€šè¿‡å‡å°‘æ¯ä¸ªä»»åŠ¡è°ƒç”¨çš„å¼€é”€ã€æä¾›è¾¹ç•Œå’Œèµ„æºç®¡ç†ï¼ŒåŒ…æ‹¬çº¿ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment"> *ä»»åŠ¡é›†åˆçš„æ‰§è¡Œï¼Œä»è€Œæ”¹è¿›äº†æ‰§è¡Œå¤§é‡å¼‚æ­¥ä»»åŠ¡æ—¶çš„æ€§èƒ½é—®é¢˜ã€‚ThreadPoolExcecutorä¹Ÿç»´æŠ¤ç€ä¸€</span></span><br><span class="line"><span class="comment"> *äº›ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°ç›®ã€‚</span></span><br><span class="line"><span class="comment"> *é¢å¯¹ä¸€ä¸ªæä¾›äº†è®¸å¤šå¯è°ƒç”¨å‚æ•°å’Œå¯æ‰©å±•æ€§çš„hooks.ç¨‹åºå‘˜é€šå¸¸æ¯”è¾ƒå–œæ¬¢ç”¨Executorsçš„å·¥å‚æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> *å¦‚Executors.newCachedThreadPool(æ— é™å¤§å°çš„çº¿ç¨‹æ± ï¼Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶)ã€Executors.newFixedThreadPool</span></span><br><span class="line"><span class="comment"> *(å›ºå®šå¤§å°çš„çº¿ç¨‹æ± )ã€Executors.newSingleThreadExecutor(å•ä¸ªåå°çº¿ç¨‹)ï¼Œä¸ºæœ€å¸¸ç”¨çš„åœº</span></span><br><span class="line"><span class="comment"> *æ™¯è¿›è¡Œé¢„é…ç½®ã€‚æˆ–è€…ï¼Œä½¿ç”¨è¿™ä¸ªç±»è¿›è¡Œæ‰‹åŠ¨é…ç½®å®ç°åŒæ ·çš„æ•ˆæœçš„çº¿ç¨‹æ± ï¼Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ ¸å¿ƒå’Œæœ€å¤§çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ThreadPoolExecutorä¼šæ ¹æ®çº¿ç¨‹æ± çš„å¤§å°é…ç½®corePoolSizeå’ŒmaximumPoolSizeæ¥è‡ªåŠ¨è°ƒæ•´æ± çš„å¤§å°ï¼Œ</span></span><br><span class="line"><span class="comment"> *å¯ä»¥é€šè¿‡getPoolSizeæŸ¥çœ‹æ± çš„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * When a new task is submitted in method &#123;<span class="doctag">@link</span> #execute(Runnable)&#125;,</span></span><br><span class="line"><span class="comment"> * and fewer than corePoolSize threads are running, a new thread is</span></span><br><span class="line"><span class="comment"> * created to handle the request, even if other worker threads are</span></span><br><span class="line"><span class="comment"> * idle.  If there are more than corePoolSize but less than</span></span><br><span class="line"><span class="comment"> * maximumPoolSize threads running, a new thread will be created only</span></span><br><span class="line"><span class="comment"> * if the queue is full.  By setting corePoolSize and maximumPoolSize</span></span><br><span class="line"><span class="comment"> * the same, you create a fixed-size thread pool. By setting</span></span><br><span class="line"><span class="comment"> * maximumPoolSize to an essentially unbounded value such as &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * Integer.MAX_VALUE&#125;, you allow the pool to accommodate an arbitrary</span></span><br><span class="line"><span class="comment"> * number of concurrent tasks. Most typically, core and maximum pool</span></span><br><span class="line"><span class="comment"> * sizes are set only upon construction, but they may also be changed</span></span><br><span class="line"><span class="comment"> * dynamically using &#123;<span class="doctag">@link</span> #setCorePoolSize&#125; and &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * #setMaximumPoolSize&#125;. &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;On-demand construction&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;By default, even core threads are initially created and</span></span><br><span class="line"><span class="comment"> * started only when new tasks arrive, but this can be overridden</span></span><br><span class="line"><span class="comment"> * dynamically using method &#123;<span class="doctag">@link</span> #prestartCoreThread&#125; or &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * #prestartAllCoreThreads&#125;.  You probably want to prestart threads if</span></span><br><span class="line"><span class="comment"> * you construct the pool with a non-empty queue. &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Creating new threads&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;New threads are created using a &#123;<span class="doctag">@link</span> ThreadFactory&#125;.  If not</span></span><br><span class="line"><span class="comment"> * otherwise specified, a &#123;<span class="doctag">@link</span> Executors#defaultThreadFactory&#125; is</span></span><br><span class="line"><span class="comment"> * used, that creates threads to all be in the same &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * ThreadGroup&#125; and with the same &#123;<span class="doctag">@code</span> NORM_PRIORITY&#125; priority and</span></span><br><span class="line"><span class="comment"> * non-daemon status. By supplying a different ThreadFactory, you can</span></span><br><span class="line"><span class="comment"> * alter the thread&#x27;s name, thread group, priority, daemon status,</span></span><br><span class="line"><span class="comment"> * etc. If a &#123;<span class="doctag">@code</span> ThreadFactory&#125; fails to create a thread when asked</span></span><br><span class="line"><span class="comment"> * by returning null from &#123;<span class="doctag">@code</span> newThread&#125;, the executor will</span></span><br><span class="line"><span class="comment"> * continue, but might not be able to execute any tasks. Threads</span></span><br><span class="line"><span class="comment"> * should possess the &quot;modifyThread&quot; &#123;<span class="doctag">@code</span> RuntimePermission&#125;. If</span></span><br><span class="line"><span class="comment"> * worker threads or other threads using the pool do not possess this</span></span><br><span class="line"><span class="comment"> * permission, service may be degraded: configuration changes may not</span></span><br><span class="line"><span class="comment"> * take effect in a timely manner, and a shutdown pool may remain in a</span></span><br><span class="line"><span class="comment"> * state in which termination is possible but not completed.&lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Keep-alive times&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;If the pool currently has more than corePoolSize threads,</span></span><br><span class="line"><span class="comment"> * excess threads will be terminated if they have been idle for more</span></span><br><span class="line"><span class="comment"> * than the keepAliveTime (see &#123;<span class="doctag">@link</span> #getKeepAliveTime(TimeUnit)&#125;).</span></span><br><span class="line"><span class="comment"> * This provides a means of reducing resource consumption when the</span></span><br><span class="line"><span class="comment"> * pool is not being actively used. If the pool becomes more active</span></span><br><span class="line"><span class="comment"> * later, new threads will be constructed. This parameter can also be</span></span><br><span class="line"><span class="comment"> * changed dynamically using method &#123;<span class="doctag">@link</span> #setKeepAliveTime(long,</span></span><br><span class="line"><span class="comment"> * TimeUnit)&#125;.  Using a value of &#123;<span class="doctag">@code</span> Long.MAX_VALUE&#125; &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * TimeUnit#NANOSECONDS&#125; effectively disables idle threads from ever</span></span><br><span class="line"><span class="comment"> * terminating prior to shut down. By default, the keep-alive policy</span></span><br><span class="line"><span class="comment"> * applies only when there are more than corePoolSize threads. But</span></span><br><span class="line"><span class="comment"> * method &#123;<span class="doctag">@link</span> #allowCoreThreadTimeOut(boolean)&#125; can be used to</span></span><br><span class="line"><span class="comment"> * apply this time-out policy to core threads as well, so long as the</span></span><br><span class="line"><span class="comment"> * keepAliveTime value is non-zero. &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Queuing&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;Any &#123;<span class="doctag">@link</span> BlockingQueue&#125; may be used to transfer and hold</span></span><br><span class="line"><span class="comment"> * submitted tasks.  The use of this queue interacts with pool sizing:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; If fewer than corePoolSize threads are running, the Executor</span></span><br><span class="line"><span class="comment"> * always prefers adding a new thread</span></span><br><span class="line"><span class="comment"> * rather than queuing.&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; If corePoolSize or more threads are running, the Executor</span></span><br><span class="line"><span class="comment"> * always prefers queuing a request rather than adding a new</span></span><br><span class="line"><span class="comment"> * thread.&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; If a request cannot be queued, a new thread is created unless</span></span><br><span class="line"><span class="comment"> * this would exceed maximumPoolSize, in which case, the task will be</span></span><br><span class="line"><span class="comment"> * rejected.&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * There are three general strategies for queuing:</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; &lt;em&gt; Direct handoffs.&lt;/em&gt; A good default choice for a work</span></span><br><span class="line"><span class="comment"> * queue is a &#123;<span class="doctag">@link</span> SynchronousQueue&#125; that hands off tasks to threads</span></span><br><span class="line"><span class="comment"> * without otherwise holding them. Here, an attempt to queue a task</span></span><br><span class="line"><span class="comment"> * will fail if no threads are immediately available to run it, so a</span></span><br><span class="line"><span class="comment"> * new thread will be constructed. This policy avoids lockups when</span></span><br><span class="line"><span class="comment"> * handling sets of requests that might have internal dependencies.</span></span><br><span class="line"><span class="comment"> * Direct handoffs generally require unbounded maximumPoolSizes to</span></span><br><span class="line"><span class="comment"> * avoid rejection of new submitted tasks. This in turn admits the</span></span><br><span class="line"><span class="comment"> * possibility of unbounded thread growth when commands continue to</span></span><br><span class="line"><span class="comment"> * arrive on average faster than they can be processed.  &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&lt;em&gt; Unbounded queues.&lt;/em&gt; Using an unbounded queue (for</span></span><br><span class="line"><span class="comment"> * example a &#123;<span class="doctag">@link</span> LinkedBlockingQueue&#125; without a predefined</span></span><br><span class="line"><span class="comment"> * capacity) will cause new tasks to wait in the queue when all</span></span><br><span class="line"><span class="comment"> * corePoolSize threads are busy. Thus, no more than corePoolSize</span></span><br><span class="line"><span class="comment"> * threads will ever be created. (And the value of the maximumPoolSize</span></span><br><span class="line"><span class="comment"> * therefore doesn&#x27;t have any effect.)  This may be appropriate when</span></span><br><span class="line"><span class="comment"> * each task is completely independent of others, so tasks cannot</span></span><br><span class="line"><span class="comment"> * affect each others execution; for example, in a web page server.</span></span><br><span class="line"><span class="comment"> * While this style of queuing can be useful in smoothing out</span></span><br><span class="line"><span class="comment"> * transient bursts of requests, it admits the possibility of</span></span><br><span class="line"><span class="comment"> * unbounded work queue growth when commands continue to arrive on</span></span><br><span class="line"><span class="comment"> * average faster than they can be processed.  &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&lt;em&gt;Bounded queues.&lt;/em&gt; A bounded queue (for example, an</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ArrayBlockingQueue&#125;) helps prevent resource exhaustion when</span></span><br><span class="line"><span class="comment"> * used with finite maximumPoolSizes, but can be more difficult to</span></span><br><span class="line"><span class="comment"> * tune and control.  Queue sizes and maximum pool sizes may be traded</span></span><br><span class="line"><span class="comment"> * off for each other: Using large queues and small pools minimizes</span></span><br><span class="line"><span class="comment"> * CPU usage, OS resources, and context-switching overhead, but can</span></span><br><span class="line"><span class="comment"> * lead to artificially low throughput.  If tasks frequently block (for</span></span><br><span class="line"><span class="comment"> * example if they are I/O bound), a system may be able to schedule</span></span><br><span class="line"><span class="comment"> * time for more threads than you otherwise allow. Use of small queues</span></span><br><span class="line"><span class="comment"> * generally requires larger pool sizes, which keeps CPUs busier but</span></span><br><span class="line"><span class="comment"> * may encounter unacceptable scheduling overhead, which also</span></span><br><span class="line"><span class="comment"> * decreases throughput.  &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Rejected tasks&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;New tasks submitted in method &#123;<span class="doctag">@link</span> #execute(Runnable)&#125; will be</span></span><br><span class="line"><span class="comment"> * &lt;em&gt;rejected&lt;/em&gt; when the Executor has been shut down, and also when</span></span><br><span class="line"><span class="comment"> * the Executor uses finite bounds for both maximum threads and work queue</span></span><br><span class="line"><span class="comment"> * capacity, and is saturated.  In either case, the &#123;<span class="doctag">@code</span> execute&#125; method</span></span><br><span class="line"><span class="comment"> * invokes the &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * RejectedExecutionHandler#rejectedExecution(Runnable, ThreadPoolExecutor)&#125;</span></span><br><span class="line"><span class="comment"> * method of its &#123;<span class="doctag">@link</span> RejectedExecutionHandler&#125;.  Four predefined handler</span></span><br><span class="line"><span class="comment"> * policies are provided:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; In the default &#123;<span class="doctag">@link</span> ThreadPoolExecutor.AbortPolicy&#125;, the</span></span><br><span class="line"><span class="comment"> * handler throws a runtime &#123;<span class="doctag">@link</span> RejectedExecutionException&#125; upon</span></span><br><span class="line"><span class="comment"> * rejection. &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; In &#123;<span class="doctag">@link</span> ThreadPoolExecutor.CallerRunsPolicy&#125;, the thread</span></span><br><span class="line"><span class="comment"> * that invokes &#123;<span class="doctag">@code</span> execute&#125; itself runs the task. This provides a</span></span><br><span class="line"><span class="comment"> * simple feedback control mechanism that will slow down the rate that</span></span><br><span class="line"><span class="comment"> * new tasks are submitted. &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt; In &#123;<span class="doctag">@link</span> ThreadPoolExecutor.DiscardPolicy&#125;, a task that</span></span><br><span class="line"><span class="comment"> * cannot be executed is simply dropped.  &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;In &#123;<span class="doctag">@link</span> ThreadPoolExecutor.DiscardOldestPolicy&#125;, if the</span></span><br><span class="line"><span class="comment"> * executor is not shut down, the task at the head of the work queue</span></span><br><span class="line"><span class="comment"> * is dropped, and then execution is retried (which can fail again,</span></span><br><span class="line"><span class="comment"> * causing this to be repeated.) &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It is possible to define and use other kinds of &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * RejectedExecutionHandler&#125; classes. Doing so requires some care</span></span><br><span class="line"><span class="comment"> * especially when policies are designed to work only under particular</span></span><br><span class="line"><span class="comment"> * capacity or queuing policies. &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Hook methods&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;This class provides &#123;<span class="doctag">@code</span> protected&#125; overridable</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #beforeExecute(Thread, Runnable)&#125; and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #afterExecute(Runnable, Throwable)&#125; methods that are called</span></span><br><span class="line"><span class="comment"> * before and after execution of each task.  These can be used to</span></span><br><span class="line"><span class="comment"> * manipulate the execution environment; for example, reinitializing</span></span><br><span class="line"><span class="comment"> * ThreadLocals, gathering statistics, or adding log entries.</span></span><br><span class="line"><span class="comment"> * Additionally, method &#123;<span class="doctag">@link</span> #terminated&#125; can be overridden to perform</span></span><br><span class="line"><span class="comment"> * any special processing that needs to be done once the Executor has</span></span><br><span class="line"><span class="comment"> * fully terminated.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If hook or callback methods throw exceptions, internal worker</span></span><br><span class="line"><span class="comment"> * threads may in turn fail and abruptly terminate.&lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Queue maintenance&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;Method &#123;<span class="doctag">@link</span> #getQueue()&#125; allows access to the work queue</span></span><br><span class="line"><span class="comment"> * for purposes of monitoring and debugging.  Use of this method for</span></span><br><span class="line"><span class="comment"> * any other purpose is strongly discouraged.  Two supplied methods,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #remove(Runnable)&#125; and &#123;<span class="doctag">@link</span> #purge&#125; are available to</span></span><br><span class="line"><span class="comment"> * assist in storage reclamation when large numbers of queued tasks</span></span><br><span class="line"><span class="comment"> * become cancelled.&lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dt&gt;Finalization&lt;/dt&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;dd&gt;A pool that is no longer referenced in a program &lt;em&gt;AND&lt;/em&gt;</span></span><br><span class="line"><span class="comment"> * has no remaining threads will be &#123;<span class="doctag">@code</span> shutdown&#125; automatically. If</span></span><br><span class="line"><span class="comment"> * you would like to ensure that unreferenced pools are reclaimed even</span></span><br><span class="line"><span class="comment"> * if users forget to call &#123;<span class="doctag">@link</span> #shutdown&#125;, then you must arrange</span></span><br><span class="line"><span class="comment"> * that unused threads eventually die, by setting appropriate</span></span><br><span class="line"><span class="comment"> * keep-alive times, using a lower bound of zero core threads and/or</span></span><br><span class="line"><span class="comment"> * setting &#123;<span class="doctag">@link</span> #allowCoreThreadTimeOut(boolean)&#125;.  &lt;/dd&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/dl&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;Extension example&lt;/b&gt;. Most extensions of this class</span></span><br><span class="line"><span class="comment"> * override one or more of the protected hook methods. For example,</span></span><br><span class="line"><span class="comment"> * here is a subclass that adds a simple pause/resume feature:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * class PausableThreadPoolExecutor extends ThreadPoolExecutor &#123;</span></span><br><span class="line"><span class="comment"> *   private boolean isPaused;</span></span><br><span class="line"><span class="comment"> *   private ReentrantLock pauseLock = new ReentrantLock();</span></span><br><span class="line"><span class="comment"> *   private Condition unpaused = pauseLock.newCondition();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public PausableThreadPoolExecutor(...) &#123; super(...); &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   protected void beforeExecute(Thread t, Runnable r) &#123;</span></span><br><span class="line"><span class="comment"> *     super.beforeExecute(t, r);</span></span><br><span class="line"><span class="comment"> *     pauseLock.lock();</span></span><br><span class="line"><span class="comment"> *     try &#123;</span></span><br><span class="line"><span class="comment"> *       while (isPaused) unpaused.await();</span></span><br><span class="line"><span class="comment"> *     &#125; catch (InterruptedException ie) &#123;</span></span><br><span class="line"><span class="comment"> *       t.interrupt();</span></span><br><span class="line"><span class="comment"> *     &#125; finally &#123;</span></span><br><span class="line"><span class="comment"> *       pauseLock.unlock();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public void pause() &#123;</span></span><br><span class="line"><span class="comment"> *     pauseLock.lock();</span></span><br><span class="line"><span class="comment"> *     try &#123;</span></span><br><span class="line"><span class="comment"> *       isPaused = true;</span></span><br><span class="line"><span class="comment"> *     &#125; finally &#123;</span></span><br><span class="line"><span class="comment"> *       pauseLock.unlock();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public void resume() &#123;</span></span><br><span class="line"><span class="comment"> *     pauseLock.lock();</span></span><br><span class="line"><span class="comment"> *     try &#123;</span></span><br><span class="line"><span class="comment"> *       isPaused = false;</span></span><br><span class="line"><span class="comment"> *       unpaused.signalAll();</span></span><br><span class="line"><span class="comment"> *     &#125; finally &#123;</span></span><br><span class="line"><span class="comment"> *       pauseLock.unlock();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractExecutorService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The main pool control state, ctl, is an atomic integer packing</span></span><br><span class="line"><span class="comment">     * two conceptual fields</span></span><br><span class="line"><span class="comment">     *   workerCount, indicating the effective number of threads</span></span><br><span class="line"><span class="comment">     *   runState,    indicating whether running, shutting down etc</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * In order to pack them into one int, we limit workerCount to</span></span><br><span class="line"><span class="comment">     * (2^29)-1 (about 500 million) threads rather than (2^31)-1 (2</span></span><br><span class="line"><span class="comment">     * billion) otherwise representable. If this is ever an issue in</span></span><br><span class="line"><span class="comment">     * the future, the variable can be changed to be an AtomicLong,</span></span><br><span class="line"><span class="comment">     * and the shift/mask constants below adjusted. But until the need</span></span><br><span class="line"><span class="comment">     * arises, this code is a bit faster and simpler using an int.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The workerCount is the number of workers that have been</span></span><br><span class="line"><span class="comment">     * permitted to start and not permitted to stop.  The value may be</span></span><br><span class="line"><span class="comment">     * transiently different from the actual number of live threads,</span></span><br><span class="line"><span class="comment">     * for example when a ThreadFactory fails to create a thread when</span></span><br><span class="line"><span class="comment">     * asked, and when exiting threads are still performing</span></span><br><span class="line"><span class="comment">     * bookkeeping before terminating. The user-visible pool size is</span></span><br><span class="line"><span class="comment">     * reported as the current size of the workers set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The runState provides the main lifecycle control, taking on values:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *   RUNNING:  Accept new tasks and process queued tasks</span></span><br><span class="line"><span class="comment">     *   SHUTDOWN: Don&#x27;t accept new tasks, but process queued tasks</span></span><br><span class="line"><span class="comment">     *   STOP:     Don&#x27;t accept new tasks, don&#x27;t process queued tasks,</span></span><br><span class="line"><span class="comment">     *             and interrupt in-progress tasks</span></span><br><span class="line"><span class="comment">     *   TIDYING:  All tasks have terminated, workerCount is zero,</span></span><br><span class="line"><span class="comment">     *             the thread transitioning to state TIDYING</span></span><br><span class="line"><span class="comment">     *             will run the terminated() hook method</span></span><br><span class="line"><span class="comment">     *   TERMINATED: terminated() has completed</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The numerical order among these values matters, to allow</span></span><br><span class="line"><span class="comment">     * ordered comparisons. The runState monotonically increases over</span></span><br><span class="line"><span class="comment">     * time, but need not hit each state. The transitions are:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * RUNNING -&gt; SHUTDOWN</span></span><br><span class="line"><span class="comment">     *    On invocation of shutdown(), perhaps implicitly in finalize()</span></span><br><span class="line"><span class="comment">     * (RUNNING or SHUTDOWN) -&gt; STOP</span></span><br><span class="line"><span class="comment">     *    On invocation of shutdownNow()</span></span><br><span class="line"><span class="comment">     * SHUTDOWN -&gt; TIDYING</span></span><br><span class="line"><span class="comment">     *    When both queue and pool are empty</span></span><br><span class="line"><span class="comment">     * STOP -&gt; TIDYING</span></span><br><span class="line"><span class="comment">     *    When pool is empty</span></span><br><span class="line"><span class="comment">     * TIDYING -&gt; TERMINATED</span></span><br><span class="line"><span class="comment">     *    When the terminated() hook method has completed</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Threads waiting in awaitTermination() will return when the</span></span><br><span class="line"><span class="comment">     * state reaches TERMINATED.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Detecting the transition from SHUTDOWN to TIDYING is less</span></span><br><span class="line"><span class="comment">     * straightforward than you&#x27;d like because the queue may become</span></span><br><span class="line"><span class="comment">     * empty after non-empty and vice versa during SHUTDOWN state, but</span></span><br><span class="line"><span class="comment">     * we can only terminate if, after seeing that it is empty, we see</span></span><br><span class="line"><span class="comment">     * that workerCount is 0 (which sometimes entails a recheck -- see</span></span><br><span class="line"><span class="comment">     * below).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAPACITY   = (<span class="number">1</span> &lt;&lt; COUNT_BITS) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// runState is stored in the high-order bits</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING    = -<span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN   =  <span class="number">0</span> &lt;&lt; COUNT_BITS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP       =  <span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING    =  <span class="number">2</span> &lt;&lt; COUNT_BITS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED =  <span class="number">3</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Packing and unpacking ctl</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">runStateOf</span><span class="params">(<span class="keyword">int</span> c)</span>     </span>&#123; <span class="keyword">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">workerCountOf</span><span class="params">(<span class="keyword">int</span> c)</span>  </span>&#123; <span class="keyword">return</span> c &amp; CAPACITY; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">ctlOf</span><span class="params">(<span class="keyword">int</span> rs, <span class="keyword">int</span> wc)</span> </span>&#123; <span class="keyword">return</span> rs | wc; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Bit field accessors that don&#x27;t require unpacking ctl.</span></span><br><span class="line"><span class="comment">     * These depend on the bit layout and on workerCount being never negative.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">runStateLessThan</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c &lt; s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">runStateAtLeast</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c &gt;= s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isRunning</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c &lt; SHUTDOWN;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Attempts to CAS-increment the workerCount field of ctl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">compareAndIncrementWorkerCount</span><span class="params">(<span class="keyword">int</span> expect)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ctl.compareAndSet(expect, expect + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Attempts to CAS-decrement the workerCount field of ctl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">compareAndDecrementWorkerCount</span><span class="params">(<span class="keyword">int</span> expect)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ctl.compareAndSet(expect, expect - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Decrements the workerCount field of ctl. This is called only on</span></span><br><span class="line"><span class="comment">     * abrupt termination of a thread (see processWorkerExit). Other</span></span><br><span class="line"><span class="comment">     * decrements are performed within getTask.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">decrementWorkerCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (! compareAndDecrementWorkerCount(ctl.get()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The queue used for holding tasks and handing off to worker</span></span><br><span class="line"><span class="comment">     * threads.  We do not require that workQueue.poll() returning</span></span><br><span class="line"><span class="comment">     * null necessarily means that workQueue.isEmpty(), so rely</span></span><br><span class="line"><span class="comment">     * solely on isEmpty to see if the queue is empty (which we must</span></span><br><span class="line"><span class="comment">     * do for example when deciding whether to transition from</span></span><br><span class="line"><span class="comment">     * SHUTDOWN to TIDYING).  This accommodates special-purpose</span></span><br><span class="line"><span class="comment">     * queues such as DelayQueues for which poll() is allowed to</span></span><br><span class="line"><span class="comment">     * return null even if it may later return non-null when delays</span></span><br><span class="line"><span class="comment">     * expire.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Lock held on access to workers set and related bookkeeping.</span></span><br><span class="line"><span class="comment">     * While we could use a concurrent set of some sort, it turns out</span></span><br><span class="line"><span class="comment">     * to be generally preferable to use a lock. Among the reasons is</span></span><br><span class="line"><span class="comment">     * that this serializes interruptIdleWorkers, which avoids</span></span><br><span class="line"><span class="comment">     * unnecessary interrupt storms, especially during shutdown.</span></span><br><span class="line"><span class="comment">     * Otherwise exiting threads would concurrently interrupt those</span></span><br><span class="line"><span class="comment">     * that have not yet interrupted. It also simplifies some of the</span></span><br><span class="line"><span class="comment">     * associated statistics bookkeeping of largestPoolSize etc. We</span></span><br><span class="line"><span class="comment">     * also hold mainLock on shutdown and shutdownNow, for the sake of</span></span><br><span class="line"><span class="comment">     * ensuring workers set is stable while separately checking</span></span><br><span class="line"><span class="comment">     * permission to interrupt and actually interrupting.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set containing all worker threads in pool. Accessed only when</span></span><br><span class="line"><span class="comment">     * holding mainLock.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="keyword">new</span> HashSet&lt;Worker&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Wait condition to support awaitTermination</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition termination = mainLock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tracks largest attained pool size. Accessed only under</span></span><br><span class="line"><span class="comment">     * mainLock.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> largestPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Counter for completed tasks. Updated only on termination of</span></span><br><span class="line"><span class="comment">     * worker threads. Accessed only under mainLock.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> completedTaskCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * All user control parameters are declared as volatiles so that</span></span><br><span class="line"><span class="comment">     * ongoing actions are based on freshest values, but without need</span></span><br><span class="line"><span class="comment">     * for locking, since no internal invariants depend on them</span></span><br><span class="line"><span class="comment">     * changing synchronously with respect to other actions.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Factory for new threads. All threads are created using this</span></span><br><span class="line"><span class="comment">     * factory (via method addWorker).  All callers must be prepared</span></span><br><span class="line"><span class="comment">     * for addWorker to fail, which may reflect a system or user&#x27;s</span></span><br><span class="line"><span class="comment">     * policy limiting the number of threads.  Even though it is not</span></span><br><span class="line"><span class="comment">     * treated as an error, failure to create threads may result in</span></span><br><span class="line"><span class="comment">     * new tasks being rejected or existing ones remaining stuck in</span></span><br><span class="line"><span class="comment">     * the queue.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * We go further and preserve pool invariants even in the face of</span></span><br><span class="line"><span class="comment">     * errors such as OutOfMemoryError, that might be thrown while</span></span><br><span class="line"><span class="comment">     * trying to create threads.  Such errors are rather common due to</span></span><br><span class="line"><span class="comment">     * the need to allocate a native stack in Thread.start, and users</span></span><br><span class="line"><span class="comment">     * will want to perform clean pool shutdown to clean up.  There</span></span><br><span class="line"><span class="comment">     * will likely be enough memory available for the cleanup code to</span></span><br><span class="line"><span class="comment">     * complete without encountering yet another OutOfMemoryError.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> ThreadFactory threadFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handler called when saturated or shutdown in execute.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> RejectedExecutionHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Timeout in nanoseconds for idle threads waiting for work.</span></span><br><span class="line"><span class="comment">     * Threads use this timeout when there are more than corePoolSize</span></span><br><span class="line"><span class="comment">     * present or if allowCoreThreadTimeOut. Otherwise they wait</span></span><br><span class="line"><span class="comment">     * forever for new work.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> keepAliveTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If false (default), core threads stay alive even when idle.</span></span><br><span class="line"><span class="comment">     * If true, core threads use keepAliveTime to time out waiting</span></span><br><span class="line"><span class="comment">     * for work.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> allowCoreThreadTimeOut;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Core pool size is the minimum number of workers to keep alive</span></span><br><span class="line"><span class="comment">     * (and not allow to time out etc) unless allowCoreThreadTimeOut</span></span><br><span class="line"><span class="comment">     * is set, in which case the minimum is zero.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> corePoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Maximum pool size. Note that the actual maximum is internally</span></span><br><span class="line"><span class="comment">     * bounded by CAPACITY.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> maximumPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The default rejected execution handler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RejectedExecutionHandler defaultHandler =</span><br><span class="line">        <span class="keyword">new</span> AbortPolicy();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Permission required for callers of shutdown and shutdownNow.</span></span><br><span class="line"><span class="comment">     * We additionally require (see checkShutdownAccess) that callers</span></span><br><span class="line"><span class="comment">     * have permission to actually interrupt threads in the worker set</span></span><br><span class="line"><span class="comment">     * (as governed by Thread.interrupt, which relies on</span></span><br><span class="line"><span class="comment">     * ThreadGroup.checkAccess, which in turn relies on</span></span><br><span class="line"><span class="comment">     * SecurityManager.checkAccess). Shutdowns are attempted only if</span></span><br><span class="line"><span class="comment">     * these checks pass.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * All actual invocations of Thread.interrupt (see</span></span><br><span class="line"><span class="comment">     * interruptIdleWorkers and interruptWorkers) ignore</span></span><br><span class="line"><span class="comment">     * SecurityExceptions, meaning that the attempted interrupts</span></span><br><span class="line"><span class="comment">     * silently fail. In the case of shutdown, they should not fail</span></span><br><span class="line"><span class="comment">     * unless the SecurityManager has inconsistent policies, sometimes</span></span><br><span class="line"><span class="comment">     * allowing access to a thread and sometimes not. In such cases,</span></span><br><span class="line"><span class="comment">     * failure to actually interrupt threads may disable or delay full</span></span><br><span class="line"><span class="comment">     * termination. Other uses of interruptIdleWorkers are advisory,</span></span><br><span class="line"><span class="comment">     * and failure to actually interrupt will merely delay response to</span></span><br><span class="line"><span class="comment">     * configuration changes so is not handled exceptionally.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RuntimePermission shutdownPerm =</span><br><span class="line">        <span class="keyword">new</span> RuntimePermission(<span class="string">&quot;modifyThread&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Class Worker mainly maintains interrupt control state for</span></span><br><span class="line"><span class="comment">     * threads running tasks, along with other minor bookkeeping.</span></span><br><span class="line"><span class="comment">     * This class opportunistically extends AbstractQueuedSynchronizer</span></span><br><span class="line"><span class="comment">     * to simplify acquiring and releasing a lock surrounding each</span></span><br><span class="line"><span class="comment">     * task execution.  This protects against interrupts that are</span></span><br><span class="line"><span class="comment">     * intended to wake up a worker thread waiting for a task from</span></span><br><span class="line"><span class="comment">     * instead interrupting a task being run.  We implement a simple</span></span><br><span class="line"><span class="comment">     * non-reentrant mutual exclusion lock rather than use</span></span><br><span class="line"><span class="comment">     * ReentrantLock because we do not want worker tasks to be able to</span></span><br><span class="line"><span class="comment">     * reacquire the lock when they invoke pool control methods like</span></span><br><span class="line"><span class="comment">     * setCorePoolSize.  Additionally, to suppress interrupts until</span></span><br><span class="line"><span class="comment">     * the thread actually starts running tasks, we initialize lock</span></span><br><span class="line"><span class="comment">     * state to a negative value, and clear it upon start (in</span></span><br><span class="line"><span class="comment">     * runWorker).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * This class will never be serialized, but we provide a</span></span><br><span class="line"><span class="comment">         * serialVersionUID to suppress a javac warning.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6138294804551838833L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Thread this worker is running in.  Null if factory fails. */</span></span><br><span class="line">        <span class="keyword">final</span> Thread thread;</span><br><span class="line">        <span class="comment">/** Initial task to run.  Possibly null. */</span></span><br><span class="line">        Runnable firstTask;</span><br><span class="line">        <span class="comment">/** Per-thread task counter */</span></span><br><span class="line">        <span class="keyword">volatile</span> <span class="keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates with given first task and thread from ThreadFactory.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> firstTask the first task (null if none)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Worker(Runnable firstTask) &#123;</span><br><span class="line">            setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker</span></span><br><span class="line">            <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">            <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Delegates main run loop to outer runWorker  */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            runWorker(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Lock methods</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// The value 0 represents the unlocked state.</span></span><br><span class="line">        <span class="comment">// The value 1 represents the locked state.</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getState() != <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> unused)</span> </span>&#123;</span><br><span class="line">            setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">            setState(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span>        </span>&#123; acquire(<span class="number">1</span>); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span>  </span>&#123; <span class="keyword">return</span> tryAcquire(<span class="number">1</span>); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span>      </span>&#123; release(<span class="number">1</span>); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> isHeldExclusively(); &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">interruptIfStarted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Thread t;</span><br><span class="line">            <span class="keyword">if</span> (getState() &gt;= <span class="number">0</span> &amp;&amp; (t = thread) != <span class="keyword">null</span> &amp;&amp; !t.isInterrupted()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    t.interrupt();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SecurityException ignore) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Methods for setting control state</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transitions runState to given target, or leaves it alone if</span></span><br><span class="line"><span class="comment">     * already at least the given target.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetState the desired state, either SHUTDOWN or STOP</span></span><br><span class="line"><span class="comment">     *        (but not TIDYING or TERMINATED -- use tryTerminate for that)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">advanceRunState</span><span class="params">(<span class="keyword">int</span> targetState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">            <span class="keyword">if</span> (runStateAtLeast(c, targetState) ||</span><br><span class="line">                ctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transitions to TERMINATED state if either (SHUTDOWN and pool</span></span><br><span class="line"><span class="comment">     * and queue empty) or (STOP and pool empty).  If otherwise</span></span><br><span class="line"><span class="comment">     * eligible to terminate but workerCount is nonzero, interrupts an</span></span><br><span class="line"><span class="comment">     * idle worker to ensure that shutdown signals propagate. This</span></span><br><span class="line"><span class="comment">     * method must be called following any action that might make</span></span><br><span class="line"><span class="comment">     * termination possible -- reducing worker count or removing tasks</span></span><br><span class="line"><span class="comment">     * from the queue during shutdown. The method is non-private to</span></span><br><span class="line"><span class="comment">     * allow access from ScheduledThreadPoolExecutor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">tryTerminate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">            <span class="keyword">if</span> (isRunning(c) ||</span><br><span class="line">                runStateAtLeast(c, TIDYING) ||</span><br><span class="line">                (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span> (workerCountOf(c) != <span class="number">0</span>) &#123; <span class="comment">// Eligible to terminate</span></span><br><span class="line">                interruptIdleWorkers(ONLY_ONE);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (ctl.compareAndSet(c, ctlOf(TIDYING, <span class="number">0</span>))) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        terminated();</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        ctl.set(ctlOf(TERMINATED, <span class="number">0</span>));</span><br><span class="line">                        termination.signalAll();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// else retry on failed CAS</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Methods for controlling interrupts to worker threads.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If there is a security manager, makes sure caller has</span></span><br><span class="line"><span class="comment">     * permission to shut down threads in general (see shutdownPerm).</span></span><br><span class="line"><span class="comment">     * If this passes, additionally makes sure the caller is allowed</span></span><br><span class="line"><span class="comment">     * to interrupt each worker thread. This might not be true even if</span></span><br><span class="line"><span class="comment">     * first check passed, if the SecurityManager treats some threads</span></span><br><span class="line"><span class="comment">     * specially.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkShutdownAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SecurityManager security = System.getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (security != <span class="keyword">null</span>) &#123;</span><br><span class="line">            security.checkPermission(shutdownPerm);</span><br><span class="line">            <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">                    security.checkAccess(w.thread);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Interrupts all threads, even if active. Ignores SecurityExceptions</span></span><br><span class="line"><span class="comment">     * (in which case some threads may remain uninterrupted).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptWorkers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">                w.interruptIfStarted();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Interrupts threads that might be waiting for tasks (as</span></span><br><span class="line"><span class="comment">     * indicated by not being locked) so they can check for</span></span><br><span class="line"><span class="comment">     * termination or configuration changes. Ignores</span></span><br><span class="line"><span class="comment">     * SecurityExceptions (in which case some threads may remain</span></span><br><span class="line"><span class="comment">     * uninterrupted).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> onlyOne If true, interrupt at most one worker. This is</span></span><br><span class="line"><span class="comment">     * called only from tryTerminate when termination is otherwise</span></span><br><span class="line"><span class="comment">     * enabled but there are still other workers.  In this case, at</span></span><br><span class="line"><span class="comment">     * most one waiting worker is interrupted to propagate shutdown</span></span><br><span class="line"><span class="comment">     * signals in case all threads are currently waiting.</span></span><br><span class="line"><span class="comment">     * Interrupting any arbitrary thread ensures that newly arriving</span></span><br><span class="line"><span class="comment">     * workers since shutdown began will also eventually exit.</span></span><br><span class="line"><span class="comment">     * To guarantee eventual termination, it suffices to always</span></span><br><span class="line"><span class="comment">     * interrupt only one idle worker, but shutdown() interrupts all</span></span><br><span class="line"><span class="comment">     * idle workers so that redundant workers exit promptly, not</span></span><br><span class="line"><span class="comment">     * waiting for a straggler task to finish.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptIdleWorkers</span><span class="params">(<span class="keyword">boolean</span> onlyOne)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers) &#123;</span><br><span class="line">                Thread t = w.thread;</span><br><span class="line">                <span class="keyword">if</span> (!t.isInterrupted() &amp;&amp; w.tryLock()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        t.interrupt();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (SecurityException ignore) &#123;</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        w.unlock();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onlyOne)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Common form of interruptIdleWorkers, to avoid having to</span></span><br><span class="line"><span class="comment">     * remember what the boolean argument means.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">interruptIdleWorkers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        interruptIdleWorkers(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> ONLY_ONE = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Misc utilities, most of which are also exported to</span></span><br><span class="line"><span class="comment">     * ScheduledThreadPoolExecutor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Invokes the rejected execution handler for the given command.</span></span><br><span class="line"><span class="comment">     * Package-protected for use by ScheduledThreadPoolExecutor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">reject</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">        handler.rejectedExecution(command, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs any further cleanup following run state transition on</span></span><br><span class="line"><span class="comment">     * invocation of shutdown.  A no-op here, but used by</span></span><br><span class="line"><span class="comment">     * ScheduledThreadPoolExecutor to cancel delayed tasks.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onShutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * State check needed by ScheduledThreadPoolExecutor to</span></span><br><span class="line"><span class="comment">     * enable running tasks during shutdown.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shutdownOK true if should return true if SHUTDOWN</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isRunningOrShutdown</span><span class="params">(<span class="keyword">boolean</span> shutdownOK)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line">        <span class="keyword">return</span> rs == RUNNING || (rs == SHUTDOWN &amp;&amp; shutdownOK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Drains the task queue into a new list, normally using</span></span><br><span class="line"><span class="comment">     * drainTo. But if the queue is a DelayQueue or any other kind of</span></span><br><span class="line"><span class="comment">     * queue for which poll or drainTo may fail to remove some</span></span><br><span class="line"><span class="comment">     * elements, it deletes them one by one.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Runnable&gt; <span class="title">drainQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BlockingQueue&lt;Runnable&gt; q = workQueue;</span><br><span class="line">        ArrayList&lt;Runnable&gt; taskList = <span class="keyword">new</span> ArrayList&lt;Runnable&gt;();</span><br><span class="line">        q.drainTo(taskList);</span><br><span class="line">        <span class="keyword">if</span> (!q.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Runnable r : q.toArray(<span class="keyword">new</span> Runnable[<span class="number">0</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (q.remove(r))</span><br><span class="line">                    taskList.add(r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> taskList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Methods for creating, running and cleaning up after workers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Checks if a new worker can be added with respect to current</span></span><br><span class="line"><span class="comment">     * pool state and the given bound (either core or maximum). If so,</span></span><br><span class="line"><span class="comment">     * the worker count is adjusted accordingly, and, if possible, a</span></span><br><span class="line"><span class="comment">     * new worker is created and started, running firstTask as its</span></span><br><span class="line"><span class="comment">     * first task. This method returns false if the pool is stopped or</span></span><br><span class="line"><span class="comment">     * eligible to shut down. It also returns false if the thread</span></span><br><span class="line"><span class="comment">     * factory fails to create a thread when asked.  If the thread</span></span><br><span class="line"><span class="comment">     * creation fails, either due to the thread factory returning</span></span><br><span class="line"><span class="comment">     * null, or due to an exception (typically OutOfMemoryError in</span></span><br><span class="line"><span class="comment">     * Thread.start()), we roll back cleanly.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstTask the task the new thread should run first (or</span></span><br><span class="line"><span class="comment">     * null if none). Workers are created with an initial first task</span></span><br><span class="line"><span class="comment">     * (in method execute()) to bypass queuing when there are fewer</span></span><br><span class="line"><span class="comment">     * than corePoolSize threads (in which case we always start one),</span></span><br><span class="line"><span class="comment">     * or when the queue is full (in which case we must bypass queue).</span></span><br><span class="line"><span class="comment">     * Initially idle threads are usually created via</span></span><br><span class="line"><span class="comment">     * prestartCoreThread or to replace other dying workers.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> core if true use corePoolSize as bound, else</span></span><br><span class="line"><span class="comment">     * maximumPoolSize. (A boolean indicator is used here rather than a</span></span><br><span class="line"><span class="comment">     * value to ensure reads of fresh values after checking other pool</span></span><br><span class="line"><span class="comment">     * state).</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if successful</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>&#123;</span><br><span class="line">        retry:</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">            <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">            <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">                ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">                   firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                   ! workQueue.isEmpty()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">                <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                    wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                    <span class="keyword">break</span> retry;</span><br><span class="line">                c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">                <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                    <span class="keyword">continue</span> retry;</span><br><span class="line">                <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">        Worker w = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">            <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">                mainLock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">                    <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">                    <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">                    <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                        (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                        workers.add(w);</span><br><span class="line">                        <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                        <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                            largestPoolSize = s;</span><br><span class="line">                        workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    mainLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">                    t.start();</span><br><span class="line">                    workerStarted = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">                addWorkerFailed(w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> workerStarted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Rolls back the worker thread creation.</span></span><br><span class="line"><span class="comment">     * - removes worker from workers, if present</span></span><br><span class="line"><span class="comment">     * - decrements worker count</span></span><br><span class="line"><span class="comment">     * - rechecks for termination, in case the existence of this</span></span><br><span class="line"><span class="comment">     *   worker was holding up termination</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addWorkerFailed</span><span class="params">(Worker w)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (w != <span class="keyword">null</span>)</span><br><span class="line">                workers.remove(w);</span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">            tryTerminate();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs cleanup and bookkeeping for a dying worker. Called</span></span><br><span class="line"><span class="comment">     * only from worker threads. Unless completedAbruptly is set,</span></span><br><span class="line"><span class="comment">     * assumes that workerCount has already been adjusted to account</span></span><br><span class="line"><span class="comment">     * for exit.  This method removes thread from worker set, and</span></span><br><span class="line"><span class="comment">     * possibly terminates the pool or replaces the worker if either</span></span><br><span class="line"><span class="comment">     * it exited due to user task exception or if fewer than</span></span><br><span class="line"><span class="comment">     * corePoolSize workers are running or queue is non-empty but</span></span><br><span class="line"><span class="comment">     * there are no workers.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w the worker</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> completedAbruptly if the worker died due to user exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processWorkerExit</span><span class="params">(Worker w, <span class="keyword">boolean</span> completedAbruptly)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (completedAbruptly) <span class="comment">// If abrupt, then workerCount wasn&#x27;t adjusted</span></span><br><span class="line">            decrementWorkerCount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            completedTaskCount += w.completedTasks;</span><br><span class="line">            workers.remove(w);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tryTerminate();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (runStateLessThan(c, STOP)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!completedAbruptly) &#123;</span><br><span class="line">                <span class="keyword">int</span> min = allowCoreThreadTimeOut ? <span class="number">0</span> : corePoolSize;</span><br><span class="line">                <span class="keyword">if</span> (min == <span class="number">0</span> &amp;&amp; ! workQueue.isEmpty())</span><br><span class="line">                    min = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (workerCountOf(c) &gt;= min)</span><br><span class="line">                    <span class="keyword">return</span>; <span class="comment">// replacement not needed</span></span><br><span class="line">            &#125;</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs blocking or timed wait for a task, depending on</span></span><br><span class="line"><span class="comment">     * current configuration settings, or returns null if this worker</span></span><br><span class="line"><span class="comment">     * must exit because of any of:</span></span><br><span class="line"><span class="comment">     * 1. There are more than maximumPoolSize workers (due to</span></span><br><span class="line"><span class="comment">     *    a call to setMaximumPoolSize).</span></span><br><span class="line"><span class="comment">     * 2. The pool is stopped.</span></span><br><span class="line"><span class="comment">     * 3. The pool is shutdown and the queue is empty.</span></span><br><span class="line"><span class="comment">     * 4. This worker timed out waiting for a task, and timed-out</span></span><br><span class="line"><span class="comment">     *    workers are subject to termination (that is,</span></span><br><span class="line"><span class="comment">     *    &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut || workerCount &gt; corePoolSize&#125;)</span></span><br><span class="line"><span class="comment">     *    both before and after the timed wait, and if the queue is</span></span><br><span class="line"><span class="comment">     *    non-empty, this worker is not the last thread in the pool.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> task, or null if the worker must exit, in which case</span></span><br><span class="line"><span class="comment">     *         workerCount is decremented</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>; <span class="comment">// Did the last poll() time out?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">            <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">            <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123;</span><br><span class="line">                decrementWorkerCount();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Are workers subject to culling?</span></span><br><span class="line">            <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))</span><br><span class="line">                &amp;&amp; (wc &gt; <span class="number">1</span> || workQueue.isEmpty())) &#123;</span><br><span class="line">                <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runnable r = timed ?</span><br><span class="line">                    workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                    workQueue.take();</span><br><span class="line">                <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> r;</span><br><span class="line">                timedOut = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException retry) &#123;</span><br><span class="line">                timedOut = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Main worker run loop.  Repeatedly gets tasks from queue and</span></span><br><span class="line"><span class="comment">     * executes them, while coping with a number of issues:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 1. We may start out with an initial task, in which case we</span></span><br><span class="line"><span class="comment">     * don&#x27;t need to get the first one. Otherwise, as long as pool is</span></span><br><span class="line"><span class="comment">     * running, we get tasks from getTask. If it returns null then the</span></span><br><span class="line"><span class="comment">     * worker exits due to changed pool state or configuration</span></span><br><span class="line"><span class="comment">     * parameters.  Other exits result from exception throws in</span></span><br><span class="line"><span class="comment">     * external code, in which case completedAbruptly holds, which</span></span><br><span class="line"><span class="comment">     * usually leads processWorkerExit to replace this thread.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 2. Before running any task, the lock is acquired to prevent</span></span><br><span class="line"><span class="comment">     * other pool interrupts while the task is executing, and then we</span></span><br><span class="line"><span class="comment">     * ensure that unless pool is stopping, this thread does not have</span></span><br><span class="line"><span class="comment">     * its interrupt set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 3. Each task run is preceded by a call to beforeExecute, which</span></span><br><span class="line"><span class="comment">     * might throw an exception, in which case we cause thread to die</span></span><br><span class="line"><span class="comment">     * (breaking loop with completedAbruptly true) without processing</span></span><br><span class="line"><span class="comment">     * the task.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 4. Assuming beforeExecute completes normally, we run the task,</span></span><br><span class="line"><span class="comment">     * gathering any of its thrown exceptions to send to afterExecute.</span></span><br><span class="line"><span class="comment">     * We separately handle RuntimeException, Error (both of which the</span></span><br><span class="line"><span class="comment">     * specs guarantee that we trap) and arbitrary Throwables.</span></span><br><span class="line"><span class="comment">     * Because we cannot rethrow Throwables within Runnable.run, we</span></span><br><span class="line"><span class="comment">     * wrap them within Errors on the way out (to the thread&#x27;s</span></span><br><span class="line"><span class="comment">     * UncaughtExceptionHandler).  Any thrown exception also</span></span><br><span class="line"><span class="comment">     * conservatively causes thread to die.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 5. After task.run completes, we call afterExecute, which may</span></span><br><span class="line"><span class="comment">     * also throw an exception, which will also cause thread to</span></span><br><span class="line"><span class="comment">     * die. According to JLS Sec 14.20, this exception is the one that</span></span><br><span class="line"><span class="comment">     * will be in effect even if task.run throws.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * The net effect of the exception mechanics is that afterExecute</span></span><br><span class="line"><span class="comment">     * and the thread&#x27;s UncaughtExceptionHandler have as accurate</span></span><br><span class="line"><span class="comment">     * information as we can provide about any problems encountered by</span></span><br><span class="line"><span class="comment">     * user code.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w the worker</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>&#123;</span><br><span class="line">        Thread wt = Thread.currentThread();</span><br><span class="line">        Runnable task = w.firstTask;</span><br><span class="line">        w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">        w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">        <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                w.lock();</span><br><span class="line">                <span class="comment">// If pool is stopping, ensure thread is interrupted;</span></span><br><span class="line">                <span class="comment">// if not, ensure thread is not interrupted.  This</span></span><br><span class="line">                <span class="comment">// requires a recheck in second case to deal with</span></span><br><span class="line">                <span class="comment">// shutdownNow race while clearing interrupt</span></span><br><span class="line">                <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                     (Thread.interrupted() &amp;&amp;</span><br><span class="line">                      runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                    !wt.isInterrupted())</span><br><span class="line">                    wt.interrupt();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    beforeExecute(wt, task);</span><br><span class="line">                    Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        task.run();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (RuntimeException x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Error x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable x) &#123;</span><br><span class="line">                        thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        afterExecute(task, thrown);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    task = <span class="keyword">null</span>;</span><br><span class="line">                    w.completedTasks++;</span><br><span class="line">                    w.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            processWorkerExit(w, completedAbruptly);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Public constructors and methods</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment">     * parameters and default thread factory and rejected execution handler.</span></span><br><span class="line"><span class="comment">     * It may be more convenient to use one of the &#123;<span class="doctag">@link</span> Executors&#125; factory</span></span><br><span class="line"><span class="comment">     * methods instead of this general purpose constructor.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment">     *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment">     *        pool</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment">     *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment">     *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment">     *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment">     *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds:&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125; is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">             Executors.defaultThreadFactory(), defaultHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment">     * parameters and default rejected execution handler.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment">     *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment">     *        pool</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment">     *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment">     *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment">     *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment">     *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadFactory the factory to use when the executor</span></span><br><span class="line"><span class="comment">     *        creates a new thread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds:&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125;</span></span><br><span class="line"><span class="comment">     *         or &#123;<span class="doctag">@code</span> threadFactory&#125; is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">             threadFactory, defaultHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment">     * parameters and default thread factory.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment">     *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment">     *        pool</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment">     *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment">     *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment">     *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment">     *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler the handler to use when execution is blocked</span></span><br><span class="line"><span class="comment">     *        because the thread bounds and queue capacities are reached</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds:&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125;</span></span><br><span class="line"><span class="comment">     *         or &#123;<span class="doctag">@code</span> handler&#125; is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">             Executors.defaultThreadFactory(), handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment">     * parameters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment">     *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment">     *        pool</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment">     *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment">     *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment">     *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment">     *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadFactory the factory to use when the executor</span></span><br><span class="line"><span class="comment">     *        creates a new thread</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler the handler to use when execution is blocked</span></span><br><span class="line"><span class="comment">     *        because the thread bounds and queue capacities are reached</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds:&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125;</span></span><br><span class="line"><span class="comment">     *         or &#123;<span class="doctag">@code</span> threadFactory&#125; or &#123;<span class="doctag">@code</span> handler&#125; is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Executes the given task sometime in the future.  The task</span></span><br><span class="line"><span class="comment">     * may execute in a new thread or in an existing pooled thread.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If the task cannot be submitted for execution, either because this</span></span><br><span class="line"><span class="comment">     * executor has been shutdown or because its capacity has been reached,</span></span><br><span class="line"><span class="comment">     * the task is handled by the current &#123;<span class="doctag">@code</span> RejectedExecutionHandler&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> command the task to execute</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RejectedExecutionException at discretion of</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> RejectedExecutionHandler&#125;, if the task</span></span><br><span class="line"><span class="comment">     *         cannot be accepted for execution</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> command&#125; is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Proceed in 3 steps:</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class="line"><span class="comment">         * start a new thread with the given command as its first</span></span><br><span class="line"><span class="comment">         * task.  The call to addWorker atomically checks runState and</span></span><br><span class="line"><span class="comment">         * workerCount, and so prevents false alarms that would add</span></span><br><span class="line"><span class="comment">         * threads when it shouldn&#x27;t, by returning false.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 2. If a task can be successfully queued, then we still need</span></span><br><span class="line"><span class="comment">         * to double-check whether we should have added a thread</span></span><br><span class="line"><span class="comment">         * (because existing ones died since last checking) or that</span></span><br><span class="line"><span class="comment">         * the pool shut down since entry into this method. So we</span></span><br><span class="line"><span class="comment">         * recheck state and if necessary roll back the enqueuing if</span></span><br><span class="line"><span class="comment">         * stopped, or start a new thread if there are none.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 3. If we cannot queue task, then we try to add a new</span></span><br><span class="line"><span class="comment">         * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class="line"><span class="comment">         * and so reject the task.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">            <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            c = ctl.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">            <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">            <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">                reject(command);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">                addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">            reject(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initiates an orderly shutdown in which previously submitted</span></span><br><span class="line"><span class="comment">     * tasks are executed, but no new tasks will be accepted.</span></span><br><span class="line"><span class="comment">     * Invocation has no additional effect if already shut down.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This method does not wait for previously submitted tasks to</span></span><br><span class="line"><span class="comment">     * complete execution.  Use &#123;<span class="doctag">@link</span> #awaitTermination awaitTermination&#125;</span></span><br><span class="line"><span class="comment">     * to do that.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SecurityException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkShutdownAccess();</span><br><span class="line">            advanceRunState(SHUTDOWN);</span><br><span class="line">            interruptIdleWorkers();</span><br><span class="line">            onShutdown(); <span class="comment">// hook for ScheduledThreadPoolExecutor</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        tryTerminate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Attempts to stop all actively executing tasks, halts the</span></span><br><span class="line"><span class="comment">     * processing of waiting tasks, and returns a list of the tasks</span></span><br><span class="line"><span class="comment">     * that were awaiting execution. These tasks are drained (removed)</span></span><br><span class="line"><span class="comment">     * from the task queue upon return from this method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This method does not wait for actively executing tasks to</span></span><br><span class="line"><span class="comment">     * terminate.  Use &#123;<span class="doctag">@link</span> #awaitTermination awaitTermination&#125; to</span></span><br><span class="line"><span class="comment">     * do that.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;There are no guarantees beyond best-effort attempts to stop</span></span><br><span class="line"><span class="comment">     * processing actively executing tasks.  This implementation</span></span><br><span class="line"><span class="comment">     * cancels tasks via &#123;<span class="doctag">@link</span> Thread#interrupt&#125;, so any task that</span></span><br><span class="line"><span class="comment">     * fails to respond to interrupts may never terminate.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SecurityException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Runnable&gt; tasks;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkShutdownAccess();</span><br><span class="line">            advanceRunState(STOP);</span><br><span class="line">            interruptWorkers();</span><br><span class="line">            tasks = drainQueue();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        tryTerminate();</span><br><span class="line">        <span class="keyword">return</span> tasks;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isShutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ! isRunning(ctl.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if this executor is in the process of terminating</span></span><br><span class="line"><span class="comment">     * after &#123;<span class="doctag">@link</span> #shutdown&#125; or &#123;<span class="doctag">@link</span> #shutdownNow&#125; but has not</span></span><br><span class="line"><span class="comment">     * completely terminated.  This method may be useful for</span></span><br><span class="line"><span class="comment">     * debugging. A return of &#123;<span class="doctag">@code</span> true&#125; reported a sufficient</span></span><br><span class="line"><span class="comment">     * period after shutdown may indicate that submitted tasks have</span></span><br><span class="line"><span class="comment">     * ignored or suppressed interruption, causing this executor not</span></span><br><span class="line"><span class="comment">     * to properly terminate.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if terminating but not yet terminated</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTerminating</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">return</span> ! isRunning(c) &amp;&amp; runStateLessThan(c, TERMINATED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTerminated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> runStateAtLeast(ctl.get(), TERMINATED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="keyword">if</span> (runStateAtLeast(ctl.get(), TERMINATED))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                nanos = termination.awaitNanos(nanos);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Invokes &#123;<span class="doctag">@code</span> shutdown&#125; when this executor is no longer</span></span><br><span class="line"><span class="comment">     * referenced and it has no threads.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the thread factory used to create new threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadFactory the new thread factory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if threadFactory is null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getThreadFactory</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThreadFactory</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (threadFactory == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the thread factory used to create new threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the current thread factory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setThreadFactory(ThreadFactory)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ThreadFactory <span class="title">getThreadFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets a new handler for unexecutable tasks.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler the new handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if handler is null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getRejectedExecutionHandler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRejectedExecutionHandler</span><span class="params">(RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the current handler for unexecutable tasks.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the current handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setRejectedExecutionHandler(RejectedExecutionHandler)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RejectedExecutionHandler <span class="title">getRejectedExecutionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the core number of threads.  This overrides any value set</span></span><br><span class="line"><span class="comment">     * in the constructor.  If the new value is smaller than the</span></span><br><span class="line"><span class="comment">     * current value, excess existing threads will be terminated when</span></span><br><span class="line"><span class="comment">     * they next become idle.  If larger, new threads will, if needed,</span></span><br><span class="line"><span class="comment">     * be started to execute any queued tasks.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> corePoolSize the new core size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getCorePoolSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCorePoolSize</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">int</span> delta = corePoolSize - <span class="keyword">this</span>.corePoolSize;</span><br><span class="line">        <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(ctl.get()) &gt; corePoolSize)</span><br><span class="line">            interruptIdleWorkers();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (delta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We don&#x27;t really know how many new threads are &quot;needed&quot;.</span></span><br><span class="line">            <span class="comment">// As a heuristic, prestart enough new workers (up to new</span></span><br><span class="line">            <span class="comment">// core size) to handle the current number of tasks in</span></span><br><span class="line">            <span class="comment">// queue, but stop if queue becomes empty while doing so.</span></span><br><span class="line">            <span class="keyword">int</span> k = Math.min(delta, workQueue.size());</span><br><span class="line">            <span class="keyword">while</span> (k-- &gt; <span class="number">0</span> &amp;&amp; addWorker(<span class="keyword">null</span>, <span class="keyword">true</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (workQueue.isEmpty())</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the core number of threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the core number of threads</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setCorePoolSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCorePoolSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> corePoolSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Starts a core thread, causing it to idly wait for work. This</span></span><br><span class="line"><span class="comment">     * overrides the default policy of starting core threads only when</span></span><br><span class="line"><span class="comment">     * new tasks are executed. This method will return &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment">     * if all core threads have already been started.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if a thread was started</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">prestartCoreThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workerCountOf(ctl.get()) &lt; corePoolSize &amp;&amp;</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as prestartCoreThread except arranges that at least one</span></span><br><span class="line"><span class="comment">     * thread is started even if corePoolSize is 0.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ensurePrestart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(ctl.get());</span><br><span class="line">        <span class="keyword">if</span> (wc &lt; corePoolSize)</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (wc == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Starts all core threads, causing them to idly wait for work. This</span></span><br><span class="line"><span class="comment">     * overrides the default policy of starting core threads only when</span></span><br><span class="line"><span class="comment">     * new tasks are executed.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of threads started</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">prestartAllCoreThreads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (addWorker(<span class="keyword">null</span>, <span class="keyword">true</span>))</span><br><span class="line">            ++n;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns true if this pool allows core threads to time out and</span></span><br><span class="line"><span class="comment">     * terminate if no tasks arrive within the keepAlive time, being</span></span><br><span class="line"><span class="comment">     * replaced if needed when new tasks arrive. When true, the same</span></span><br><span class="line"><span class="comment">     * keep-alive policy applying to non-core threads applies also to</span></span><br><span class="line"><span class="comment">     * core threads. When false (the default), core threads are never</span></span><br><span class="line"><span class="comment">     * terminated due to lack of incoming tasks.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if core threads are allowed to time out,</span></span><br><span class="line"><span class="comment">     *         else &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">allowsCoreThreadTimeOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> allowCoreThreadTimeOut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the policy governing whether core threads may time out and</span></span><br><span class="line"><span class="comment">     * terminate if no tasks arrive within the keep-alive time, being</span></span><br><span class="line"><span class="comment">     * replaced if needed when new tasks arrive. When false, core</span></span><br><span class="line"><span class="comment">     * threads are never terminated due to lack of incoming</span></span><br><span class="line"><span class="comment">     * tasks. When true, the same keep-alive policy applying to</span></span><br><span class="line"><span class="comment">     * non-core threads applies also to core threads. To avoid</span></span><br><span class="line"><span class="comment">     * continual thread replacement, the keep-alive time must be</span></span><br><span class="line"><span class="comment">     * greater than zero when setting &#123;<span class="doctag">@code</span> true&#125;. This method</span></span><br><span class="line"><span class="comment">     * should in general be called before the pool is actively used.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value &#123;<span class="doctag">@code</span> true&#125; if should time out, else &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if value is &#123;<span class="doctag">@code</span> true&#125;</span></span><br><span class="line"><span class="comment">     *         and the current keep-alive time is not greater than zero</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">allowCoreThreadTimeOut</span><span class="params">(<span class="keyword">boolean</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value &amp;&amp; keepAliveTime &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Core threads must have nonzero keep alive times&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (value != allowCoreThreadTimeOut) &#123;</span><br><span class="line">            allowCoreThreadTimeOut = value;</span><br><span class="line">            <span class="keyword">if</span> (value)</span><br><span class="line">                interruptIdleWorkers();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the maximum allowed number of threads. This overrides any</span></span><br><span class="line"><span class="comment">     * value set in the constructor. If the new value is smaller than</span></span><br><span class="line"><span class="comment">     * the current value, excess existing threads will be</span></span><br><span class="line"><span class="comment">     * terminated when they next become idle.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maximumPoolSize the new maximum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the new maximum is</span></span><br><span class="line"><span class="comment">     *         less than or equal to zero, or</span></span><br><span class="line"><span class="comment">     *         less than the &#123;<span class="doctag">@linkplain</span> #getCorePoolSize core pool size&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getMaximumPoolSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaximumPoolSize</span><span class="params">(<span class="keyword">int</span> maximumPoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (maximumPoolSize &lt;= <span class="number">0</span> || maximumPoolSize &lt; corePoolSize)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="keyword">if</span> (workerCountOf(ctl.get()) &gt; maximumPoolSize)</span><br><span class="line">            interruptIdleWorkers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the maximum allowed number of threads.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the maximum allowed number of threads</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setMaximumPoolSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMaximumPoolSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maximumPoolSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the time limit for which threads may remain idle before</span></span><br><span class="line"><span class="comment">     * being terminated.  If there are more than the core number of</span></span><br><span class="line"><span class="comment">     * threads currently in the pool, after waiting this amount of</span></span><br><span class="line"><span class="comment">     * time without processing a task, excess threads will be</span></span><br><span class="line"><span class="comment">     * terminated.  This overrides any value set in the constructor.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time the time to wait.  A time value of zero will cause</span></span><br><span class="line"><span class="comment">     *        excess threads to terminate immediately after executing tasks.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit of the &#123;<span class="doctag">@code</span> time&#125; argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> time&#125; less than zero or</span></span><br><span class="line"><span class="comment">     *         if &#123;<span class="doctag">@code</span> time&#125; is zero and &#123;<span class="doctag">@code</span> allowsCoreThreadTimeOut&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getKeepAliveTime(TimeUnit)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeepAliveTime</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (time &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">if</span> (time == <span class="number">0</span> &amp;&amp; allowsCoreThreadTimeOut())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Core threads must have nonzero keep alive times&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> keepAliveTime = unit.toNanos(time);</span><br><span class="line">        <span class="keyword">long</span> delta = keepAliveTime - <span class="keyword">this</span>.keepAliveTime;</span><br><span class="line">        <span class="keyword">this</span>.keepAliveTime = keepAliveTime;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>)</span><br><span class="line">            interruptIdleWorkers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the thread keep-alive time, which is the amount of time</span></span><br><span class="line"><span class="comment">     * that threads in excess of the core pool size may remain</span></span><br><span class="line"><span class="comment">     * idle before being terminated.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the desired time unit of the result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the time limit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #setKeepAliveTime(long, TimeUnit)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getKeepAliveTime</span><span class="params">(TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unit.convert(keepAliveTime, TimeUnit.NANOSECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* User-level queue utilities */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the task queue used by this executor. Access to the</span></span><br><span class="line"><span class="comment">     * task queue is intended primarily for debugging and monitoring.</span></span><br><span class="line"><span class="comment">     * This queue may be in active use.  Retrieving the task queue</span></span><br><span class="line"><span class="comment">     * does not prevent queued tasks from executing.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the task queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BlockingQueue&lt;Runnable&gt; <span class="title">getQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes this task from the executor&#x27;s internal queue if it is</span></span><br><span class="line"><span class="comment">     * present, thus causing it not to be run if it has not already</span></span><br><span class="line"><span class="comment">     * started.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This method may be useful as one part of a cancellation</span></span><br><span class="line"><span class="comment">     * scheme.  It may fail to remove tasks that have been converted</span></span><br><span class="line"><span class="comment">     * into other forms before being placed on the internal queue. For</span></span><br><span class="line"><span class="comment">     * example, a task entered using &#123;<span class="doctag">@code</span> submit&#125; might be</span></span><br><span class="line"><span class="comment">     * converted into a form that maintains &#123;<span class="doctag">@code</span> Future&#125; status.</span></span><br><span class="line"><span class="comment">     * However, in such cases, method &#123;<span class="doctag">@link</span> #purge&#125; may be used to</span></span><br><span class="line"><span class="comment">     * remove those Futures that have been cancelled.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task the task to remove</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the task was removed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Runnable task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> removed = workQueue.remove(task);</span><br><span class="line">        tryTerminate(); <span class="comment">// In case SHUTDOWN and now empty</span></span><br><span class="line">        <span class="keyword">return</span> removed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tries to remove from the work queue all &#123;<span class="doctag">@link</span> Future&#125;</span></span><br><span class="line"><span class="comment">     * tasks that have been cancelled. This method can be useful as a</span></span><br><span class="line"><span class="comment">     * storage reclamation operation, that has no other impact on</span></span><br><span class="line"><span class="comment">     * functionality. Cancelled tasks are never executed, but may</span></span><br><span class="line"><span class="comment">     * accumulate in work queues until worker threads can actively</span></span><br><span class="line"><span class="comment">     * remove them. Invoking this method instead tries to remove them now.</span></span><br><span class="line"><span class="comment">     * However, this method may fail to remove tasks in</span></span><br><span class="line"><span class="comment">     * the presence of interference by other threads.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">purge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; q = workQueue;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Iterator&lt;Runnable&gt; it = q.iterator();</span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                Runnable r = it.next();</span><br><span class="line">                <span class="keyword">if</span> (r <span class="keyword">instanceof</span> Future&lt;?&gt; &amp;&amp; ((Future&lt;?&gt;)r).isCancelled())</span><br><span class="line">                    it.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConcurrentModificationException fallThrough) &#123;</span><br><span class="line">            <span class="comment">// Take slow path if we encounter interference during traversal.</span></span><br><span class="line">            <span class="comment">// Make copy for traversal and call remove for cancelled entries.</span></span><br><span class="line">            <span class="comment">// The slow path is more likely to be O(N*N).</span></span><br><span class="line">            <span class="keyword">for</span> (Object r : q.toArray())</span><br><span class="line">                <span class="keyword">if</span> (r <span class="keyword">instanceof</span> Future&lt;?&gt; &amp;&amp; ((Future&lt;?&gt;)r).isCancelled())</span><br><span class="line">                    q.remove(r);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tryTerminate(); <span class="comment">// In case SHUTDOWN and now empty</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Statistics */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the current number of threads in the pool.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of threads</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPoolSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Remove rare and surprising possibility of</span></span><br><span class="line">            <span class="comment">// isTerminated() &amp;&amp; getPoolSize() &gt; 0</span></span><br><span class="line">            <span class="keyword">return</span> runStateAtLeast(ctl.get(), TIDYING) ? <span class="number">0</span></span><br><span class="line">                : workers.size();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the approximate number of threads that are actively</span></span><br><span class="line"><span class="comment">     * executing tasks.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of threads</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">                <span class="keyword">if</span> (w.isLocked())</span><br><span class="line">                    ++n;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the largest number of threads that have ever</span></span><br><span class="line"><span class="comment">     * simultaneously been in the pool.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of threads</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLargestPoolSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> largestPoolSize;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the approximate total number of tasks that have ever been</span></span><br><span class="line"><span class="comment">     * scheduled for execution. Because the states of tasks and</span></span><br><span class="line"><span class="comment">     * threads may change dynamically during computation, the returned</span></span><br><span class="line"><span class="comment">     * value is only an approximation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of tasks</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getTaskCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> n = completedTaskCount;</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers) &#123;</span><br><span class="line">                n += w.completedTasks;</span><br><span class="line">                <span class="keyword">if</span> (w.isLocked())</span><br><span class="line">                    ++n;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> n + workQueue.size();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the approximate total number of tasks that have</span></span><br><span class="line"><span class="comment">     * completed execution. Because the states of tasks and threads</span></span><br><span class="line"><span class="comment">     * may change dynamically during computation, the returned value</span></span><br><span class="line"><span class="comment">     * is only an approximation, but one that does not ever decrease</span></span><br><span class="line"><span class="comment">     * across successive calls.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the number of tasks</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getCompletedTaskCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> n = completedTaskCount;</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers)</span><br><span class="line">                n += w.completedTasks;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a string identifying this pool, as well as its state,</span></span><br><span class="line"><span class="comment">     * including indications of run state and estimated worker and</span></span><br><span class="line"><span class="comment">     * task counts.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a string identifying this pool, as well as its state</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> ncompleted;</span><br><span class="line">        <span class="keyword">int</span> nworkers, nactive;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ncompleted = completedTaskCount;</span><br><span class="line">            nactive = <span class="number">0</span>;</span><br><span class="line">            nworkers = workers.size();</span><br><span class="line">            <span class="keyword">for</span> (Worker w : workers) &#123;</span><br><span class="line">                ncompleted += w.completedTasks;</span><br><span class="line">                <span class="keyword">if</span> (w.isLocked())</span><br><span class="line">                    ++nactive;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        String rs = (runStateLessThan(c, SHUTDOWN) ? <span class="string">&quot;Running&quot;</span> :</span><br><span class="line">                     (runStateAtLeast(c, TERMINATED) ? <span class="string">&quot;Terminated&quot;</span> :</span><br><span class="line">                      <span class="string">&quot;Shutting down&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString() +</span><br><span class="line">            <span class="string">&quot;[&quot;</span> + rs +</span><br><span class="line">            <span class="string">&quot;, pool size = &quot;</span> + nworkers +</span><br><span class="line">            <span class="string">&quot;, active threads = &quot;</span> + nactive +</span><br><span class="line">            <span class="string">&quot;, queued tasks = &quot;</span> + workQueue.size() +</span><br><span class="line">            <span class="string">&quot;, completed tasks = &quot;</span> + ncompleted +</span><br><span class="line">            <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Extension hooks */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Method invoked prior to executing the given Runnable in the</span></span><br><span class="line"><span class="comment">     * given thread.  This method is invoked by thread &#123;<span class="doctag">@code</span> t&#125; that</span></span><br><span class="line"><span class="comment">     * will execute task &#123;<span class="doctag">@code</span> r&#125;, and may be used to re-initialize</span></span><br><span class="line"><span class="comment">     * ThreadLocals, or to perform logging.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This implementation does nothing, but may be customized in</span></span><br><span class="line"><span class="comment">     * subclasses. Note: To properly nest multiple overridings, subclasses</span></span><br><span class="line"><span class="comment">     * should generally invoke &#123;<span class="doctag">@code</span> super.beforeExecute&#125; at the end of</span></span><br><span class="line"><span class="comment">     * this method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the thread that will run task &#123;<span class="doctag">@code</span> r&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> r the task that will be executed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeExecute</span><span class="params">(Thread t, Runnable r)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Method invoked upon completion of execution of the given Runnable.</span></span><br><span class="line"><span class="comment">     * This method is invoked by the thread that executed the task. If</span></span><br><span class="line"><span class="comment">     * non-null, the Throwable is the uncaught &#123;<span class="doctag">@code</span> RuntimeException&#125;</span></span><br><span class="line"><span class="comment">     * or &#123;<span class="doctag">@code</span> Error&#125; that caused execution to terminate abruptly.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This implementation does nothing, but may be customized in</span></span><br><span class="line"><span class="comment">     * subclasses. Note: To properly nest multiple overridings, subclasses</span></span><br><span class="line"><span class="comment">     * should generally invoke &#123;<span class="doctag">@code</span> super.afterExecute&#125; at the</span></span><br><span class="line"><span class="comment">     * beginning of this method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; When actions are enclosed in tasks (such as</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> FutureTask&#125;) either explicitly or via methods such as</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> submit&#125;, these task objects catch and maintain</span></span><br><span class="line"><span class="comment">     * computational exceptions, and so they do not cause abrupt</span></span><br><span class="line"><span class="comment">     * termination, and the internal exceptions are &lt;em&gt;not&lt;/em&gt;</span></span><br><span class="line"><span class="comment">     * passed to this method. If you would like to trap both kinds of</span></span><br><span class="line"><span class="comment">     * failures in this method, you can further probe for such cases,</span></span><br><span class="line"><span class="comment">     * as in this sample subclass that prints either the direct cause</span></span><br><span class="line"><span class="comment">     * or the underlying exception if a task has been aborted:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * class ExtendedExecutor extends ThreadPoolExecutor &#123;</span></span><br><span class="line"><span class="comment">     *   // ...</span></span><br><span class="line"><span class="comment">     *   protected void afterExecute(Runnable r, Throwable t) &#123;</span></span><br><span class="line"><span class="comment">     *     super.afterExecute(r, t);</span></span><br><span class="line"><span class="comment">     *     if (t == null &amp;&amp; r instanceof Future&lt;?&gt;) &#123;</span></span><br><span class="line"><span class="comment">     *       try &#123;</span></span><br><span class="line"><span class="comment">     *         Object result = ((Future&lt;?&gt;) r).get();</span></span><br><span class="line"><span class="comment">     *       &#125; catch (CancellationException ce) &#123;</span></span><br><span class="line"><span class="comment">     *           t = ce;</span></span><br><span class="line"><span class="comment">     *       &#125; catch (ExecutionException ee) &#123;</span></span><br><span class="line"><span class="comment">     *           t = ee.getCause();</span></span><br><span class="line"><span class="comment">     *       &#125; catch (InterruptedException ie) &#123;</span></span><br><span class="line"><span class="comment">     *           Thread.currentThread().interrupt(); // ignore/reset</span></span><br><span class="line"><span class="comment">     *       &#125;</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     *     if (t != null)</span></span><br><span class="line"><span class="comment">     *       System.out.println(t);</span></span><br><span class="line"><span class="comment">     *   &#125;</span></span><br><span class="line"><span class="comment">     * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> r the runnable that has completed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the exception that caused termination, or null if</span></span><br><span class="line"><span class="comment">     * execution completed normally</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterExecute</span><span class="params">(Runnable r, Throwable t)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Method invoked when the Executor has terminated.  Default</span></span><br><span class="line"><span class="comment">     * implementation does nothing. Note: To properly nest multiple</span></span><br><span class="line"><span class="comment">     * overridings, subclasses should generally invoke</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> super.terminated&#125; within this method.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">terminated</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Predefined RejectedExecutionHandlers */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A handler for rejected tasks that runs the rejected task</span></span><br><span class="line"><span class="comment">     * directly in the calling thread of the &#123;<span class="doctag">@code</span> execute&#125; method,</span></span><br><span class="line"><span class="comment">     * unless the executor has been shut down, in which case the task</span></span><br><span class="line"><span class="comment">     * is discarded.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates a &#123;<span class="doctag">@code</span> CallerRunsPolicy&#125;.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CallerRunsPolicy</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Executes task r in the caller&#x27;s thread, unless the executor</span></span><br><span class="line"><span class="comment">         * has been shut down, in which case the task is discarded.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> r the runnable task requested to be executed</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> e the executor attempting to execute this task</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                r.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A handler for rejected tasks that throws a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> RejectedExecutionException&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AbortPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates an &#123;<span class="doctag">@code</span> AbortPolicy&#125;.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AbortPolicy</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Always throws RejectedExecutionException.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> r the runnable task requested to be executed</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> e the executor attempting to execute this task</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> RejectedExecutionException always</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RejectedExecutionException(<span class="string">&quot;Task &quot;</span> + r.toString() +</span><br><span class="line">                                                 <span class="string">&quot; rejected from &quot;</span> +</span><br><span class="line">                                                 e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A handler for rejected tasks that silently discards the</span></span><br><span class="line"><span class="comment">     * rejected task.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates a &#123;<span class="doctag">@code</span> DiscardPolicy&#125;.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DiscardPolicy</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Does nothing, which has the effect of discarding task r.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> r the runnable task requested to be executed</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> e the executor attempting to execute this task</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A handler for rejected tasks that discards the oldest unhandled</span></span><br><span class="line"><span class="comment">     * request and then retries &#123;<span class="doctag">@code</span> execute&#125;, unless the executor</span></span><br><span class="line"><span class="comment">     * is shut down, in which case the task is discarded.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiscardOldestPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates a &#123;<span class="doctag">@code</span> DiscardOldestPolicy&#125; for the given executor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">DiscardOldestPolicy</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Obtains and ignores the next task that the executor</span></span><br><span class="line"><span class="comment">         * would otherwise execute, if one is immediately available,</span></span><br><span class="line"><span class="comment">         * and then retries execution of task r, unless the executor</span></span><br><span class="line"><span class="comment">         * is shut down, in which case task r is instead discarded.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> r the runnable task requested to be executed</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> e the executor attempting to execute this task</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                e.getQueue().poll();</span><br><span class="line">                e.execute(r);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadPoolExecutor/" data-id="cl7mgnxtv0019t2zaamkd3w2v" data-title="ThreadPoolExecutor æºç åˆ†æ" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadPoolExecutor/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/12/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadPoolExecutor/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-JAVAè®¾è®¡æ¨¡å¼ä¸€" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/12/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/" class="article-date">
  <time class="dt-published" datetime="2015-09-11T16:00:00.000Z" itemprop="datePublished">2015-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/12/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/">è®¾è®¡æ¨¡å¼åˆ†ç±»</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>å¹³æ—¶å·¥ä½œä»£ç è¿›è¡Œé‡æ„æ—¶ä¹Ÿä¼šæ¶‰åŠåˆ°è®¾è®¡æ¨¡å¼ï¼Œå¦å¤–åœ¨çœ‹ä¸€äº›å¼€æºæ¡†æ¶æ—¶ä¹Ÿä¼šæ¶‰åŠåˆ°å¾ˆå¤šçš„è®¾è®¡æ¨¡å¼ã€‚åªæ˜¯å¹³æ—¶æ²¡æœ‰å¤ªå…¨é¢çš„äº†è§£ï¼Œæœ€è¿‘é¢è¯•æ—¶æœ‰åŒäº‹é—®æ±²åˆ°è¿™é‡Œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ•´ç†ä»¥å¤‡å°†æ¥éšæ—¶æŸ¥çœ‹ã€‚<br>è¿™é‡Œæˆ‘ä¸¾ä¸€ä¸ªæœ€å®¹æ˜“ç†è§£çš„ä¾‹å­æ¥è§£é‡Šæ¯ç§è®¾è®¡æ¨¡å¼<br>é¦–å…ˆçœ‹ä¸€ä¸‹è®¾è®¡æ¨¡å¼çš„åˆ†ç±»åŠå…³ç³» </p>
</blockquote>
<img  src='/images/pattern/pattern.png' class='col-xs-12 thumbnail'/>

<p>å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚å›¾ï¼š<br><img  src='/images/pattern/relation.png' class='col-xs-12 thumbnail'/></p>
<p>##åˆ›å»ºå‹æ¨¡å¼<br>è¿™å…­ä¸ªæ¨¡å¼éƒ½æ˜¯ä¸åˆ›å»ºå¯¹è±¡ç›¸å…³çš„</p>
<ul>
<li>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰ï¼›</li>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ï¼›</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ï¼›</li>
<li>åˆ›å»ºè€…æ¨¡å¼ï¼ˆBuilderï¼‰ï¼›</li>
<li>åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰ï¼›</li>
<li>å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ï¼›</li>
</ul>
<p>##ç»“æ„å‹æ¨¡å¼</p>
<p>åˆ›å»ºå¯¹è±¡åï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè®¾è®¡å¥½äº†ä¼šä¸ºåç»­ä»£ç çš„ç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„æ–¹ä¾¿ã€‚</p>
<ul>
<li>å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰ï¼›</li>
<li>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰ï¼›</li>
<li>ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰ï¼›</li>
<li>è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰ï¼›</li>
<li>æ¡¥æ¨¡å¼ï¼ˆBridgeï¼‰ï¼›</li>
<li>ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰ï¼›</li>
<li>äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰</li>
</ul>
<p>##è¡Œä¸ºå‹æ¨¡å¼</p>
<p>å¯¹è±¡çš„åˆ›å»ºå’Œç»“æ„å®šä¹‰å¥½åï¼Œå°±æ˜¯ä»–ä»¬çš„è¡Œä¸ºçš„è®¾è®¡äº†ã€‚<br>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰ï¼›</p>
<ul>
<li>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰ï¼›</li>
<li>çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰ï¼›</li>
<li>ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰ï¼›</li>
<li>èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰ï¼›</li>
<li>å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰ï¼›</li>
<li>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰ï¼›</li>
<li>è°ƒåœè€…æ¨¡å¼ï¼ˆMediatorï¼‰ï¼›</li>
<li>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰ï¼›</li>
<li>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰ï¼›</li>
<li>è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/12/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/" data-id="cl7mgnxtw001ht2zagbt0800e" data-title="è®¾è®¡æ¨¡å¼åˆ†ç±»" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/12/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/12/JAVA%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-æˆ‘çš„ä¹¦æ¶" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/10/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6/" class="article-date">
  <time class="dt-published" datetime="2015-09-09T16:00:00.000Z" itemprop="datePublished">2015-09-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E4%B9%A6%E6%9E%B6/">ä¹¦æ¶</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/10/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6/">ä¸ªäººä¹¦æ¶</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="æœ€è¿‘åœ¨çœ‹çš„ä¹¦ç±ï¼š"><a href="#æœ€è¿‘åœ¨çœ‹çš„ä¹¦ç±ï¼š" class="headerlink" title="æœ€è¿‘åœ¨çœ‹çš„ä¹¦ç±ï¼š"></a>æœ€è¿‘åœ¨çœ‹çš„ä¹¦ç±ï¼š</h3><ul>
<li>2020.09.23 <a target="_blank" rel="noopener" href="https://github.com/Vonng/ddia">ã€Šè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€‹</a></li>
</ul>
<h3 id="æ›¾ç»çœ‹è¿‡çš„ä¹¦ç±ï¼š"><a href="#æ›¾ç»çœ‹è¿‡çš„ä¹¦ç±ï¼š" class="headerlink" title="æ›¾ç»çœ‹è¿‡çš„ä¹¦ç±ï¼š"></a>æ›¾ç»çœ‹è¿‡çš„ä¹¦ç±ï¼š</h3><h4 id="å·¥å…·ç±»æŠ€æœ¯ä¹¦ç±"><a href="#å·¥å…·ç±»æŠ€æœ¯ä¹¦ç±" class="headerlink" title="å·¥å…·ç±»æŠ€æœ¯ä¹¦ç±"></a>å·¥å…·ç±»æŠ€æœ¯ä¹¦ç±</h4><ul>
<li>ã€ŠDeveloping an ionic Edgeã€‹</li>
<li>ã€ŠAngular JSæƒå¨æ•™ç¨‹ã€‹(Ari Lerner)</li>
<li>ã€ŠOâ€™Reillyï¼šPythonå­¦ä¹ æ‰‹å†Œï¼ˆç¬¬4ç‰ˆï¼‰ã€‹</li>
<li>ã€ŠPython Cookbookï¼ˆç¬¬3ç‰ˆï¼‰ä¸­æ–‡ç‰ˆã€‹</li>
<li>ã€ŠVimä½¿ç”¨æŠ€å·§ã€‹</li>
<li>ã€ŠJAVAç¼–ç¨‹æ€æƒ³ã€‹</li>
<li>ã€ŠJAVAå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</li>
<li>ã€ŠJava JDK 7å­¦ä¹ ç¬”è®°ã€‹</li>
<li><a target="_blank" rel="noopener" href="http://search.dangdang.com/?key=%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%C4%A3%CA%BD">ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ï¼ˆäº¤äº’å¯å‘å¼æ•™å­¦ è°ˆç¬‘é—´è¯¦è§£è®¾è®¡æ¨¡å¼ è®©ä½ çˆ±ä¸é‡Šæ‰‹ï¼‰ã€‹</a> ç¨‹æ°ã€€è‘— </li>
<li><a target="_blank" rel="noopener" href="http://product.dangdang.com/9349959.html">ã€Šç²¾é€šCSS+DIVç½‘é¡µæ ·å¼å¸ƒå±€ã€‹</a>å‰æ²¿ç§‘æŠ€ ç¼–è‘—</li>
</ul>
<h4 id="ä¸šåŠ¡ä¸“ä¸šç›¸å…³"><a href="#ä¸šåŠ¡ä¸“ä¸šç›¸å…³" class="headerlink" title="ä¸šåŠ¡ä¸“ä¸šç›¸å…³"></a>ä¸šåŠ¡ä¸“ä¸šç›¸å…³</h4><ul>
<li>ã€Šæµç¨‹ä¼˜åŒ–ä¸å†é€ ã€‹</li>
</ul>
<h4 id="æ€ç»´æ„å»ºç›¸å…³"><a href="#æ€ç»´æ„å»ºç›¸å…³" class="headerlink" title="æ€ç»´æ„å»ºç›¸å…³"></a>æ€ç»´æ„å»ºç›¸å…³</h4><ul>
<li>ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹</li>
<li>ã€Šå¤§æ•™å ‚ä¸é›†å¸‚ã€‹</li>
<li>ã€Šé‡æ¥ã€‹</li>
<li>ã€Šå¯ç¤ºå½• æ‰“é€ ç”¨æˆ·å–œçˆ±çš„äº§å“ã€‹Marty Caganè‘— ä¸ƒå°éƒ¨è½ è¯‘</li>
<li><a target="_blank" rel="noopener" href="http://search.dangdang.com/?key=%EF%BF%BD%EF%BF%BD0%EF%BF%BD%EF%BF%BD1">ã€Šä»0åˆ°1ï¼šå¼€å¯å•†ä¸šä¸æœªæ¥çš„ç§˜å¯†ã€‹</a>ã€ç¾ã€‘å½¼å¾— è’‚å°” Peter Thiel</li>
<li><a target="_blank" rel="noopener" href="http://product.dangdang.com/23734636.html">ã€Šé‡æ„ æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹</a> ã€ç¾ã€‘Martin Fowlerã€€è‘—ï¼Œç†ŠèŠ‚ã€€è¯‘</li>
<li><a target="_blank" rel="noopener" href="http://product.dangdang.com/22722790.html">ã€ŠJavaScriptæƒå¨æŒ‡å—ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹</a>ï¼ˆç¾ï¼‰å¼—å…°çº³æ ¹ã€€è‘—,æ·˜å®å‰ç«¯å›¢é˜Ÿã€€è¯‘</li>
<li><a target="_blank" rel="noopener" href="http://product.dangdang.com/20848036.html">ã€Šå¹²æ³•ã€‹</a> ã€æ—¥ã€‘ç¨»ç››å’Œå¤«ã€€è‘—ï¼Œæ›¹å²«äº‘ã€€è¯‘ã€€</li>
<li><a target="_blank" rel="noopener" href="http://product.dangdang.com/21032154.html">ã€Šå¤±æ§ã€‹</a> å‡¯æ–‡å‡¯åˆ©ã€€è‘—ï¼Œä¸œè¥¿æ–‡åº“ã€€è¯‘</li>
</ul>
<h4 id="ç”Ÿæ´»å‘å¯¼"><a href="#ç”Ÿæ´»å‘å¯¼" class="headerlink" title="ç”Ÿæ´»å‘å¯¼"></a>ç”Ÿæ´»å‘å¯¼</h4><ul>
<li>ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹(è·¯é¥)</li>
<li>ã€Šå°¼å¤æ‹‰.ç‰¹æ–¯æ‹‰ä¼ ã€‹(Steve Law)</li>
</ul>
<h3 id="è¦çœ‹çš„ä¹¦ç±"><a href="#è¦çœ‹çš„ä¹¦ç±" class="headerlink" title="è¦çœ‹çš„ä¹¦ç±"></a>è¦çœ‹çš„ä¹¦ç±</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.amazon.cn/%E9%9B%86%E8%A3%85%E7%AE%B1%E6%94%B9%E5%8F%98%E4%B8%96%E7%95%8C-%E9%A9%AC%E5%85%8B%C2%B7%E8%8E%B1%E6%96%87%E6%A3%AE/dp/B00HE1PK58/ref=sr_1_1?s=books&ie=UTF8&qid=1442883290&sr=1-1&keywords=%E9%9B%86%E8%A3%85%E7%AE%B1%E6%94%B9%E5%8F%98%E4%B8%96%E7%95%8C">ã€Šé›†è£…ç®±æ”¹å˜ä¸–ç•Œã€‹</a> <blockquote>
<p>æœ¬ä¹¦ä»é›†è£…ç®±çš„å‘æ˜å²å¨“å¨“é“æ¥ï¼Œå°†ä¸€ä¸ªçœ‹ä¼¼å¹³å‡¡çš„ä¸»é¢˜è¡å˜æˆä¸€ä¸ªä¸ªéåŒå¯»å¸¸çš„æœ‰è¶£æ•…äº‹ï¼Œå±•ç°äº†ä¸€é¡¹æŠ€æœ¯çš„è¿›æ­¥æ˜¯å¦‚ä½•æ”¹å˜ä¸–ç•Œç»æµå½¢æ€çš„ã€‚å®ƒçš„ä»·å€¼ä¸åœ¨äºæ˜¯ä»€ä¹ˆï¼Œè€Œåœ¨äºæ€æ ·ä½¿ç”¨ã€‚åœ¨é›†è£…ç®±å‡ºç°ä¹‹å‰ï¼Œç¾å›½çš„æ²ƒå°”ç›ã€æ³•å›½çš„æˆè¡£ç»å¯¹ä¸ä¼šéåœ°å¼€èŠ±ã€‚è€Œåœ¨é›†è£…ç®±å‡ºç°ä¹‹åï¼Œè´§è¿å˜å¾—å¦‚æ­¤ä¾¿å®œï¼Œä»¥è‡³äºæŸä»¶äº§å“äº§è‡ªä¸œåŠçƒï¼Œè¿è‡³çº½çº¦é”€å”®ï¼Œè¿œæ¯”åœ¨çº½çº¦è¿‘éƒŠç”Ÿäº§è¯¥äº§å“æ¥å¾—åˆ’ç®—ã€‚ä¸­å›½ä¹Ÿä»æ­¤ç™»ä¸Šå›½é™…é›†è£…ç®±æµ·è¿å’Œä¸–ç•Œå·¥å‚çš„èˆå°ã€‚è¯»è€…åœ¨äº«å—é˜…è¯»çš„åŒæ—¶ï¼Œè¿˜ä¼šæœ‰è¶£åœ°å‘ç°ï¼Œå³ä¾¿æ˜¯ä¸€ä¸ªç®€å•çš„åˆ›æ–°ï¼Œä¹Ÿä¼šå½»åº•æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»</p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/10/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6/" data-id="cl7mgnxtt000vt2za2mnc1f5g" data-title="ä¸ªäººä¹¦æ¶" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/10/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/10/%E6%88%91%E7%9A%84%E4%B9%A6%E6%9E%B6/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/book/" rel="tag">book</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-Linux sedå‘½ä»¤ä¸awkå‘½ä»¤" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/06/Linux%20sed%E5%91%BD%E4%BB%A4%E4%B8%8Eawk%E5%91%BD%E4%BB%A4/" class="article-date">
  <time class="dt-published" datetime="2015-09-05T16:00:00.000Z" itemprop="datePublished">2015-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/">æ‰©å±•çŸ¥è¯†</a>â–º<a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/06/Linux%20sed%E5%91%BD%E4%BB%A4%E4%B8%8Eawk%E5%91%BD%E4%BB%A4/">sed,awk</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Linux shellç¼–ç¨‹ä»åˆå­¦åˆ°ç²¾é€š </p>
<blockquote>
<p>æœ€è¿‘å·¥ä½œæ—¶é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æŸ¥çœ‹è¿›è¡Œæ—¶ï¼ŒåªæŸ¥çœ‹æŸäº›è¿›è¡Œçš„è¿›ç¨‹å·ï¼Œè‹¥ç›´æ¥ç”¨ps aux|grep sms  è¿™æ ·ä¼šå¾—åˆ°ä¸€å¤§å †çš„ä¸œä¸œï¼Œæ‰€ä»¥åŒäº‹æ¨èç”¨awk,åŒ<br>æ—¶ä¹ŸæåŠäº†sedã€‚</p>
</blockquote>
<blockquote>
<p>è¿™é‡ŒæŠ½æ—¶é—´å¯¹è¿™ä¸¤ä¸ªå‘½ä»¤åšä¸€ä¸ªæ€»ç»“ï¼Œä»…ä¸ºä¸ªäººå­¦ä¹ å·¥ä½œæ‰€ç”¨ã€‚</p>
</blockquote>
<p>##sedã€awkæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<pre><code>å®ƒä»¬æ˜¯linux\unixç³»ç»Ÿä¸­çš„ä¸¤ç§åŠŸèƒ½å¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ã€‚</code></pre>
<ul>
<li>æœ‰ä¸€ä¸ªsedçš„ç¼–è¾‘å™¨ï¼Œæ‰æœ‰äº†sedï¼ˆstream editorï¼‰è¿™ä¸ªåå­—,å®ƒæ˜¯ä¸€ä¸ªå°†ä¸€ç³»åˆ—ç¼–è¾‘å‘½ä»¤ä½œç”¨äºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„ç†æƒ³å·¥å…·ã€‚</li>
<li>ç”±äºåˆ›å»ºawkçš„ä¸‰ä¸ªä½œè€…åç§° æ˜¯Ahoã€Weinbergerå’ŒKernighanï¼Œæ‰€ä»¥å¾—åä¸ºAWK,æ˜¯ä¸€ç§èƒ½å¤Ÿå¯¹ç»“æ„åŒ–æ•°æ®è¿›è¡Œæ“ä½œå¹¶äº§ç”Ÿæ ¼å¼åŒ–æŠ¥è¡¨çš„ç¼–ç¨‹è¯­è¨€ã€‚</li>
</ul>
<p>##sedçš„ä½¿ç”¨</p>
<p>###ä½¿ç”¨åœºåˆ</p>
<ul>
<li>ç¼–è¾‘ç›¸å¯¹äº¤äº’å¼å¹¿è¥¿ç¼–è¾‘å™¨è€Œè¨€å¤ªå¤§çš„æ–‡ä»¶</li>
<li>ç¼–è¾‘å‘½ä»¤å¤ªå¤æ‚ï¼Œåœ¨äº¤äº’å¼æ–‡æœ¬ç¼–è¾‘å™¨ä¸­éš¾ä»¥è¾“å…¥çš„æƒ…å†µ</li>
<li>å¯¹æ–‡ä»¶æ‰«æä¸€éï¼Œä½†æ˜¯éœ€è¦æ‰§è¡Œå¤šä¸ªç¼–è¾‘å‡½æ•°çš„æƒ…å†µ</li>
</ul>
<p>sedåªå¯¹ç¼“å†²åŒºä¸­çš„åŸå§‹æ–‡ä»¶çš„å‰¯æœ¬è¿›è¡Œç¼–è¾‘ï¼Œå¹¶ä¸ç¼–è¾‘åŸå§‹çš„æ–‡ä»¶ã€‚soï¼Œè‹¥è¦ä¿å­˜ä¸ªæ€§åçš„æ–‡ä»¶ï¼Œå‹æ ¹å°†è¾“å‡ºé‡å®šå‘åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚ï¼š</p>
<pre><code>sed &#39;sed command&#39; source-file &gt; target-file</code></pre>
<p>###è°ƒç”¨æ–¹å¼<br><code>å¦‚ä½•æ²¡æœ‰æŒ‡å®šè¾“å…¥æ–‡ä»¶sedå°†ä»æ ‡å‡†è¾“å…¥ä¸­æ¥å—è¾“å…¥</code></p>
<ul>
<li><p>åœ¨shellå‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤è°ƒç”¨sedï¼Œæ ¼å¼ä¸ºï¼š</p>
<p>  sed [option] â€˜sed commandâ€™ è¾“å…¥æ–‡ä»¶<br><code>æ³¨æ„æ­¤å¤„ä¸ºå•å¼•å·å°†å‘½ä»¤å¼•èµ·æ¥</code></p>
</li>
<li><p>å°†sedå‘½ä»¤æ’å…¥è„šæœ¬æ–‡ä»¶åï¼Œç„¶åé€šè¿‡sedå‘½ä»¤è°ƒç”¨å®ƒï¼Œæ ¼å¼ä¸ºï¼š</p>
<p>  sed [option] -f sedè„šæœ¬æ–‡ä»¶ è¾“å…¥æ–‡ä»¶</p>
</li>
<li><p>å°†sedå‘½ä»¤æ’å…¥è„šæœ¬æ–‡ä»¶åï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯è®¾ç½®è¯¥è„šæœ¬æ–‡ä»¶ä¸ºå¯æ‰§è¡Œï¼Œç„¶åç›´æ¥æ‰§è¡Œè¯¥è„šæœ¬ï¼Œæ ¼å¼ä¸ºï¼š</p>
<p>  ./sedè„šæœ¬æ–‡ä»¶ è¾“å…¥æ–‡ä»¶</p>
</li>
</ul>
<p><code>ä½†æ­¤å‘½ä»¤è„šæœ¬æ–‡ä»¶ï¼Œåº”è¯¥ä»¥sha-bang(#!)å¼€å¤´ï¼Œsha-bangåé¢æ˜¯è§£æè¿™ä¸ªè„šæœ¬çš„ç¨‹åºåã€‚</code></p>
<p>####sedå‘½ä»¤é€‰é¡¹åŠå…¶æ„ä¹‰</p>
<ul>
<li>-n:ä¸æ‰“å°æ‰€æœ‰è¡Œåˆ°æ ‡å‡†è¾“å‡º</li>
<li>-e:å°†ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºsedç¼–è¾‘å‘½ä»¤ï¼Œå¦‚æœåªä¼ é€’ä¸€ä¸ªç¼–è¾‘å‘½ä»¤ç»™sedï¼Œ-eé€‰é¡¹å¯ä»¥çœç•¥</li>
<li>-f:è¡¨ç¤ºæ­£åœ¨è°ƒç”¨sedè„šæœ¬æ–‡ä»¶</li>
</ul>
<p>###å‘½ä»¤ç»„æˆæ–¹å¼</p>
<pre><code>å®šä½æ–‡æœ¬è¡Œå’Œç¼–è¾‘å‘½ä»¤ä¸¤éƒ¨åˆ†ç»„æˆ</code></pre>
<p>####å®šä½æ–‡æœ¬</p>
<ul>
<li>ä½¿ç”¨è¡Œå·ï¼ŒæŒ‡å®šä¸€è¡Œï¼Œæˆ–æŒ‡å®šè¡Œå·èŒƒå›´</li>
<li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</li>
</ul>
<p><code>ä¸‹é¢æ˜¯sedå‘½ä»¤å®šä½æ–‡æœ¬çš„æ–¹æ³•</code></p>
<ul>
<li>x ä¸ºæŒ‡å®šçš„è¡Œå·</li>
<li>xï¼Œy æŒ‡å®šè¡Œå·èŒƒå›´</li>
<li>/pattern/ æŸ¥è¯¢åŒ…å«æ¨¡å¼çš„è¡Œ</li>
<li>/pattern/pattern/ æŸ¥è¯¢åŒ…å«ä¸¤ä¸ªæ¨¡å¼çš„è¡Œ</li>
<li>/pattern/ï¼Œx ä»ä¸æ¨¡å¼åŒ¹é…åˆ°xå·è¡Œä¹‹é—´çš„è¡Œ  åä¹‹ç±»ä¼¼</li>
<li>xï¼Œyï¼æŸ¥è¯¢ä¸åŒ…æ‹¬xå’Œyè¡Œå·çš„è¡Œ</li>
</ul>
<p>####å¸¸ç”¨ç¼–è¾‘å‘½ä»¤</p>
<ul>
<li>p æ‰“å°åŒ¹é…è¡Œ</li>
<li>= æ‰“å°æ–‡ä»¶è¡Œå·</li>
<li>a\ åœ¨å®šä½è¡Œå·ä¹‹åè¿½åŠ æ–‡æœ¬ä¿¡æ¯</li>
<li>i\ åœ¨å®šä»¬è¡Œå·ä¹‹å‰æ’å…¥æ–‡æœ¬ä¿¡æ¯</li>
<li>d åˆ é™¤å®šä½è¡Œ</li>
<li>c\ ç”¨æ–°æ–‡æœ¬æ›¿æ¢å®šä½æ–‡æœ¬</li>
<li>s ä½¿ç”¨æ›¿æ¢æ¨¡å¼æ›¿æ¢ç›¸åº”æ¨¡å¼</li>
<li>r ä»å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å¹¿è¥¿</li>
<li>w å°†æ–‡æœ¬å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶</li>
<li>y å˜æ¢å­—ç¬¦</li>
<li>q ç¬¬ä¸€ä¸ªæ¨¡å¼åŒ¹é…å®Œæˆåé€€å‡º</li>
<li>l æ˜¾ç¤ºä¸å…«è¿›åˆ¶ASCIIç ç­‰ä»·çš„æ§åˆ¶å­—ç¬¦</li>
<li>{} åœ¨å®šä½è¡Œæ‰§è¡Œçš„å‘½ä»¤ç»„</li>
<li>n è¯»å–ä¸‹ä¸€ä¸ªè¾“å…¥è¡Œï¼Œç”¨ä¸‹ä¸€ä¸ªå‘½ä»¤å¤„ç†æ–°çš„è¡Œ</li>
<li>h å°†æ¨¡å¼ç¼“å†²åŒºçš„æ–‡æœ¬å¤åˆ¶åˆ°ä¿æŒç¼“å†²åŒº</li>
<li>H å°†æ¨¡å¼ç¼“å†²åŒºçš„æ–‡æœ¬è¿½åŠ åˆ°ä¿æŒç¼“å†²åŒº</li>
<li>x äº’æ¢æ¨¡å¼ç¼“å†²åŒºå’Œä¿æŒç¼“å†²åŒºçš„å†…å®¹</li>
<li>g å°†ä¿æŒç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°æ¨¡å¼ç¼“å†²åŒº</li>
<li>G å°†ä¿æŒç¼“å†²åŒºçš„å†…å®¹è¿½åŠ åˆ°æ¨¡å¼ç¼“å†²åŒº</li>
</ul>
<p>###å®ä¾‹<br>æˆ‘ä»¬å°±ç”¨ä¸‹é¢è¿™ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºäº‹ä¾‹å‚è€ƒï¼š</p>
<pre><code>#!/usr/bin/env python
import os
import sys

if __name__ == &quot;__main__&quot;:
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)

    from django.core.management import execute_from_command_line

    execute_from_command_line(sys.argv)</code></pre>
<h4 id="n-é€‰é¡¹çš„ä½¿ç”¨"><a href="#n-é€‰é¡¹çš„ä½¿ç”¨" class="headerlink" title="-n é€‰é¡¹çš„ä½¿ç”¨"></a>-n é€‰é¡¹çš„ä½¿ç”¨</h4><ul>
<li>ä½¿ç”¨-n ä¸è¾“å‡ºæ‰€æœ‰çš„å†…å®¹  1p è¾“å‡ºç¬¬ä¸€è¡Œ</li>
</ul>
<pre><code>âœ  linuxstudy  sed -n &#39;1p&#39; manage.py2
#!/usr/bin/env python</code></pre>
<ul>
<li>æ‰“å°3åˆ°6è¡Œ</li>
</ul>
<pre><code>âœ  linuxstudy  sed -n &#39;3,6p&#39; manage.py2
import sys

if __name__ == &quot;__main__&quot;:
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)</code></pre>
<ul>
<li>æ¨¡å¼åŒ¹é…</li>
</ul>
<pre><code>âœ  linuxstudy  sed -n &#39;/environ/p&#39; manage.py2
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)</code></pre>
<h4 id="e-é€‰é¡¹çš„ä½¿ç”¨"><a href="#e-é€‰é¡¹çš„ä½¿ç”¨" class="headerlink" title="- e é€‰é¡¹çš„ä½¿ç”¨"></a>- e é€‰é¡¹çš„ä½¿ç”¨</h4><ul>
<li>æ‰“å°è¡Œå·ï¼š</li>
</ul>
<pre><code>    âœ  linuxstudy  sed -n &#39;/env/=&#39; manage.py2
    1
    6

æ·»åŠ eé€‰é¡¹ï¼š

    âœ  linuxstudy  sed -n -e &#39;/env/p&#39; -e &#39;/env/=&#39; manage.py2 
    #!/usr/bin/env python
    1
        os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)
    6

    `sedä¸æ”¯æŒå¤šä¸ªç¼–è¾‘å‘½ä»¤çš„ç”¨æ³•ï¼Œå¸¦å¤šä¸ªç¼–è¾‘å‘½ä»¤çš„ç”¨æ³•ï¼Œä¸€èˆ¬æ ¼å¼ä¸ºï¼š`

    sed [option] -e ç¼–è¾‘å‘½ä»¤ -e ç¼–è¾‘å‘½ä»¤ ... -e ç¼–è¾‘å‘½ä»¤ è¾“å…¥æ–‡ä»¶

    å°†ä¸‹é¢å‘½ä»¤æ“ä½œå­˜æ”¾åˆ°ä¸€ä¸ªåç¼€ä¸º.sedçš„æ–‡ä»¶ä¸­ï¼Œè®©å…¶å¯æ‰§è¡Œ
    #!/usr/bin/sed -f 
    /command/a\
    we append a new line</code></pre>
<h4 id="sedæ–‡æœ¬å®šä½"><a href="#sedæ–‡æœ¬å®šä½" class="headerlink" title="sedæ–‡æœ¬å®šä½"></a>sedæ–‡æœ¬å®šä½</h4><ul>
<li>åŒ¹é…å…ƒå­—ç¬¦ $å’Œ.</li>
</ul>
<pre><code>    âœ  linuxstudy  sed -n &#39;/\./p&#39; manage.py2
        os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)
        from django$.core.management import execute_from_command_line
        execute_from_command_line(sys.argv)
    âœ  linuxstudy  sed -n &#39;/\$/p&#39; manage.py2
        from django$.core.management import execute_from_command_line</code></pre>
<ul>
<li>å…ƒå­—ç¬¦è¿›è¡ŒåŒ¹é…</li>
</ul>
<pre><code>    $åœ¨æ­£åˆ™ä¸­è¡¨ç¤ºè¡Œå°¾ï¼Œä½†åœ¨è¿™é‡Œè¡¨ç¤ºæœ€åä¸€è¡Œ
    sedçš„åŸºæœ¬å‘½ä»¤ï¼Œå¯ä»¥æ”¾åœ¨å•å¼•å·å¤–æˆ–å†…éƒ½è¡Œï¼Œæ ¹æ®è‡ªå·±çš„ä¹ æƒ¯
    âœ  linuxstudy  sed  &#39;$p&#39; manage.py2 å¾—å–æœ€åä¸€è¡Œ

    âœ  linuxstudy sed  -n &#39;/.*line/p&#39; manage.py2 æ‰¾å‡ºä»¥lineç»“å°¾çš„è¡Œ</code></pre>
<ul>
<li><p>! ç¬¦å·ï¼Œè¡¨ç¤ºå–åï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºæ¨¡å¼åŒ¹é…çš„å–å</p>
<pre><code>  âœ  linuxstudy  sed -n &#39;2,4!p&#39; manage.py2 ä¸æ‰“å°2åˆ°4è¡Œ </code></pre>
</li>
<li><p>ä½¿ç”¨è¡Œå·ä¸å…³é”®å­—åŒ¹é…é™å®šè¡ŒèŒƒå›´</p>
<pre><code>  /pattern/,xå’Œx,/pattern/ è¿™ä¸¤ç§å½¢å¼å…¶å®ä¸x,yä¸€æ ·çš„ï¼Œåªæ˜¯å°†xæˆ–yä»£æ›¿ç½¢äº†

  âœ  linuxstudy  sed -n &#39;4,/mana/p&#39; manage.py2  å¾—åˆ°çš„æ˜¯ä»ç¬¬å››è¡Œèµ·åˆ°ä¸manaåŒ¹é…çš„è¡Œçš„å†…å®¹

  if __name__ == &quot;__main__&quot;:
      os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;hwbuluo.settings&quot;)

      from django$.core.management import execute_from_command_line</code></pre>
</li>
</ul>
<h4 id="sedæ–‡æœ¬ç¼–è¾‘"><a href="#sedæ–‡æœ¬ç¼–è¾‘" class="headerlink" title="sedæ–‡æœ¬ç¼–è¾‘"></a>sedæ–‡æœ¬ç¼–è¾‘</h4><ul>
<li><p>æ’å…¥æ–‡æœ¬    i\</p>
<pre><code>  åœ¨åŒ¹é…è¡Œçš„å‰ç«¯æ’å…¥
  sed &#39;å®šä½i\text&#39; æ–‡ä»¶

  ä¿®æ”¹ä¸Šé¢çš„è¿½åŠ è„šæœ¬ï¼š
  #!/usr/bin/sed -f 
  /command/i\
  we append a new line</code></pre>
</li>
<li><p>ä¿®æ”¹æ–‡æœ¬ modify.sed    c\</p>
<pre><code>  -------------------
  #!/usr/bin/sed -f

  /command/c\
  I modify the file.
  -------------------

  æ‰§è¡Œï¼š./modify.sed</code></pre>
</li>
<li><p>åˆ é™¤æ–‡æœ¬  d  ä¸è¿½åŠ å’Œæ’å…¥ä¿®æ”¹æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œåœ¨åé¢ä¸éœ€è¦æ·»åŠ \</p>
<pre><code>  sed &#39;1,3d&#39; manage.py2</code></pre>
</li>
<li><p>æ›¿æ¢æ–‡æœ¬ æ›¿æ¢æ–‡æœ¬ä¸ä¿®æ”¹æ–‡æœ¬ç±»ä¼¼ï¼Œåªæ˜¯ä¿®æ”¹æ˜¯å¯¹ä¸€æ•´è¡Œçš„ä¸ªæ€§ï¼Œæ›¿æ¢åˆ™æ˜¯å¯¹å±€éƒ¨è¿›è¡Œä¿®æ”¹</p>
<pre><code>  s/è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²/[æ›¿æ¢é€‰é¡¹]

  æ›¿æ¢é€‰é¡¹åŠæ„ä¹‰ï¼š
      g:æ›¿æ¢æ–‡æœ¬ä¸­æ‰€æœ‰å‡ºç°è¢«æ›¿æ¢å­—ç¬¦ä¸²ä¹‹å¤„,è‹¥ä¸ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œåˆ™åªæ›¿æ¢æ¯è¡Œçš„ç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šçš„å­—ç¬¦ä¸²
      p:ä¸-né€‰é¡¹ç»“åˆï¼Œåªæ‰“å°æ›¿æ¢è¡Œ
      w æ–‡ä»¶å:è¡¨ç¤ºå°†è¾“å‡ºå®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶

  âœ  linuxstudy  sed -n &#39;s/command/============/p&#39; manage.py2 
      from django$.core.management import execute_from_============_line
      execute_from_============_line(sys.argv)

  ä¹Ÿå¯ä»¥ linuxstudy  sed -n &#39;s/command/============/2p&#39; manage.py2   æ¥æ›¿æ¢æ¯è¡Œå‡ºç°çš„ç¬¬å‡ ä¸ª </code></pre>
</li>
</ul>
<ul>
<li></li>
</ul>
<p>##<a target="_blank" rel="noopener" href="http://www.cnblogs.com/chengmo/archive/2010/10/08/1845913.html">awkçš„ä½¿ç”¨</a></p>
<p>###ä½¿ç”¨åœºåˆ<br>###è°ƒç”¨æ–¹å¼<br>###å®ä¾‹</p>
<pre><code>awk -F &#39;:&#39; &#39;BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;;END &#123;for (i=0;i&lt;NR;i++) print i,name[i]&#125;&#39;   /etc/passwd

0 root
1 daemon
2 bin
3 sys
4 sync
5 games
6 man
7 lp
8 mail

ls -l |awk &#39;BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print &quot;[end]size is&quot;,size/1024/1024 ,&quot;M&quot;&#125;&#39;

[end]size is 0.098505 M</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/06/Linux%20sed%E5%91%BD%E4%BB%A4%E4%B8%8Eawk%E5%91%BD%E4%BB%A4/" data-id="cl7mgnxts000mt2za3smzdnl7" data-title="sed,awk" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/06/Linux%20sed%E5%91%BD%E4%BB%A4%E4%B8%8Eawk%E5%91%BD%E4%BB%A4/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/06/Linux%20sed%E5%91%BD%E4%BB%A4%E4%B8%8Eawk%E5%91%BD%E4%BB%A4/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-è¿ç»´çŸ¥è¯†æ€»ç»“" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/06/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2015-09-05T16:00:00.000Z" itemprop="datePublished">2015-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/">æ‰©å±•çŸ¥è¯†</a>â–º<a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/06/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">å¸¸ç”¨è¿ç»´çŸ¥è¯†å¤§æ‚çƒ©</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>##æ—¥å¸¸ç³»ç»Ÿæ“ä½œ</p>
<ul>
<li>å°†è¿œç¨‹æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</li>
</ul>
<pre><code>    scp username@ip:remote_filepath /local_dir</code></pre>
<ul>
<li><p>åŒæ­¥ç›®å½•</p>
<pre><code>  rsync -avzr 172.xx.xx.11:/opt/jagent/tomcat* .

  sudo chown -R fsdevops.fsdevops sms-service/</code></pre>
</li>
<li><p><a target="_blank" rel="noopener" href="http://bian5399.blog.51cto.com/3848702/963662">linux æœ€å¤§æ–‡ä»¶é™åˆ¶æ•° ulimit</a></p>
<pre><code>  ulimit -n</code></pre>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/likehua/p/3831331.html">èµ„æºæš‚æ—¶ä¸å¯ç”¨ï¼Œèµ„æºå·²è€—å°½</a></p>
<pre><code>    $ ps
        -bash: fork: retry: èµ„æºæš‚æ—¶ä¸å¯ç”¨
        -bash: fork: retry: èµ„æºæš‚æ—¶ä¸å¯ç”¨
        -bash: fork: retry: èµ„æºæš‚æ—¶ä¸å¯ç”¨
        -bash: fork: retry: èµ„æºæš‚æ—¶ä¸å¯ç”¨

    ITç»„å“¥ä»¬åˆ†æè¯´æ˜¯æ¯ä¸ªç”¨æˆ·å¥æŸ„æ•°åªæœ‰1024ä¸ªï¼Œç›®å‰è¶…äº†

    ulimit -a å³å¯æŸ¥è¯¢linuxç›¸å…³çš„å‚æ•°     </code></pre>
</li>
<li><p>æŸ¥çœ‹è¿›ç¨‹å·</p>
</li>
</ul>
<pre><code>    ps aux|grep sms|awk -F  &#39; &#39; &#39;&#123;print $2&#125;&#39;

    ps aux|grep sms|awk -F  &#39; &#39; &#39;&#123;kill $2&#125;&#39;</code></pre>
<ul>
<li>grepçš„ä½¿ç”¨</li>
</ul>
<pre><code>    cat rmq_bk_gc.log|grep -E -o &#39;\w+&#39;|sort|uniq -c|sort -k 2,1
    -E æ­£åˆ™
    -o è¾“å‡º -O æ ‡ç¤ºå‡º 
    sortæ’åº
    uniq group</code></pre>
<ul>
<li><p>å¼ºåˆ¶ç”¨sudoä¿å­˜</p>
<pre><code>  :w !sudo tee %</code></pre>
</li>
<li><p>è®¾ç½®æœåŠ¡è‡ªå¯åŠ¨</p>
<p>  chkconfig</p>
</li>
<li><p>æŸ¥çœ‹æŸç«¯å£è¢«è°å ç”¨</p>
<pre><code>   netstat -apn
   netstat -apn|grep 8013
   ps -aux | grep 33514/java</code></pre>
</li>
<li><p>æŸ¥çœ‹æ–‡ä»¶å ç”¨<br>  du -hs .</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/ggjucheng/archive/2012/01/14/2322659.html">ç›‘è§†æŒ‡å®šç½‘ç»œçš„æ•°æ®åŒ…</a></p>
<pre><code>   ç›‘è§†æŒ‡å®šä¸»æœºå’Œç«¯å£çš„æ•°æ®åŒ…      
   tcpdump tcp port 23 and host 210.27.48.1</code></pre>
</li>
<li><p>é˜²ç«å¢™</p>
<pre><code>    hostname
    iptables -t filter -I INPUT -p tcp --dport 27107 -m state --state NEW -j ACCEPT

    sudo iptables -A INPUT -p tcp --dport 13710 -j ACCEPT
    sudo iptables -A OUTPUT -p tcp --sport 13710 -j ACCEPT

    service iptables save
    vim /etc/puppet/puppet.conf 

    service puppet restart
    iptables -L
    more /etc/sysconfig/iptables
    vim /etc/sysconfig/iptables
    service iptables reload</code></pre>
</li>
</ul>
<pre><code>      åœæ­¢é˜²ç«å¢™

      sudo su
      service iptables stop</code></pre>
<ul>
<li><p>å®‰è£…telnet</p>
<pre><code>    yum install -y telnet</code></pre>
</li>
<li><p>æŸ¥è¯¢æŸç±»æ–‡ä»¶</p>
<pre><code>    grep netty -R .</code></pre>
</li>
</ul>
<ul>
<li><p>æŸ¥çœ‹å†…å­˜</p>
<pre><code>    free </code></pre>
</li>
<li><p>curl å‘é€è¯·æ±‚</p>
<pre><code>  ç›®çš„1ï¼šé€šè¿‡è„šæœ¬å‘é€postè¯·æ±‚ã€‚
  ç­”æ¡ˆï¼š curl -d &quot;leaderboard_id=7778a8143f111272&amp;score=19&amp;app_key=8d49f16fe034b98b&amp;_test_user=test01&quot; &quot;http://172.16.102.208:8089/wiapi/score&quot;

  ç›®çš„2ï¼šé€šè¿‡è„šæœ¬å‘é€postè¯·æ±‚ï¼Œé¡ºä¾¿é™„å¸¦æ–‡æœ¬æ•°æ®ï¼Œæ¯”å¦‚é€šè¿‡&quot;æµè§ˆ&quot;é€‰æ‹©æœ¬åœ°çš„card.txtå¹¶ä¸Šä¼ å‘é€postè¯·æ±‚
  ç­”æ¡ˆï¼š  curl  -F &quot;blob=@card.txt;type=text/plain&quot;  &quot;http://172.16.102.208:8089/wiapi/score?leaderboard_id=7778a8143f111272&amp;score=40&amp;app_key=8d49f16fe034b98b&amp;_test_user=test01&quot;   </code></pre>
</li>
<li><p>sshå…å¯†ç ç™»é™†</p>
</li>
</ul>
<pre><code>ssh-keygen -t rsa -P &#39;&#39;

å°†ç”Ÿæˆçš„æ–‡ä»¶æ‹·åˆ°ç›®æ ‡ä¸»æœºï¼Œäº¤æ·»åŠ åˆ°keysæ–‡ä»¶ä¸­

cat sshnopw.pub &gt;&gt; /root/.ssh/authorized_keys</code></pre>
<ul>
<li>vmstat  ç›¸æ¯”topï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æ•´ä¸ªæœºå™¨çš„CPU,å†…å­˜,IOçš„ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸æ˜¯å•å•çœ‹åˆ°å„ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨ç‡</li>
</ul>
<pre><code>    2è¡¨ç¤ºæ¯ä¸ªä¸¤ç§’é‡‡é›†ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€ï¼Œ1è¡¨ç¤ºåªé‡‡é›†ä¸€æ¬¡ã€‚
    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
     r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
     0  0      0 779304  67972 706748    0    0   135    45  538 1117 10  3 86  2  0

     r è¡¨ç¤ºè¿è¡Œé˜Ÿåˆ—(å°±æ˜¯è¯´å¤šå°‘ä¸ªè¿›ç¨‹çœŸçš„åˆ†é…åˆ°CPU)ï¼Œæˆ‘æµ‹è¯•çš„æœåŠ¡å™¨ç›®å‰CPUæ¯”è¾ƒç©ºé—²ï¼Œæ²¡ä»€ä¹ˆç¨‹åºåœ¨è·‘ï¼Œå½“è¿™ä¸ªå€¼è¶…è¿‡äº†CPUæ•°ç›®ï¼Œå°±ä¼šå‡ºç°CPUç“¶é¢ˆäº†ã€‚è¿™ä¸ªä¹Ÿå’Œtopçš„è´Ÿè½½æœ‰å…³ç³»ï¼Œä¸€èˆ¬è´Ÿè½½è¶…è¿‡äº†3å°±æ¯”è¾ƒé«˜ï¼Œè¶…è¿‡äº†5å°±é«˜ï¼Œè¶…è¿‡äº†10å°±ä¸æ­£å¸¸äº†ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€å¾ˆå±é™©ã€‚topçš„è´Ÿè½½ç±»ä¼¼æ¯ç§’çš„è¿è¡Œé˜Ÿåˆ—ã€‚å¦‚æœè¿è¡Œé˜Ÿåˆ—è¿‡å¤§ï¼Œè¡¨ç¤ºä½ çš„CPUå¾ˆç¹å¿™ï¼Œä¸€èˆ¬ä¼šé€ æˆCPUä½¿ç”¨ç‡å¾ˆé«˜ã€‚

     b è¡¨ç¤ºé˜»å¡çš„è¿›ç¨‹,è¿™ä¸ªä¸å¤šè¯´ï¼Œè¿›ç¨‹é˜»å¡ï¼Œå¤§å®¶æ‡‚çš„ã€‚

     swpd è™šæ‹Ÿå†…å­˜å·²ä½¿ç”¨çš„å¤§å°ï¼Œå¦‚æœå¤§äº0ï¼Œè¡¨ç¤ºä½ çš„æœºå™¨ç‰©ç†å†…å­˜ä¸è¶³äº†ï¼Œå¦‚æœä¸æ˜¯ç¨‹åºå†…å­˜æ³„éœ²çš„åŸå› ï¼Œé‚£ä¹ˆä½ è¯¥å‡çº§å†…å­˜äº†æˆ–è€…æŠŠè€—å†…å­˜çš„ä»»åŠ¡è¿ç§»åˆ°å…¶ä»–æœºå™¨ã€‚

     free   ç©ºé—²çš„ç‰©ç†å†…å­˜çš„å¤§å°ï¼Œæˆ‘çš„æœºå™¨å†…å­˜æ€»å…±8Gï¼Œå‰©ä½™3415Mã€‚

     buff   Linux/Unixç³»ç»Ÿæ˜¯ç”¨æ¥å­˜å‚¨ï¼Œç›®å½•é‡Œé¢æœ‰ä»€ä¹ˆå†…å®¹ï¼Œæƒé™ç­‰çš„ç¼“å­˜ï¼Œæˆ‘æœ¬æœºå¤§æ¦‚å ç”¨300å¤šM

     cache cacheç›´æ¥ç”¨æ¥è®°å¿†æˆ‘ä»¬æ‰“å¼€çš„æ–‡ä»¶,ç»™æ–‡ä»¶åšç¼“å†²ï¼Œæˆ‘æœ¬æœºå¤§æ¦‚å ç”¨300å¤šM(è¿™é‡Œæ˜¯Linux/Unixçš„èªæ˜ä¹‹å¤„ï¼ŒæŠŠç©ºé—²çš„ç‰©ç†å†…å­˜çš„ä¸€éƒ¨åˆ†æ‹¿æ¥åšæ–‡ä»¶å’Œç›®å½•çš„ç¼“å­˜ï¼Œæ˜¯ä¸ºäº†æé«˜ ç¨‹åºæ‰§è¡Œçš„æ€§èƒ½ï¼Œå½“ç¨‹åºä½¿ç”¨å†…å­˜æ—¶ï¼Œbuffer/cachedä¼šå¾ˆå¿«åœ°è¢«ä½¿ç”¨ã€‚)

     si  æ¯ç§’ä»ç£ç›˜è¯»å…¥è™šæ‹Ÿå†…å­˜çš„å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äº0ï¼Œè¡¨ç¤ºç‰©ç†å†…å­˜ä¸å¤Ÿç”¨æˆ–è€…å†…å­˜æ³„éœ²äº†ï¼Œè¦æŸ¥æ‰¾è€—å†…å­˜è¿›ç¨‹è§£å†³æ‰ã€‚æˆ‘çš„æœºå™¨å†…å­˜å……è£•ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚

     so  æ¯ç§’è™šæ‹Ÿå†…å­˜å†™å…¥ç£ç›˜çš„å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äº0ï¼ŒåŒä¸Šã€‚

     bi  å—è®¾å¤‡æ¯ç§’æ¥æ”¶çš„å—æ•°é‡ï¼Œè¿™é‡Œçš„å—è®¾å¤‡æ˜¯æŒ‡ç³»ç»Ÿä¸Šæ‰€æœ‰çš„ç£ç›˜å’Œå…¶ä»–å—è®¾å¤‡ï¼Œé»˜è®¤å—å¤§å°æ˜¯1024byteï¼Œæˆ‘æœ¬æœºä¸Šæ²¡ä»€ä¹ˆIOæ“ä½œï¼Œæ‰€ä»¥ä¸€ç›´æ˜¯0ï¼Œä½†æ˜¯æˆ‘æ›¾åœ¨å¤„ç†æ‹·è´å¤§é‡æ•°æ®(2-3T)çš„æœºå™¨ä¸Šçœ‹è¿‡å¯ä»¥è¾¾åˆ°140000/sï¼Œç£ç›˜å†™å…¥é€Ÿåº¦å·®ä¸å¤š140Mæ¯ç§’

     bo å—è®¾å¤‡æ¯ç§’å‘é€çš„å—æ•°é‡ï¼Œä¾‹å¦‚æˆ‘ä»¬è¯»å–æ–‡ä»¶ï¼Œboå°±è¦å¤§äº0ã€‚biå’Œboä¸€èˆ¬éƒ½è¦æ¥è¿‘0ï¼Œä¸ç„¶å°±æ˜¯IOè¿‡äºé¢‘ç¹ï¼Œéœ€è¦è°ƒæ•´ã€‚

     in æ¯ç§’CPUçš„ä¸­æ–­æ¬¡æ•°ï¼ŒåŒ…æ‹¬æ—¶é—´ä¸­æ–­

     cs æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼Œå°±è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ï¼Œä¹Ÿè¦è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™ä¸ªå€¼è¦è¶Šå°è¶Šå¥½ï¼Œå¤ªå¤§äº†ï¼Œè¦è€ƒè™‘è°ƒä½çº¿ç¨‹æˆ–è€…è¿›ç¨‹çš„æ•°ç›®,ä¾‹å¦‚åœ¨apacheå’Œnginxè¿™ç§webæœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åšæ€§èƒ½æµ‹è¯•æ—¶ä¼šè¿›è¡Œå‡ åƒå¹¶å‘ç”šè‡³å‡ ä¸‡å¹¶å‘çš„æµ‹è¯•ï¼Œé€‰æ‹©webæœåŠ¡å™¨çš„è¿›ç¨‹å¯ä»¥ç”±è¿›ç¨‹æˆ–è€…çº¿ç¨‹çš„å³°å€¼ä¸€ç›´ä¸‹è°ƒï¼Œå‹æµ‹ï¼Œç›´åˆ°csåˆ°ä¸€ä¸ªæ¯”è¾ƒå°çš„å€¼ï¼Œè¿™ä¸ªè¿›ç¨‹å’Œçº¿ç¨‹æ•°å°±æ˜¯æ¯”è¾ƒåˆé€‚çš„å€¼äº†ã€‚ç³»ç»Ÿè°ƒç”¨ä¹Ÿæ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼Œæˆ‘ä»¬çš„ä»£ç å°±ä¼šè¿›å…¥å†…æ ¸ç©ºé—´ï¼Œå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™ä¸ªæ˜¯å¾ˆè€—èµ„æºï¼Œä¹Ÿè¦å°½é‡é¿å…é¢‘ç¹è°ƒç”¨ç³»ç»Ÿå‡½æ•°ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¿‡å¤šè¡¨ç¤ºä½ çš„CPUå¤§éƒ¨åˆ†æµªè´¹åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¼è‡´CPUå¹²æ­£ç»äº‹çš„æ—¶é—´å°‘äº†ï¼ŒCPUæ²¡æœ‰å……åˆ†åˆ©ç”¨ï¼Œæ˜¯ä¸å¯å–çš„ã€‚

     us ç”¨æˆ·CPUæ—¶é—´ï¼Œæˆ‘æ›¾ç»åœ¨ä¸€ä¸ªåšåŠ å¯†è§£å¯†å¾ˆé¢‘ç¹çš„æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥çœ‹åˆ°usæ¥è¿‘100,rè¿è¡Œé˜Ÿåˆ—è¾¾åˆ°80(æœºå™¨åœ¨åšå‹åŠ›æµ‹è¯•ï¼Œæ€§èƒ½è¡¨ç°ä¸ä½³)ã€‚

     sy ç³»ç»ŸCPUæ—¶é—´ï¼Œå¦‚æœå¤ªé«˜ï¼Œè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨æ—¶é—´é•¿ï¼Œä¾‹å¦‚æ˜¯IOæ“ä½œé¢‘ç¹ã€‚

     id  ç©ºé—² CPUæ—¶é—´ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œid + us + sy = 100,ä¸€èˆ¬æˆ‘è®¤ä¸ºidæ˜¯ç©ºé—²CPUä½¿ç”¨ç‡ï¼Œusæ˜¯ç”¨æˆ·CPUä½¿ç”¨ç‡ï¼Œsyæ˜¯ç³»ç»ŸCPUä½¿ç”¨ç‡ã€‚

     wt ç­‰å¾…IO CPUæ—¶é—´ã€‚</code></pre>
<ul>
<li>jstat javaè™šæ‹Ÿæœº åƒåœ¾å›æ”¶çŠ¶æ€æŸ¥çœ‹</li>
</ul>
<pre><code>    å‘½ä»¤æ ¼å¼
    jstatå‘½ä»¤å‘½ä»¤æ ¼å¼ï¼š
    jstat [Options] vmid [interval] [count]
    å‚æ•°è¯´æ˜ï¼š
    Optionsï¼Œé€‰é¡¹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ -gcutil æŸ¥çœ‹gcæƒ…å†µ
    vmidï¼ŒVMçš„è¿›ç¨‹å·ï¼Œå³å½“å‰è¿è¡Œçš„javaè¿›ç¨‹å·
    intervalï¼Œé—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’æˆ–è€…æ¯«ç§’
    countï¼Œæ‰“å°æ¬¡æ•°ï¼Œå¦‚æœç¼ºçœåˆ™æ‰“å°æ— æ•°æ¬¡
    ç¤ºä¾‹è¯´æ˜
    ç¤ºä¾‹
    é€šå¸¸è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š
    jstat -gc 12538 5000
    å³ä¼šæ¯5ç§’ä¸€æ¬¡æ˜¾ç¤ºè¿›ç¨‹å·ä¸º12538çš„javaè¿›æˆçš„GCæƒ…å†µï¼Œ
    æ˜¾ç¤ºå†…å®¹å¦‚ä¸‹å›¾ï¼š

    jstat -gc 19014 1000
     S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT   
    10752.0 10752.0  0.0   5293.9 65536.0  65224.5   175104.0     16.0    13056.0 12799.5 1536.0 1495.2      1    0.009   0      0.000    0.009
    10752.0 10752.0  0.0   5293.9 65536.0  65224.5   175104.0     16.0    13056.0 12799.5 1536.0 1495.2      1    0.009   0      0.000    0.009

    ç»“æœè¯´æ˜
    æ˜¾ç¤ºå†…å®¹è¯´æ˜å¦‚ä¸‹ï¼ˆéƒ¨åˆ†ç»“æœæ˜¯é€šè¿‡å…¶ä»–å…¶ä»–å‚æ•°æ˜¾ç¤ºçš„ï¼Œæš‚ä¸è¯´æ˜ï¼‰ï¼š
             S0Cï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (å­—èŠ‚) 
             S1Cï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (å­—èŠ‚) 
             S0Uï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚) 
             S1Uï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚) 
             ECï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰çš„å®¹é‡ (å­—èŠ‚) 
             EUï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚) 
             OCï¼šOldä»£çš„å®¹é‡ (å­—èŠ‚) 
             OUï¼šOldä»£ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚) 
             PCï¼šPerm(æŒä¹…ä»£)çš„å®¹é‡ (å­—èŠ‚) 
             PUï¼šPerm(æŒä¹…ä»£)ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚) 
             YGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•° 
             YGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s) 
             FGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•° 
             FGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s) 
             GCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s) 
             NGCMNï¼šå¹´è½»ä»£(young)ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (å­—èŠ‚) 
             NGCMXï¼šå¹´è½»ä»£(young)çš„æœ€å¤§å®¹é‡ (å­—èŠ‚) 
             NGCï¼šå¹´è½»ä»£(young)ä¸­å½“å‰çš„å®¹é‡ (å­—èŠ‚) 
             OGCMNï¼šoldä»£ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (å­—èŠ‚) 
             OGCMXï¼šoldä»£çš„æœ€å¤§å®¹é‡ (å­—èŠ‚) 
             OGCï¼šoldä»£å½“å‰æ–°ç”Ÿæˆçš„å®¹é‡ (å­—èŠ‚) 
             PGCMNï¼špermä»£ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (å­—èŠ‚) 
             PGCMXï¼špermä»£çš„æœ€å¤§å®¹é‡ (å­—èŠ‚)   
             PGCï¼špermä»£å½“å‰æ–°ç”Ÿæˆçš„å®¹é‡ (å­—èŠ‚) 
             S0ï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” 
             S1ï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” 
             Eï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” 
             Oï¼šoldä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” 
             Pï¼špermä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” 
             S0CMXï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„æœ€å¤§å®¹é‡ (å­—èŠ‚) 
             S1CMX ï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„æœ€å¤§å®¹é‡ (å­—èŠ‚) 
             ECMXï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰çš„æœ€å¤§å®¹é‡ (å­—èŠ‚) 
             DSSï¼šå½“å‰éœ€è¦survivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (å­—èŠ‚)ï¼ˆEdenåŒºå·²æ»¡ï¼‰ 
             TTï¼š æŒæœ‰æ¬¡æ•°é™åˆ¶ 
             MTT ï¼š æœ€å¤§æŒæœ‰æ¬¡æ•°é™åˆ¶ </code></pre>
<ul>
<li><p>jstack pid javaæŸ¥çœ‹javaç¨‹åºçš„çŠ¶æ€</p>
</li>
<li><p>grep <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Regular_expression">æ­£åˆ™</a>è¾“å‡º </p>
</li>
</ul>
<pre><code>    grep -o -E &quot;[0-9]&#123;11&#125;&quot; xx.log

    cat error.log |grep &#39;Failed to invoke the method&#39;|grep &#39;2015-12-08 20&#39;|awk -F&#39;Failed to invoke the method&#39; &#39;&#123;print $2&#125;&#39;|awk &#39;&#123;print $1&#125;&#39;  |sort|uniq -c</code></pre>
<ul>
<li><p>åˆ é™¤æŸäº›æ–‡ä»¶</p>
<pre><code>  find ./ -name &#39;xx.log&#39; |xargs rm -rf</code></pre>
</li>
<li><p>åˆ é™¤æŸä¸ªæ–‡ä»¶å¤–çš„å…¶å®ƒæ–‡ä»¶</p>
<pre><code>  ls | grep -v keep | xargs rm #åˆ é™¤keepæ–‡ä»¶ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶
  è¯´æ˜ï¼š lså…ˆå¾—åˆ°å½“å‰çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„åå­—ï¼Œ grep -v keepï¼Œè¿›è¡Œgrepæ­£åˆ™åŒ¹é…æŸ¥æ‰¾keepï¼Œ-vå‚æ•°å†³å®šäº†ç»“æœä¸ºåŒ¹é…ä¹‹å¤–çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯çš„åˆ°äº†keepä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶åï¼Œç„¶å xargsç”¨äºä» æ ‡å‡†è¾“å…¥è·å¾—å‚æ•° å¹¶ä¸”ä¼ é€’ç»™åé¢çš„å‘½ä»¤ï¼Œè¿™é‡Œä½¿ç”¨çš„å‘½ä»¤æ˜¯ rmï¼Œç„¶åç”±rmåˆ é™¤å‰é¢é€‰æ‹©çš„æ–‡ä»¶</code></pre>
</li>
<li><p>æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</p>
</li>
</ul>
<pre><code>    æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼ˆåŒ…æ‹¬å­æ–‡ä»¶å¤¹ï¼‰
       âœ  ~  du -sh
        47G    .
    æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤¹å¤§å°
       # du -hs ftp
       6.3G    ftp

    æŸ¥çœ‹ç£ç›˜ç©ºé—´å¤§å°å‘½ä»¤
    df -h Dfå‘½ä»¤æ˜¯linuxç³»ç»Ÿä»¥ç£ç›˜åˆ†åŒºä¸ºå•ä½æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥åŠ ä¸Šå‚æ•°æŸ¥çœ‹ç£ç›˜å‰©ä½™ç©ºé—´ä¿¡æ¯ï¼Œå‘½ä»¤æ ¼å¼ï¼š df -hl æ˜¾ç¤ºæ ¼å¼ä¸ºï¼š æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ Filesystem Size Used Avail Use% Mounted on /dev/hda2 45G 19G 24G 44% / /dev/hda1 494

    df   -h

    Dfå‘½ä»¤æ˜¯linuxç³»ç»Ÿä»¥ç£ç›˜åˆ†åŒºä¸ºå•ä½æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥åŠ ä¸Šå‚æ•°æŸ¥çœ‹ç£ç›˜å‰©ä½™ç©ºé—´ä¿¡æ¯ï¼Œå‘½ä»¤æ ¼å¼ï¼š

    df -hl

    æ˜¾ç¤ºæ ¼å¼ä¸ºï¼šã€€

    æ–‡ä»¶ç³»ç»Ÿ              å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ã€€

    Filesystem            Size Used Avail Use% Mounted on

    /dev/hda2              45G   19G   24G 44% /</code></pre>
<ul>
<li><p>gzè§£å‹</p>
<pre><code>  gzip -x ...     </code></pre>
</li>
<li><p>proc å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‰¾ä¸åˆ°logå»å“ªäº†</p>
<pre><code>  ls -l /proc/63220/fd|grep log</code></pre>
</li>
</ul>
<ul>
<li>æŸ¥çœ‹å†…å­˜ä¿¡æ¯ </li>
</ul>
<p>#linux ä¸‹å®‰è£…è½¯ä»¶</p>
<ul>
<li>yum</li>
</ul>
<pre><code>    æŒ‡å®šæºè¿›è¡Œå®‰è£…
    yum install è½¯ä»¶å --enablerepo=å®‰è£…åŒ…åœ°å€</code></pre>
<ul>
<li>é‡æ–°å®‰è£…JDK</li>
</ul>
<pre><code>    åˆ é™¤JDK:
        rpm -qa | grep jdk|xargs sudo rpm -e --nodeps
    download jdk
     wget -c -P ./ http://download.oracle.com/otn-pub/java/jdk/8u65-b17/jdk-8u65-linux-x64.rpm?AuthParam=1448637274_af870ccf6c2c78750a5977e6da301744

     å®‰è£…

     ä»¥JDK1.8ä¸ºä¾‹

     æ‹·è´åˆ°/usr/shareä¸‹ï¼Œmv jdk-8u65-linux-x64.rpm /usr/share

     ç”¨rpm -ivhå‘½ä»¤å®‰è£…



     é…ç½®ç¯å¢ƒå˜é‡

     åœ¨/etc/profileä¸‹å¢åŠ 

     # set Java environment
     JAVA_HOME=/usr/share/jdk-8u65-linux-x64
     PATH=$JAVA_HOME/bin:$PATH
     CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
     export JAVA_HOME
     export PATH
     export CLASSPATH



     æµ‹è¯•

     [root@localhost ~]# echo $JAVA_HOME
     /usr/share/jdk1.6.0_43
     [root@localhost ~]# echo $PATH
     /usr/share/jdk1.6.0_43/bin:/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
     [root@localhost ~]# echo $CLASSPATH
     .:/usr/share/jdk1.6.0_43/lib/dt.jar:/usr/share/jdk1.6.0_43/lib/tools.jar

     [root@localhost ~]# java -version
     java version &quot;1.6.0_43&quot;
     Java(TM) SE Runtime Environment (build 1.6.0_43-b01)
     Java HotSpot(TM) 64-Bit Server VM (build 20.14-b01, mixed mode)

    Managing Java

    sudo update-alternatives --config java
    æœ‰ 2 ä¸ªå€™é€‰é¡¹å¯ç”¨äºæ›¿æ¢ java (æä¾› /usr/bin/java)ã€‚</code></pre>
<h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><ul>
<li><p>mysqlæˆæƒ</p>
<pre><code>  ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;root&#39; WITH GRANT OPTION;</code></pre>
</li>
</ul>
<h2 id="å®‰è£…apt-get"><a href="#å®‰è£…apt-get" class="headerlink" title="å®‰è£…apt-get"></a>å®‰è£…apt-get</h2><p><a target="_blank" rel="noopener" href="http://everyday-tech.com/apt-get-on-centos/">http://everyday-tech.com/apt-get-on-centos/</a></p>
<h2 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h2><p>lsofè¯­æ³•æ ¼å¼æ˜¯ï¼š<br>lsof ï¼»optionsï¼½ filename<br>å¤åˆ¶ä»£ç </p>
<p>lsof abc.txt æ˜¾ç¤ºå¼€å¯æ–‡ä»¶abc.txtçš„è¿›ç¨‹<br>lsof -c abc æ˜¾ç¤ºabcè¿›ç¨‹ç°åœ¨æ‰“å¼€çš„æ–‡ä»¶<br>lsof -c -p 1234 åˆ—å‡ºè¿›ç¨‹å·ä¸º1234çš„è¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶<br>lsof -g gid æ˜¾ç¤ºå½’å±gidçš„è¿›ç¨‹æƒ…å†µ<br>lsof +d /usr/local/ æ˜¾ç¤ºç›®å½•ä¸‹è¢«è¿›ç¨‹å¼€å¯çš„æ–‡ä»¶<br>lsof +D /usr/local/ åŒä¸Šï¼Œä½†æ˜¯ä¼šæœç´¢ç›®å½•ä¸‹çš„ç›®å½•ï¼Œæ—¶é—´è¾ƒé•¿<br>lsof -d 4 æ˜¾ç¤ºä½¿ç”¨fdä¸º4çš„è¿›ç¨‹<br>lsof -i ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ<br>lsof -i[46] [protocol][@hostname|hostaddr][:service|port]<br>  46 â€“&gt; IPv4 or IPv6<br>  protocol â€“&gt; TCP or UDP<br>  hostname â€“&gt; Internet host name<br>  hostaddr â€“&gt; IPv4åœ°å€<br>  service â€“&gt; /etc/serviceä¸­çš„ service name (å¯ä»¥ä¸æ­¢ä¸€ä¸ª)<br>  port â€“&gt; ç«¯å£å· (å¯ä»¥ä¸æ­¢ä¸€ä¸ª)</p>
<h2 id="traceroute-IP"><a href="#traceroute-IP" class="headerlink" title="traceroute IP"></a>traceroute IP</h2><h2 id="ç›‘æ§æŸå°æœºå™¨åˆ°æŸIPçš„é“¾è·¯çš„è¿é€šæ€§"><a href="#ç›‘æ§æŸå°æœºå™¨åˆ°æŸIPçš„é“¾è·¯çš„è¿é€šæ€§" class="headerlink" title="ç›‘æ§æŸå°æœºå™¨åˆ°æŸIPçš„é“¾è·¯çš„è¿é€šæ€§"></a>ç›‘æ§æŸå°æœºå™¨åˆ°æŸIPçš„é“¾è·¯çš„è¿é€šæ€§</h2><pre><code>    nohup ping -W 1 172.31.xx.xx &amp;&gt;/tmp/ping.log &amp;
    crontab -e
    * * * * *       echo &quot;`date +%d-%H:%M`&quot; &gt;&gt; /tmp/ping.log</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/06/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" data-id="cl7mgnxtt000st2zac1zw3ts6" data-title="å¸¸ç”¨è¿ç»´çŸ¥è¯†å¤§æ‚çƒ©" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/06/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/06/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux%E5%91%BD%E4%BB%A4/" rel="tag">linuxå‘½ä»¤</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-Django+Mysql+å®ç°å‘¨è¾¹æŸ¥è¯¢" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/09/02/Django+Mysql+%E5%AE%9E%E7%8E%B0%E5%91%A8%E8%BE%B9%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time class="dt-published" datetime="2015-09-01T16:00:00.000Z" itemprop="datePublished">2015-09-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%96%B9%E6%A1%88/">æ–¹æ¡ˆ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/09/02/Django+Mysql+%E5%AE%9E%E7%8E%B0%E5%91%A8%E8%BE%B9%E6%9F%A5%E8%AF%A2/">Django,Mysql,ç©ºé—´æ•°æ®æ˜¯é€šè¿‡Googleåœ°å›¾å’Œé«˜å¾·åœ°å›¾è¿›è¡Œé‡‡é›†çš„</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>##ç¯å¢ƒ</p>
<p>Django,Mysql,ç©ºé—´æ•°æ®æ˜¯é€šè¿‡Googleåœ°å›¾å’Œé«˜å¾·åœ°å›¾è¿›è¡Œé‡‡é›†çš„</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ mysql -V</span><br><span class="line">mysql  Ver <span class="number">14.14</span> Distrib <span class="number">5.6</span><span class="number">.20</span>, <span class="keyword">for</span> osx10<span class="number">.9</span> (x86_64) <span class="keyword">using</span>  EditLine <span class="keyword">wrapper</span></span><br></pre></td></tr></table></figure>

<p>##éœ€æ±‚æè¿°</p>
<p>mysqlä¸­å­˜å‚¨äº†ä¸€äº›åœ°ç†ç©ºé—´ç‚¹ç±»å‹çš„æ•°ï¼Œè¦è¿›è¡Œå‘¨è¾¹æŸ¥è¯¢ã€‚</p>
<p>##MySQLç©ºé—´ç›¸å…³çš„å±€é™æ€§</p>
<p><a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.6/en/spatial-relation-functions.html">MySQLç©ºé—´æ‰©å±•çš„åŠŸèƒ½</a>ä»…æ”¯æŒåŒ…ç»œæ¡†ç›¸å…³çš„æ“ä½œ(MySQLç§°ä¹‹ä¸ºæœ€å°è¾¹æ¡†ï¼Œæˆ–ç®€ç§°ä¸º MBR)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒMySQLç¬¦åˆOGCæ ‡å‡†ã€‚</p>
<blockquote>
<p>ç›®å‰,MySQLæ²¡æœ‰å®ç°Contains,Crosses,Disjoint,Intersects,Overlaps,Toucheså‡½æ•°ï¼Œå¯ä»¥é€šè¿‡MBRæ¥å®ç°åŒæ ·æ•ˆæœæ“ä½œã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨MySQLè¿›è¡Œå¦‚containsç±»ä¼¼çš„ç©ºé—´æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥é€šè¿‡bbcontainsæ¥å®ç°åŒæ ·æ•ˆæœçš„æ“ä½œã€‚</p>
<p><code>æ³¨æ„ï¼š</code></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">åªæœ‰MyISAMå¼•æ“çš„MySQLè¡¨æ‰çœŸæ­£çš„æ”¯æŒç©ºé—´ç´¢å¼•<span class="comment">(R-trees)</span>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ è¦ä½¿ç”¨MySQLæä¾›çš„ç©ºé—´æ‰©å±•æ—¶ï¼Œä½ è¦åœ¨å¿«é€ŸæŸ¥è¯¢ç©ºé—´æ•°æ®å’Œæ•°æ®çš„å®Œæ•´æ€§ä¹‹é—´åšä¸€ä¸ªé€‰æ‹© ï¼ MyISAMçš„è¡¨ä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®çº¦æŸã€‚</span><br></pre></td></tr></table></figure>


<p>##æ•°æ®åº“é…ç½®</p>
<p>ç©ºé—´è¡¨å¼•æ“ Engine:InnoDB</p>
<p>###åˆ›å»ºæ•°æ®åº“</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> project_test@localhost IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;project_test&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>; </span><br><span class="line">mysql&gt;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> project_test@&quot;%&quot; IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;project_test&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç¬¬ä¸€å¥å¢åŠ äº†ä¸€ä¸ª project_test ç”¨æˆ·æˆæƒé€šè¿‡æœ¬åœ°æœºï¼ˆlocalhost)è®¿é—®ï¼Œå¯†ç â€œproject_testâ€ã€‚</p>
</li>
<li><p>ç¬¬äºŒå¥åˆ™æ˜¯æˆä¸ project_test ç”¨æˆ·ä»ä»»ä½•å…¶å®ƒä¸»æœºå‘èµ·çš„è®¿é—®ï¼ˆé€šé…ç¬¦ï¼…ï¼‰ã€‚ </p>
</li>
</ul>
<p>###é…ç½®æ•°æ®æº</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.contrib.gis.db.backends.mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;project_test&#x27;</span>,        # <span class="keyword">Or</span> <span class="type">path</span> <span class="keyword">to</span> <span class="keyword">database</span> file <span class="keyword">if</span> <span class="keyword">using</span> sqlite3.</span><br><span class="line">    <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;project_test&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;project_test&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,           # Empty <span class="keyword">for</span> localhost through <span class="keyword">domain</span> sockets <span class="keyword">or</span> <span class="string">&#x27;127.0.0.1&#x27;</span> <span class="keyword">for</span> localhost through TCP.</span><br><span class="line">    <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,                # <span class="keyword">Set</span> <span class="keyword">to</span> empty string <span class="keyword">for</span> <span class="keyword">default</span>.</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>##æ•°æ®æ¨¡å‹çš„æ„å»º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.gis.db <span class="keyword">import</span> models <span class="keyword">as</span> gismodels</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppPoint</span>(<span class="params">gismodels.Model</span>):</span></span><br><span class="line">    description = gismodels.TextField(verbose_name=_(<span class="string">u&quot;æè¿°ä¿¡æ¯&quot;</span>), max_length=<span class="number">500</span>,</span><br><span class="line">                                      blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    point = gismodels.PointField(spatial_index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    objects = gismodels.GeoManager()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="Django-Geographic-framework-1-7"><a href="#Django-Geographic-framework-1-7" class="headerlink" title="Django Geographic framework 1.7"></a><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/">Django Geographic framework 1.7</a></h2><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/">GeoDjango</a>æ‰“ç®—åšä¸–ç•Œçº§çš„åœ°ç†å­¦Webæ¡†æ¶ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½æ–¹ä¾¿æ˜¯çš„åˆ©ç”¨å¼ºå¤§ç©ºé—´æ•°æ®æ„å»ºGIS Web åº”ç”¨ã€‚</p>
<p>###GeoQuerySet API</p>
<p><code>class GeoQuerySet([model=None])</code></p>
<p>####ç©ºé—´æŸ¥è¯¢</p>
<p>æ­£å¦‚ä½¿ç”¨<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/models/querysets/#queryset-api">QuerySet API</a>æ—¶ä¸€æ ·ï¼Œåœ¨è¿‡æ»¤å™¨é“¾(<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/topics/db/queries/#chaining-filters">chaining filters</a>)ä¸ŠåŠ ä¸ŠGeoQuerySetè¿›è¡Œç­›é€‰ã€‚é™¤äº†é€šå¸¸çš„å­—æ®µ(<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/models/querysets/#field-lookups">Field lookups</a>)æŸ¥è¯¢ï¼Œå®ƒè¿˜æä¾›äº†ç©ºé—´å­—æ®µ<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/model-api/#django.contrib.gis.db.models.GeometryField">GeometryField</a>çš„æŸ¥è¯¢ã€‚</p>
<p>å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/db-api/#spatial-lookups-intro">è¿™é‡Œ</a>æŸ¥çœ‹ç©ºé—´æŸ¥è¯¢ä»‹ç»</p>
<p>ä¸‹é¢Djangoå¯¹ä¸åŒæ•°æ®åº“ ç©ºé—´æŸ¥è¯¢æ“ä½œæ”¯æŒç»Ÿè®¡è¡¨ï¼š</p>
<pre><code>    Lookup Type            PostGIS    Oracle    MySQL [7]    SpatiaLite

    bbcontains            X                X             X
    bboverlaps            X                 X             X
    contained            X                 X             X
    contains            X         X        X             X
    contains_properly    X               
    coveredby            X         X          
    covers                X         X          
    crosses                X                               X
    disjoint            X         X        X             X
    distance_gt            X         X                      X
    distance_gte        X         X                      X
    distance_lt            X         X                      X
    distance_lte           X         X                      X
    dwithin                X         X          
    equals                X         X        X             X
    exact                X         X        X             X
    intersects            X         X        X             X
    overlaps            X         X        X             X
    relate                X         X                     X
    same_as                X         X        X             X
    touches                X         X        X             X
    within                X         X        X             X
    left                X               
    right                X               
    overlaps_left       X               
    overlaps_right      X               
    overlaps_above      X               
    overlaps_below      X               
    strictly_above      X               
    strictly_below      X               </code></pre>
<p>####æˆ‘è¿™é‡Œåªå…³æ³¨ä¸€ä¸‹å¯¹mysqlçš„ç©ºé—´æ“ä½œæ”¯æŒ</p>
<blockquote>
<p>æŒ‰æˆ‘ä»¬çš„éœ€è¦æˆ‘ä»¬é€‰ç”¨ <code>within</code></p>
</blockquote>
<ol>
<li><p>bbcontains</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ç©ºé—´æ•°æ®çš„bboxåŒ…å«åœ¨æŒ‡å®šçš„ç©ºé—´bboxå†…çš„æ•°æ®ã€‚</p>
<pre><code> æ•°æ®åº“         æ“ä½œ  

 PostGIS       poly ~ geom
 MySQL         MBRContains(poly,geom)
 SpatiaLite    MbrContains(poly,geom)</code></pre>
</li>
</ol>
<ol start="2">
<li><p>bboverlaps</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ç©ºé—´æ•°æ®çš„bboxä¸æŒ‡å®šçš„ç©ºé—´bboxç›¸äº¤çš„æ•°æ®ã€‚</p>
<pre><code> æ•°æ®åº“         æ“ä½œ  

 PostGIS       poly &amp;&amp; geom
 MySQL         MBROverlops(poly,geom)
 SpatiaLite    MbrOverlops(poly,geom)</code></pre>
</li>
<li><p>contained</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ç©ºé—´æ•°æ®çš„bboxå®Œå…¨åŒ…å«æŒ‡å®šçš„ç©ºé—´bboxçš„æ•°æ®ã€‚</p>
<pre><code> æ•°æ®åº“         æ“ä½œ  

 PostGIS       poly @ geom
 MySQL         MBRWithin(poly,geom)
 SpatiaLite    MbrWithin(poly,geom)</code></pre>
</li>
<li><p>contains</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> Example:</p>
<pre><code> Zipcode.objects.filter(poly__contains=geom)</code></pre>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ç©ºé—´æ•°æ®åŒ…å«æŒ‡å®šçš„ç©ºé—´å›¾å½¢çš„æ•°æ®ã€‚</p>
<pre><code> æ•°æ®åº“         æ“ä½œ  

 PostGIS       ST_Contains(poly, geom)
 Oracle        SDO_CONTAINS(poly, geom)
 MySQL         MBRContains(poly, geom)
 SpatiaLite    Contains(poly, geom)</code></pre>
</li>
</ol>
<ol start="5">
<li><p>disjoint</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> Example:</p>
<pre><code> Zipcode.objects.filter(poly__disjoint=geom)</code></pre>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ä¸æŒ‡å®šçš„ç©ºé—´å›¾å½¢ç›¸ç¦»çš„ç©ºé—´æ•°æ®ã€‚</p>
<pre><code> æ•°æ®åº“         æ“ä½œ  

 PostGIS       ST_Disjoint(poly, geom)
 Oracle        SDO_GEOM.RELATE(poly, geom)
 MySQL         MBRDisjoint(poly, geom)
 SpatiaLite    Disjoint(poly, geom)</code></pre>
</li>
<li><p>equals</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
</li>
<li><p>exactï¼Œsame_as</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
</li>
<li><p>intersects</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p> æŸ¥è¯¢æ•°æ®åº“ä¸­ä¸æŒ‡å®šçš„ç©ºé—´å›¾å½¢ç›¸äº¤çš„ç©ºé—´æ•°æ®ã€‚</p>
<p> Example:</p>
<pre><code>     Zipcode.objects.filter(poly__intersects=geom)</code></pre>
</li>
</ol>
<pre><code>        æ•°æ®åº“         æ“ä½œ  

        PostGIS       ST_Intersects(poly, geom)
        Oracle        SDO_OVERLAPBDYINTERSECT(poly, geom)
        MySQL         MBRIntersects(poly, geom)
        SpatiaLite    Intersects(poly, geom)</code></pre>
<ol start="9">
<li><p>overlaps</p>
<p> æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
</li>
</ol>
<ol start="10">
<li><p>touches</p>
<p>æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p>Example:</p>
<pre><code>    Zipcode.objects.filter(poly__touches=geom)</code></pre>
<p>æŸ¥è¯¢ä¸æŒ‡å®šçš„ç©ºé—´å‡ ä½•å›¾å½¢ç›¸æ¥çš„æ•°æ®ã€‚</p>
<pre><code>    æ•°æ®åº“         æ“ä½œ  

    PostGIS       ST_Touches(poly, geom)
    Oracle        SDO_TOUCH(poly, geom)
    MySQL         MBRTouches(poly, geom)
    SpatiaLite    Touches(poly, geom)</code></pre>
</li>
<li><p>within</p>
<p>æ”¯æŒï¼š<code>PostGIS</code>,<code>Oracle</code>,<code>MySQL</code>,<code>SpatiaLite</code></p>
<p>Example:</p>
<pre><code>    Zipcode.objects.filter(poly__within=geom)</code></pre>
<p>æŸ¥è¯¢åŒ…å«åœ¨æŒ‡å®šçš„ç©ºé—´å‡ ä½•å›¾å½¢ä¸­çš„æ•°æ®ã€‚</p>
<pre><code>    æ•°æ®åº“         æ“ä½œ  

    PostGIS       ST_Within(poly, geom)
    Oracle        SDO_INSIDE(poly, geom)
    MySQL         MBRWithin(poly, geom)
    SpatiaLite    Within(poly, geom)</code></pre>
</li>
</ol>
<blockquote>
<p>ç°åœ¨çŸ¥é“äº†è¦ç”¨ within æ¥æŸ¥è¯¢æ•°æ®ï¼Œå¦ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ç”ŸæˆåŠå¾„å¤§å°ä¸ºRä¸­å¿ƒåæ ‡ä¸º(x,y)çš„geomå‘¢ã€‚</p>
</blockquote>
<p>####åˆ›å»ºç©ºé—´å‡ ä½•å›¾å½¢</p>
<p>å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼åˆ›å»º<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/geos/#django.contrib.gis.geos.GEOSGeometry">GeosGeometry</a>ã€‚ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡ä¸€äº›å‚æ•°ç›´æ¥å®ä¾‹åŒ–ã€‚</p>
<ul>
<li>ä¸‹é¢æ˜¯åˆ†åˆ«é€šè¿‡WKT,HEX,WKBå’ŒGeoJSONæ–¹å¼ç›´æ¥åˆ›å»º Geometry çš„æ–¹æ³•ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">30</span>]: pnt = GEOSGeometry(<span class="string">&#x27;POINT(5 23)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">31</span>]: pnt = GEOSGeometry(<span class="string">&#x27;010100000000000000000014400000000000003740&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">32</span>]: pnt = GEOSGeometry(buffer(<span class="string">&#x27;\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14@\x00\x00\x00\x00\x00\x007@&#x27;</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">33</span>]: pnt = GEOSGeometry(<span class="string">&#x27;&#123; &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ 5.000000, 23.000000 ] &#125;&#x27;</span>) <span class="comment"># GeoJSON   </span></span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<ul>
<li>å¦ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡ç‰¹å®šç±»å‹çš„ç©ºé—´å‡ ä½•å¯¹è±¡çš„æ„é€ å™¨æ¥è¿›è¡Œåˆ›å»ºè¯¥ç±»å‹çš„Geometryå®ä¾‹</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">In [<span class="number">34</span>]: <span class="keyword">from</span> django.contrib.gis.geos <span class="keyword">import</span> Point</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: pnt = Point(<span class="number">5</span>,<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: pnt</span><br><span class="line">Out[<span class="number">36</span>]: &lt;Point object at <span class="number">0x10735bb50</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æœ€åä¸€ç§æ–¹æ³•å°±æ˜¯é€šè¿‡ <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/geos/#django.contrib.gis.geos.fromstr">fromstr()</a>å’Œ <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.7/ref/contrib/gis/geos/#django.contrib.gis.geos.fromfile">fromfile</a> å·¥å‚æ–¹æ³•æ¥åˆ›å»ºGeometryå®ä¾‹ã€‚å®ƒä»¬åˆ†åˆ«æ¥æ”¶å­—ç¬¦ä¸²æˆ–æ–‡ä»¶</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">37</span>]: <span class="keyword">from</span> django.contrib.gis.geos <span class="keyword">import</span> fromstr,fromfile</span><br><span class="line"></span><br><span class="line">In [<span class="number">38</span>]: pnt = fromstr(<span class="string">&#x27;POINT(5 23)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: pnt = fromfile(<span class="string">&#x27;/path/to/pnt.wkt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: pnt = fromfile(open(<span class="string">&#x27;/path/to/pnt.wkt&#x27;</span>))</span><br></pre></td></tr></table></figure>



<p>####å®ç°æŸ¥è¯¢å‘¨è¾¹å‡ ä½•ç‚¹çš„åŠŸèƒ½</p>
<blockquote>
<p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œåœ¨Djangoä¸­å®ç°mysqlæ•°æ®çš„å‘¨è¾¹æŸ¥è¯¢åªèƒ½é€šè¿‡æ¨¡ç³Šçš„æŸ¥è¯¢ï¼Œ<br>æˆ‘ä»¬è¿™é‡Œé€šè¿‡æ„å»ºä¸€ä¸ªåŒ…ç»œæ¡†è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼š</p>
</blockquote>
<ul>
<li>æ„å»ºä¸€ä¸ªåŒ…ç»œæ¡†</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.gis.geos <span class="keyword">import</span> (<span class="type">Polygon</span>,<span class="type">Point</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">point</span> = <span class="type">Point</span>(<span class="number">130</span>,<span class="number">39</span>)</span><br><span class="line"></span><br><span class="line">buffer=<span class="type">point</span>.buffer(degree)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<ul>
<li>è¿›è¡ŒwithinæŸ¥è¯¢</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">AppPoint</span>.</span></span>objects.filter(point__within=buffer)</span><br></pre></td></tr></table></figure>


<ul>
<li>é—®é¢˜</li>
</ul>
<p>è¿™é‡Œç»™çš„åŠå¾„é€šå¸¸æ˜¯ç±³ä¸ºkmï¼Œä½†æ˜¯è¿™ä¸ªæ„å»ºbufferçš„æ–¹æ³•éœ€è¦çš„å‚æ•°æ˜¯ä¸€ä¸ªåº¦ã€‚</p>
<pre><code>degree=l*180/(math.pi*6371)</code></pre>
<p>##æµ‹è¯•æ–¹æ³•å’Œæ•°æ®</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function">def <span class="title">get_point</span><span class="params">(<span class="built_in">point</span>,r)</span>:</span></span><br><span class="line"><span class="function">    EARTH_R</span>=<span class="number">6378.137</span></span><br><span class="line">    <span class="built_in">buffer</span> = <span class="built_in">point</span>.<span class="built_in">buffer</span>(r*<span class="number">180</span>/(math.pi*EARTH_R))</span><br><span class="line">    aps=AppPoint.objects.filter(point__within=<span class="built_in">buffer</span>)</span><br><span class="line">    <span class="keyword">for</span> ap in aps:</span><br><span class="line">        <span class="built_in">print</span> ap.<span class="built_in">point</span>.json,(math.pi*EARTH_R*ap.<span class="built_in">point</span>.distance(<span class="built_in">point</span>)/<span class="number">180</span>)</span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ç‚¹ä¸ç‚¹é—´çš„è·ç¦»æ–¹æ³•distanceåœ¨djangoä¸­è§£é‡Šä¸ºï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Returns the distance between the closest points on this Geometry</span><br><span class="line"><span class="keyword">and</span> the other. Units will be <span class="keyword">in</span> those of the coordinate<span class="built_in"> system </span>of</span><br><span class="line">the Geometry.</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯æµ‹è¯•æ•°æ®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">b</span> <span class="string">=</span> [[<span class="number">116.27497</span>,<span class="number">39.95708</span>,<span class="number">2573</span>],</span><br><span class="line">[<span class="number">116.48103</span>,<span class="number">39.96657</span>,<span class="number">4292</span>],</span><br><span class="line"><span class="string">...</span></span><br><span class="line">[<span class="number">116.13621</span>,<span class="number">39.92686</span>,<span class="number">528</span>],</span><br><span class="line">[<span class="number">116.39494</span>,<span class="number">39.87986</span>,<span class="number">138</span>],</span><br><span class="line">[<span class="number">116.389</span>,<span class="number">39.8799</span>,<span class="number">2151</span>],</span><br><span class="line">[<span class="number">116.4858</span>,<span class="number">39.9361</span>,<span class="number">4709</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">åˆ›å»ºæ•°æ®ï¼š</span></span><br><span class="line"><span class="attr">for b in a:</span>                                   </span><br><span class="line">    <span class="string">AppPoint.objects.create(description=b.count,point=Point(b[0],b[1]))</span></span><br><span class="line">    </span><br><span class="line"><span class="string">è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"> <span class="string">get_point(Point(116.4,39.8),8)</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.4214</span>, <span class="number">39.85925</span> ] &#125; <span class="number">7.01270604176</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.33663</span>, <span class="number">39.79076</span> ] &#125; <span class="number">7.1289114023</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.43555</span>, <span class="number">39.80307</span> ] &#125; <span class="number">3.97213681829</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.42803</span>, <span class="number">39.86696</span> ] &#125; <span class="number">8.08069287815</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.41776</span>, <span class="number">39.8526</span> ] &#125; <span class="number">6.18016458489</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.41467</span>, <span class="number">39.86627</span> ] &#125; <span class="number">7.5557334976</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.37254</span>, <span class="number">39.82765</span> ] &#125; <span class="number">4.33799658047</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.36128</span>, <span class="number">39.85648</span> ] &#125; <span class="number">7.62292984489</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.41574</span>, <span class="number">39.80051</span> ] &#125; <span class="number">1.75308830872</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.40075</span>, <span class="number">39.81592</span> ] &#125; <span class="number">1.77417182449</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.45339</span>, <span class="number">39.83341</span> ] &#125; <span class="number">7.01111345466</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.39799</span>, <span class="number">39.84366</span> ] &#125; <span class="number">4.86535674431</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.38116</span>, <span class="number">39.85952</span> ] &#125; <span class="number">6.94973919946</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.3385</span>, <span class="number">39.82914</span> ] &#125; <span class="number">7.57577153659</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.3777</span>, <span class="number">39.86207</span> ] &#125; <span class="number">7.34200348969</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.39454</span>, <span class="number">39.86518</span> ] &#125; <span class="number">7.28121719546</span></span><br><span class="line">&#123; <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;Point&quot;</span>, <span class="attr">&quot;coordinates&quot;:</span> [ <span class="number">116.41095</span>, <span class="number">39.84127</span> ] &#125; <span class="number">4.75311465912</span></span><br></pre></td></tr></table></figure>

<p>##æ€»ç»“</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">from</span> django.contrib.gis.geos <span class="keyword">import</span> (<span class="type">Polygon</span>,<span class="type">Point</span>)</span><br><span class="line">    <span class="keyword">import</span> math</span><br><span class="line">    <span class="type">point</span> = <span class="type">Point</span>(<span class="number">130</span>,<span class="number">39</span>)</span><br><span class="line">    EARTH_R=<span class="number">6378.137</span></span><br><span class="line">    buffer = <span class="type">point</span>.buffer(r*<span class="number">180</span>/(math.pi*EARTH_R))</span><br><span class="line">    aps=AppPoint.objects.<span class="keyword">filter</span>(point__within=buffer)</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">##æ–°çš„é—®é¢˜</span><br><span class="line">###ä¸Šé¢è¿™ç§æ–¹æ³•å¾—åˆ°çš„æ˜¯æ²¡æœ‰æ’åºçš„ç»“æœï¼Œç›®å‰è¦è¿›è¡Œç”±è¿‘åˆ°è¿œè¿›è¡Œæ’åºï¼Œé€šè¿‡</span><br><span class="line">`SQRT(POW( ABS( X(<span class="keyword">Location</span>) â€“ X(@center)), <span class="number">2</span>) + POW(ABS(Y(<span class="keyword">Location</span>) â€“ Y(@center)), <span class="number">2</span>))`å¾—åˆ°ä¸€ä¸ªå¤§è‡´çš„è·ç¦»å› å­ï¼Œç„¶åæ ¹æ®è¿™ä¸ªè¿›è¡Œæ’åºã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>queryset.extra(select={â€˜distance_factorâ€™: â€œSQRT(POWER(ABS(X(point) - â€œ+str(x)+â€),2) + POWER(ABS(Y(point) - â€œ+str(y)+â€),2))â€}).order_by(â€˜distance_factorâ€™)</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">###åœ¨çº¿ä¸Šé‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼š</span><br></pre></td></tr></table></figure>
<p>rps[0].point.distance(rps[1].point)<br>python: GeometryComponentFilter.cpp:35: virtual void geos::geom::GeometryComponentFilter::filter_ro(const geos::geom::Geometry*): Assertion `0â€™ failed.</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line">çº¿ä¸Šç›´æ¥ä½¿ç”¨<span class="selector-tag">distance</span>æ—¶æŠ¥é”™ã€‚</span><br><span class="line"></span><br><span class="line">ç„¶åæ¯”è¾ƒäº†ä¸€ä¸‹<span class="selector-tag">python</span>çš„<span class="selector-tag">distance</span>å¾—åˆ°çš„å€¼ï¼Œå…¶å®æ˜¯å’Œ`<span class="selector-tag">SQRT</span>(POW( ABS( X(Location) â€“ X(<span class="variable">@center</span>)), <span class="number">2</span>) + POW(ABS(Y(Location) â€“ Y(<span class="variable">@center</span>)), <span class="number">2</span>))`å¾—åˆ°çš„å€¼æ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(â€˜â€¦..pythonâ€™, 0.0071949078163964595)<br>(â€˜selfâ€™, 0.0071949078163964595)</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">æ•…å¤„äº›æœ€ç»ˆåˆ°ç»ˆå¿ƒç‚¹çš„è·ç¦»ä½¿ç”¨äº† <span class="code">`distance_factor`</span> æ¥ä»£æ›¿ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">##æ³¨æ„</span></span><br><span class="line"></span><br><span class="line"><span class="section">###[<span class="string">ç»çº¬åº¦åæ ‡ç³»é‡‡ç”¨GCJ-2æ ‡å‡†,å¯¹äºGoogle,é«˜å¾·åœ°å›¾å’Œè…¾è®¯åœ°å›¾å¯ä»¥ç›´æ¥ä½¿ç”¨</span>](<span class="link">http://wangsheng2008love.blog.163.com/blog/static/78201689201461674727642/</span>)</span></span><br><span class="line"><span class="section">###åœ°çƒåæ ‡ç³» (WGS-84) åˆ°ç«æ˜Ÿåæ ‡ç³» (GCJ-02) çš„è½¬æ¢ç®—æ³•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">####ä¸‹é¢æ˜¯é€šè¿‡html5è·å–åæ ‡ï¼Œç„¶åè½¬åŒ–åçš„å½“å‰æˆ‘çš„ä½ç½®æˆªå›¾</span></span><br><span class="line">![<span class="string">loading</span>](<span class="link">/images/project/xy_trans_position.png =x400</span>)</span><br><span class="line"><span class="section">####è…¾è®¯é«˜å¾·å¯¹å…¶è½¬åŒ–éƒ½æœ‰ç°æˆçš„å®ç°</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<pre><code>    var a = 6378245.0
    var ee = 0.00669342162296594323

    function out_of_china(lat,lon)&#123;
        if (lon &lt; 72.004 || lon &gt; 137.8347)
            return true
        if (lat &lt; 0.8293 || lat &gt; 55.8271)
            return true
    &#125;
    function transformlat(x, y) &#123;

        var result = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x))
        result += (20.0 * Math.sin(6.0 * Math.PI * x) + 20.0 * Math.sin(2.0 * Math.PI * x)) * 2.0 / 3.0
        result += (20.0 * Math.sin(Math.PI * y) + 40.0 * Math.sin(Math.PI / 3.0 * y)) * 2.0 / 3.0
        result += (160.0 * Math.sin(Math.PI / 12.0 * y) + 320.0 * Math.sin(Math.PI / 30.0 * y)) * 2.0 / 3.0
        return result
    &#125;
    function transformlon(x, y) &#123;
        var result = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x))
        result += (20.0 * Math.sin(6.0 * Math.PI * x) + 20.0 * Math.sin(2.0 * Math.PI * x)) * 2.0 / 3.0
        result += (20.0 * Math.sin(Math.PI * x) + 40.0 * Math.sin(Math.PI / 3.0 * x)) * 2.0 / 3.0
        result += (150.0 * Math.sin(Math.PI / 12.0 * x) + 300.0 * Math.sin(Math.PI / 30.0 * x)) * 2.0 / 3.0
        return result
    &#125;

    function wgs2gcj(wgslat, wgslon) &#123;
        if (out_of_china(wgslat, wgslon)) &#123;
            return [wgslat, wgslon]
        &#125;
        var lat = transformlat(wgslon - 105.0, wgslat - 35.0)
        var lon = transformlon(wgslon - 105.0, wgslat - 35.0)
        var rad_lat = Math.PI / 180.0 * wgslat
       var  magic = Math.sin(rad_lat)
        magic = 1 - ee * magic * magic
        var sqrt_magic = Math.sqrt(magic)
        lat = (180.0 * lat) / (Math.PI * (a * (1 - ee)) / (magic * sqrt_magic))
        lon = (180.0 * lon) / (Math.PI * a * Math.cos(rad_lat) / sqrt_magic)
        var chnlat = wgslat + lat
        var chnlon = wgslon + lon
        return [chnlat, chnlon]
    &#125;</code></pre>
<pre><code>
##å‚è€ƒ
&gt;0. [JAVSCRIPT Math](http://www.w3school.com.cn/jsref/jsref_obj_math.asp)

&gt;1. [MySQLç©ºé—´æ•°æ®åº“â€“æŸ¥è¯¢ç‚¹åˆ°å¤šç‚¹é—´çš„æœ€çŸ­è·¯å¾„](http://www.javabloger.com/article/mysql-spatial-database.html)

&gt;2. [W3 Geolocation API Specification](http://www.w3.org/TR/geolocation-API/#position_interface)

&gt;3. [å…³äºç™¾åº¦mapå’Œé«˜å¾·mapï¼Œå…³äºmapåæ ‡ç³»](http://wangsheng2008love.blog.163.com/blog/static/78201689201461674727642/)

&gt;4. [iOS ç«æ˜Ÿåæ ‡ç›¸å…³æ•´ç†åŠè§£å†³æ–¹æ¡ˆæ±‡æ€»](http://it.taocms.org/04/507.htm)

</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/09/02/Django+Mysql+%E5%AE%9E%E7%8E%B0%E5%91%A8%E8%BE%B9%E6%9F%A5%E8%AF%A2/" data-id="cl7mgnxtt000qt2za9if8dfjf" data-title="Django,Mysql,ç©ºé—´æ•°æ®æ˜¯é€šè¿‡Googleåœ°å›¾å’Œé«˜å¾·åœ°å›¾è¿›è¡Œé‡‡é›†çš„" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/09/02/Django+Mysql+%E5%AE%9E%E7%8E%B0%E5%91%A8%E8%BE%B9%E6%9F%A5%E8%AF%A2/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/09/02/Django+Mysql+%E5%AE%9E%E7%8E%B0%E5%91%A8%E8%BE%B9%E6%9F%A5%E8%AF%A2/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GIS/" rel="tag">GIS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-ionic ç¬¬ä¸‰ç«  Trendicity é¡¹ç›®å®ä¾‹" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/08/31/ionic%20%E7%AC%AC%E4%B8%89%E7%AB%A0%20Trendicity%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B/" class="article-date">
  <time class="dt-published" datetime="2015-08-30T16:00:00.000Z" itemprop="datePublished">2015-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/">æ‰©å±•çŸ¥è¯†</a>â–º<a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E8%AF%BB%E4%B9%A6%E5%AD%A6%E4%B9%A0/">è¯»ä¹¦å­¦ä¹ </a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/08/31/ionic%20%E7%AC%AC%E4%B8%89%E7%AB%A0%20Trendicity%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B/">ç¬¬ä¸‰ç«  ionic å®ä¾‹ Trendicity</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ç°åœ¨åœ¨ä½ çš„å·¥å…·ç®±ä¸­æœ‰å¾ˆå¤šå·¥å…·ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆå¼€å‘ä¸€ä¸ªçœŸæ­£çš„æ‰‹æœºåº”ç”¨ã€‚Instagramæ˜¯ä¸€ä¸ªéå¸¸å—æ¬¢è¿çš„ç…§ç‰‡åˆ†äº«åº”ç”¨ã€‚ä½¿è¿™äº›ç…§ç‰‡æ›´åŠ æœ‰è¶£å¹¶ä¸”å±•ç¤ºä¸€äº›IonicåŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªæˆ‘ä»¬å¼€å‘åº”ç”¨ï¼Œå®ƒå« Trendicityã€‚è¿™ä¸ªåº”ç”¨ä»¥å¤šç§æ–¹å¼è·å–å’Œå±•ç¤ºInstagramçš„ç…§ç‰‡ã€‚</p>
<p>ä¸€ç§æ–¹å¼å°±æ˜¯æ ¹æ®ç…§ç‰‡çš„ä½ç½®åœ¨åœ°å›¾ä¸Šè¿›è¡Œå±•ç¤ºã€‚å¦ä¸€ç§æ–¹å¼å°±æ˜¯å°†ç…§ç‰‡å±•ç¤ºåœ¨å¯ä»¥æ»‘åŠ¨çš„å¡ç‰‡ä¸Šï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥æ ‡ç¤ºå‡ºå–œæ¬¢çš„ç…§ç‰‡ã€‚æœ€åä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä»¥åˆ—è¡¨çš„å½¢å¼å±•ç¤ºç…§ç‰‡å’Œæ›´å¤šæœ‰å…³ç…§ç‰‡ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸ªå®Œæ•´çš„<a target="_blank" rel="noopener" href="https://github.com/trendicity/trendicity">Trendicity</a>åº”ç”¨å¯ä»¥åœ¨Githubä¸Šæ‰¾åˆ°ã€‚ä½ å¯ä»¥ä¸‹è½½å®ƒå¹¶åœ¨ä½ çš„æµè§ˆå™¨æˆ–è€…è®¾å¤‡æˆ–ä»¿çœŸå™¨ä¸Šè¿è¡Œã€‚</p>
<p>Trendicityåº”ç”¨æ˜¯ä½œä¸ºä¸€ä¸ªside menu åº”ç”¨å»ºæˆçš„ï¼Œå¯æ˜¯ï¼Œå®ƒä¹Ÿå¾ˆå¥½çš„ç»“åˆäº†tabsæ–¹å¼ã€‚æˆ‘ä»¬å°†ä¼šä»å‡ æ–¹é¢å»è®¨è®ºè¿™ä¸ªåº”ç”¨ã€‚Side Menuå’Œç”¨æˆ·çš„æ“ä½œé€‰é¡¹ï¼Œæœç´¢åŠŸèƒ½ï¼Œå’ŒåŠ è½½æœåŠ¡çš„ä½¿ç”¨å’Œï¼ˆåœ°å›¾ç¤ºå›¾ï¼Œå¡ç‰‡è§†å›¾å’Œåˆ—è¡¨è§†å›¾ï¼‰tabsã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡æ„å»ºè¿™ä¸ªåº”ç”¨æ¥æ·±å…¥äº†è§£ä»£ç ã€‚</p>
<p>##Side menu</p>
<p>ä¾§è¾¹èœå•ç”±ä»¥ä¸‹èœå•é¡¹æ„æˆï¼š</p>
<ul>
<li>HOME</li>
<li>Favorites</li>
<li>About</li>
<li>Login/Logout</li>
</ul>
<p>ä¸‹é¢æ˜¯Trendicityä¾§è¾¹èœå•çš„æˆªå›¾ã€‚å…³äºæ€ä¹ˆæ ·å®ç°ä¾§è¾¹èœå•å’Œè·¯ç”±æ—¶ä¸€ç›´å¸¦ç€å®ƒçš„ç»†èŠ‚ï¼Œè¯·çœ‹ç¬¬å››ç« ï¼šå®ç°ä¾§è¾¹èœå•å’Œé…ç½®è·¯ç”±ã€‚</p>
<p><img src="/images/ionic/side_menu.png" alt="ä¾§è¾¹èœå•"></p>
<p>##Home</p>
<p>HOMEèœå•é€‰é¡¹ç‚¹å‡»æ—¶ä¼šè°ƒç”¨HomtCtrlå’Œå±•ç¤ºåœ°å›¾Tabã€‚åœ°å›¾ä¸Šå°†ä¼šå±•ç¤ºé™„è¿‘çš„ä¸€äº›å›¾ç‰‡ã€‚</p>
<p><img src="/images/ionic/photo_on_map.png" alt="ä¾§è¾¹èœå•"></p>
<p>##Favorites</p>
<p>å¤§ä½“ä¸Šï¼ŒTrendicityåº”ç”¨çš„æ”¶è—åŠŸçš„å®ç°æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼š<code>FavoritesService</code>,<code>FavoritesCtrl</code>å’Œ<code>favorites.html</code>æ¨¡ç‰ˆã€‚</p>
<p>æ”¶è—åŠŸèƒ½æœ‰ä¸¤ç§ç±»å‹çš„ç…§ç‰‡ä¼šè¿›è¡Œæ”¶å­˜æ”¾ï¼šç”¨æˆ·ç”Ÿæˆçš„å’Œè‡ªå·±æ”¶è—çš„ã€‚å‰è€…æ˜¯é€šè¿‡add-favoriteæ¨¡æ€çª—å£æ·»åŠ çš„ï¼Œåè€…æ˜¯é€šè¿‡åœ°å€ä½ç½®ç›´æ¥å…³è”åˆ°Instagramç›¸ç‰‡çš„ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¼šå®é™…æ“ä½œåˆ›å»ºå’Œåˆ é™¤æ”¶è—ï¼Œçœ‹ä¸€ä¸‹æ”¶è—åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°åŠ<code>FavoritesCtrl</code>å’Œ<code>FavoritesServices</code>ä¹‹é—´æ˜¯å¦‚ä½•äº¤äº’çš„ã€‚</p>
<p>###æ”¶è—åˆ—è¡¨</p>
<p>æ”¶è—æ•°æ®åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­å±•ç°ã€‚å½“ç”¨æˆ·è¿›å…¥è¿™ä¸ªè§†å›¾ï¼Œä¼šè§¦å‘<code>$ionicView.enter</code>äº‹ä»¶ï¼Œè¿™ä¸ªè§†å›¾ä¸­çš„æ•°æ®å°†è‡ªåŠ¨åˆ·æ–°ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$scope</span>.<span class="symbol">$o</span>n(<span class="string">&#x27;$ionicView.enter&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="comment">// Update favorites</span></span><br><span class="line">   <span class="symbol">$scope</span>.favorites = FavoritesService.getFavorites();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åˆ—è¡¨ä¸­çš„æ¯ä¸€æ¡æ”¶è—æ¡ç›®ç‚¹å‡»æ—¶éƒ½ä¼šåœ¨æ­¤ç›¸ç‰‡çš„åœ°ç†ä½ç½®ä¸ºä¸­å¿ƒå®šä½åˆ°åœ°å›¾ä¸Šã€‚ä¸‹é¢æ˜¯æ”¶è—è§†å›¾ä¸­å±•ç¤ºæ”¶è—æ•°æ®çš„ä»£ç ï¼š</p>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ion-list</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">ion-item</span> <span class="attr">class</span>=<span class="string">&quot;item-icon-right&quot;</span></span></span></span><br><span class="line"><span class="xml">    ng-repeat=&quot;favorite in favorites track by favorite.id&quot; ui-sref=&quot;app.home.map(</span><span class="template-variable">&#123; latitude: favorite.lat, longitude: favorite.lng &#125;</span><span class="xml">)&quot;&gt;</span></span><br><span class="line"><span class="xml">    \</span><span class="template-variable">&#123;\&#123; favorite.city \&#125;</span><span class="xml">\&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon ion-ios-arrow-forward icon-accessory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ion-option-button</span> <span class="attr">class</span>=<span class="string">&quot;button-assertive&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;deleteFavorite(favorite)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          Remove</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ion-option-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ion-item</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ion-list</span>&gt;</span>  </span></span><br></pre></td></tr></table></figure>

<p><img src="/images/ionic/favorites_list.png" alt="æ”¶è—åˆ—è¡¨"></p>
<p>æ·»åŠ ä¸€äº›å‹å¥½çš„æç¤ºä¿¡æ¯ï¼Œå½“æ²¡æœ‰æ”¶è—ä¿¡æ¯è¦å±•ç¤ºæ—¶ï¼Œåšå¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Display message when no favorites exist --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vertical-center-container&quot;</span> <span class="attr">ng-show</span>=<span class="string">&quot;!favorites.length&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vertical-center text-center&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon ion-heart-broken assertive&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Looks like you haven&#x27;t favorited anything yet...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/ionic/no_favorited.png" alt="æ”¶è—åˆ—è¡¨"></p>
<p>###æ·»åŠ æ”¶è—</p>
<p>ä¸ºäº†ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å†³å®šå°†å¼€å‘æ·»åŠ æ”¶è—åŠŸèƒ½çš„çš„ä»£ç è¿›è¡Œè§£è—•åˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å®ƒæ‹†åˆ†æˆäº† FavoritesCtrl,FavoritesService,add-favorite.htmlæ¨¡ç‰ˆï¼Œå’Œadd-favorite-formæŒ‡ä»¤ï¼Œè®©å®ƒä»¬ç»„åˆåˆ°ä¸€èµ·å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>æ·»åŠ æ”¶è—çš„åŠ¨ä½œï¼Œä»ç‚¹å‡»å³ä¸Šè§’çš„â€™+â€™å·æ‰“å¼€ä¸€ä¸ªæ·»åŠ æ”¶è—çš„æ¨¡æ€çª—å£ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-nav-buttons</span> <span class="attr">side</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button button-icon ion-ios-plus-empty&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;showModalAddFavorite()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-nav-buttons</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼šè§¦å‘FavoriteCtrlçš„showModalAddFavorite()æ–¹æ³•ï¼Œå®ƒä¼šæ‰“å¼€æ·»åŠ æ”¶è—çš„æ¨¡æ€çª—å£ã€‚</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$scope</span>.showModalAddFavorite = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="symbol">$scope</span>.modalAddFavorite.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ€çª—å£ä¸­çš„å†…å®¹éƒ½æ˜¯æœ‰add-favorite-formæŒ‡ä»¤è´Ÿè´£ç”Ÿæˆã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">add-favorite-form</span> <span class="attr">on-submit</span>=<span class="string">&quot;addFavorite(favorite)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">add-favorite-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>![æ·»åŠ æ”¶è—](/images/ionic/add_favorite.png =300x)</p>
<p>addFavoriteFormæŒ‡ä»¤ä¼šåœ¨å…¶å†…éƒ¨å¤„ç†onSubmitã€‚å½“è¿™ä¸ªè¡¨å•å¡«å†™çš„æ²¡æœ‰é—®é¢˜æäº¤æ—¶ï¼Œä¼šè°ƒç”¨addFavoriteFormä¸­çš„submitæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¡¨å•æ²¡æœ‰é—®é¢˜ï¼ŒæŒ‡ä»¤ä¼šè°ƒç”¨submitæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ä»–çš„on-submitå±æ€§ã€‚</p>
<p>ç°åœ¨ï¼ŒæŒ‡ä»Šå¦‚ä½•çŸ¥é“å»å“ªé‡Œæ‰¾åˆ°addFavorite(favorite)æ–¹æ³•å‘¢ï¼Ÿ<br>å½“æˆ‘ä»¬åˆå§‹åŒ–æ¨¡æ€æ—¶ï¼Œä¼šå°†FavoriteCtrlçš„ä½œç”¨åŸŸä¸€å¹¶ä¼ å…¥ã€‚å› æ­¤ï¼Œè¿™ä¸ªæ¨¡æ€çš„ä½œç”¨åŸŸæ˜¯ç»§æ‰¿è‡ªå®ƒçš„çˆ¶ä½œç”¨åŸŸï¼ˆå³æ”¶è—è§†å›¾çš„ä½œç”¨åŸŸï¼‰ï¼›</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$io</span>nicModal.fromTemplateUrl(<span class="string">&#x27;templates/modals/add-favorite.html&#x27;</span>, &#123;</span><br><span class="line">   scope: <span class="symbol">$scope</span></span><br><span class="line"> &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">modal</span>) </span>&#123;</span><br><span class="line">   <span class="symbol">$scope</span>.modalAddFavorite = modal;</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼ŒaddFavorite()æ–¹æ³•å·²ç»ä¸æ§åˆ¶å™¨çš„ä½œç”¨åŸŸç›¸å…³è”ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Add a new favorite using the service</span></span><br><span class="line"><span class="symbol">$scope</span>.addFavorite = <span class="function"><span class="keyword">function</span>(<span class="params">favorite</span>) </span>&#123;</span><br><span class="line">  FavoritesService.add(favorite).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="symbol">$scope</span>.favorites = FavoritesService.getFavorites();</span><br><span class="line">    <span class="symbol">$scope</span>.hideModalAddFavorite();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨FavoritesServiceâ€™s add()æ–¹æ³•åï¼Œå°†ä¼šæ›´æ–°æ”¶è—åˆ—è¡¨å¹¶å…·éšè—add-favoriteæ¨¡æ€ã€‚</p>
<p>###æ·»åŠ æ”¶è—è¡¨å•æŒ‡ä»¤</p>
<p>addFavoriteFormæŒ‡ä»¤ä½¿ç”¨templates/directives/add-favorite-form.htmlä½œä¸ºå®ƒçš„æ¨¡ç‰ˆã€‚è¿™ä¸ªè§†å›¾åŒ…å«äº†è¡¨å•çš„åŸºç¡€éªŒè¯ï¼š</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">&lt;form name=<span class="string">&quot;formAddFavorite&quot;</span> no-validate&gt;</span><br><span class="line">  &lt;label <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;item item-input item-stacked-label&quot;</span> ng-<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;&#123; &#x27;item-error&#x27;: formAddFavorite.$attempt &amp;&amp; formAddFavorite.city.$invalid, &#x27;item-valid&#x27;: formAddFavorite.city.$valid &#125;&quot;</span>&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;input-label&quot;</span>&gt;<span class="type">City</span>&lt;/span&gt;</span><br><span class="line">    &lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;city&quot;</span> ng-model=<span class="string">&quot;favorite.city&quot;</span> placeholder=<span class="string">&quot;Dallas&quot;</span> required=<span class="string">&quot;required&quot;</span>&gt;</span><br><span class="line">  &lt;/label&gt;</span><br><span class="line">  &lt;label <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;item item-input item-stacked-label&quot;</span> ng-<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;&#123; &#x27;item-error&#x27;: formAddFavorite.$attempt &amp;&amp; formAddFavorite.region.$invalid, &#x27;item-valid&#x27;: formAddFavorite.region.$valid &#125;&quot;</span>&gt;</span><br><span class="line">    &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;input-label&quot;</span>&gt;<span class="type">State</span> or <span class="type">Country</span>&lt;/span&gt;</span><br><span class="line">    &lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;region&quot;</span> ng-model=<span class="string">&quot;favorite.region&quot;</span> placeholder=<span class="string">&quot;TX&quot;</span> required=<span class="string">&quot;required&quot;</span>&gt;</span><br><span class="line">  &lt;/label&gt;</span><br><span class="line">  &lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button button-full button-positive&quot;</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">&quot;button&quot;</span> ng-click=<span class="string">&quot;submit()&quot;</span>&gt;<span class="type">Add</span>&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>â€œAddâ€æŒ‰é’®ä¼šè°ƒç”¨å‘½ä»¤çš„submit()æ–¹æ³•ï¼Œä¼šæ·»åŠ ä¸€ä¸ª$attemptå­—æ®µåˆ°è¡¨å•ä¸­ï¼Œæ ‡ç¤ºç”¨æˆ·å·²ç»æœ€è¿‘å·²ç»æäº¤äº†ä¸€æ¬¡è¿™ä¸ªè¡¨å•ã€‚è¿™ä¸ªå­—æ®µè¢«ç”¨æ¥é«˜äº®ä¸åˆæ³•å’Œæ²¡æœ‰è¾“å…¥çš„è¾“å…¥é€‰é¡¹ã€‚</p>
<p><img src="/images/ionic/invalid_form.png" alt="æœ‰é—®é¢˜çš„è¡¨å•"></p>
<p>æœ€åï¼Œå½“è¿™ä¸ªè¡¨å•éªŒè¯é€šè¿‡åï¼ŒæŒ‡ä»¤ä¼šé€šè¿‡æ¨¡æ€ä¸­çš„ä¸€ä¸ªå±æ€§è°ƒç”¨onSubmit()æ–¹æ³•ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$scope</span>.submit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="symbol">$scope</span>.formAddFavorite.<span class="symbol">$attempt</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="symbol">$scope</span>.formAddFavorite.<span class="symbol">$valid</span>) &#123;</span><br><span class="line">         <span class="symbol">$scope</span>.onSubmit(&#123; <span class="attr">favorite</span>: <span class="symbol">$scope</span>.favorite &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure>

<p>![åˆæ³•çš„è¡¨å•](/images/ionic/valid_form.png =300x)</p>
<p>è€Œä¸”ï¼Œåœ¨è¿™ä¸ªæ¨¡æ€å…³é—­æ—¶ï¼Œå…¶ä¸­æ·»åŠ æ”¶è—çš„è¡¨å•ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚å®ƒæ˜¯é€šè¿‡ç›‘å¬modal.hiddenäº‹ä»¶æ¥è¿›è¡Œå®ç°çš„ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$scope</span>.<span class="symbol">$o</span>n(<span class="string">&#x27;modal.hidden&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="comment">// Clear form</span></span><br><span class="line">       <span class="symbol">$scope</span>.favorite = <span class="literal">null</span>;</span><br><span class="line">       <span class="symbol">$scope</span>.formAddFavorite.<span class="symbol">$attempt</span> = <span class="literal">false</span>;</span><br><span class="line">       <span class="symbol">$scope</span>.formAddFavorite.<span class="symbol">$set</span>Pristine(<span class="literal">true</span>);</span><br><span class="line">     &#125;);</span><br></pre></td></tr></table></figure>

<p>###åˆ é™¤æ”¶è—</p>
<p>å½“ä½ æ»‘åŠ¨æ”¶è—æ¡ç›®æ—¶å°±å¯ä»¥è¿›è¡Œåˆ é™¤æ”¶è—æ“ä½œã€‚</p>
<p>![åˆ é™¤æ”¶è—](/images/ionic/remove_operate.png =300x)</p>
<p>ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼Œå°†ä¼šè°ƒç”¨FavoritesCtrlçš„deleteFavorite()æ–¹æ³•åˆ é™¤å½“å‰æ”¶è—çš„å¼•ç”¨ã€‚åœ¨æ§åˆ¶å™¨è¿™è¾¹ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨FavoritesServiceçš„deleteæ–¹æ³•ï¼Œå°†æ”¶è—åˆ—è¡¨ä¸­çš„å½“å‰æ“ä½œçš„æ”¶è—é¡¹åˆ é™¤ã€‚</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Delete a favorite using the service and update scope var</span></span><br><span class="line"><span class="symbol">$scope</span>.deleteFavorite = <span class="function"><span class="keyword">function</span> (<span class="params">favorite</span>) </span>&#123;</span><br><span class="line">  <span class="symbol">$scope</span>.favorites = FavoritesService.delete(favorite);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>###æ”¶è—æœåŠ¡</p>
<p>FavoritesServiceæ˜¯ç”¨æ ‡å‡†æ–¹å¼æ¥å¤„ç†Trendicityä¸­ä¸æ”¶è—ç›¸å…³çš„æœåŠ¡ã€‚å®ƒå°†æ”¶è—ç›¸å…³é€»è¾‘ä¸Trendicityå…¶å®ƒåŠŸèƒ½éš”ç¦»å¼€ã€‚ç”¨è¿™ç§æ–¹å¼çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯FavoritesServiceæœåŠ¡å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ª Controllerä¸­ä½¿ç”¨ã€‚åƒæˆ‘ä»¬åœ¨åˆ—è¡¨è§†å›¾ä¸­å®ç°çš„é‚£æ ·,è¿™ä¸ªæœåŠ¡è¢«ç”¨æ¥æ”¶è—è‡ªå·±å–œæ¬¢çš„åœ°ç†ä½ç½®ã€‚</p>
<p>è¿™ä¸ªæœåŠ¡æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼šadd(),getFavorites()å’Œdelete()</p>
<p>æ­£å¦‚å®ƒä»¬çš„åå­—å«çš„é‚£æ ·ï¼ŒgetFavorites()ä¼šç›´æ¥è¿”å›å½“å‰æœ¬åœ°çš„æ‰€æœ‰æ”¶è—ã€‚</p>
<p>æ·»åŠ æ”¶è—æ—¶çš„å¤„ç†æ–¹å¼æ ¹æ®æ”¶è—çš„ç±»å‹è€Œå®šã€‚å¯¹äºäººä»¬ç»å¸¸æ”¶è—çš„åŸå¸‚æˆ–åŒºåŸŸï¼Œè¿™ä¸ªç±»å‹çš„æ”¶è—ä¼šç”¨GeolocationServiceçš„addressToPosition()æ–¹æ³•è·å–åœ°ç†åæ ‡ã€‚è¿™ä¸ªå®ç°æˆ‘ä»¬åœ¨ç¨åç« èŠ‚ä¸­ä¼šè¿›è¡Œè®¨è®ºã€‚å½“è·å–åˆ°äº†åœ°å€ç»çº¬åº¦ï¼Œè¿™ä¸ªæ”¶è—ä¼šç»Ÿä¸€æ ¼å¼åŒ–ä¸€ç§ç»“æ„å­˜å‚¨åˆ°æœ¬åœ°çš„æ”¶è—æ•°ç»„ä¸­ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">var<span class="built_in"> address </span>= favorite.city + <span class="string">&#x27;, &#x27;</span> + favorite.region;</span><br><span class="line">    return GeolocationService.addressToPosition(address).then(function (data) &#123;</span><br><span class="line">      var newLocation = &#123;</span><br><span class="line">        id: favoritesId,</span><br><span class="line">        city: address,</span><br><span class="line">        lat: data.latitude,</span><br><span class="line">        lng: data.longitude</span><br><span class="line">      &#125;;</span><br><span class="line">      favorites.push(newLocation);</span><br><span class="line">      localStorageService.<span class="builtin-name">set</span>(<span class="string">&#x27;Favorites&#x27;</span>, favorites);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é’ˆå¯¹å…·ä½“çš„æ”¶è—ï¼Œæ”¶è—ä¼šåœ¨åˆ—è¡¨è§†å›¾çš„æ§åˆ¶å™¨ä¸­è¿›è¡Œåˆé€‚çš„æ ¼å¼åŒ–å¤„ç†ï¼Œå’Œç”¨æˆ·æ·»åŠ çš„æ”¶è—çš„å¤„ç†è¿‡ç¨‹ç›¸ä¿¡ï¼Œå­˜æ”¾åˆ°æœ¬åœ°æ”¶è—æ•°æ®ä¸­ã€‚</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">new</span><span class="type">Location</span> = &#123;</span><br><span class="line">   id: <span class="type">favoritesId</span>,</span><br><span class="line">   city: <span class="type">address</span>,</span><br><span class="line">   lat: <span class="type">data</span>.latitude,</span><br><span class="line">   lng: <span class="type">data</span>.longitude</span><br><span class="line">&#125;;</span><br><span class="line">favorites.push(<span class="keyword">new</span><span class="type">Location</span>);</span><br><span class="line">localStorageService.<span class="keyword">set</span>(<span class="string">&#x27;Favorites&#x27;</span>, favorites);</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ç¡®ä¿å‡†ç¡®å®šä½ï¼Œè¿™ä¸ªæœåŠ¡ä¸ºç¬¬ä¸€ä¸ªæ”¶è—ç”Ÿæˆäº†ä¸€ä¸ªå¯¹åº”çš„IDã€‚æ¯ä¸€ä¸ªidéƒ½æ˜¯æ ¹æ®å½“å‰ç³»ç»Ÿçš„æ—¶é—´ç”Ÿæˆçš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">favorite</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> favorites = <span class="built_in">this</span>.getFavorites() || [];</span><br><span class="line">   <span class="keyword">var</span> favoritesId =  <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ é™¤æ”¶è—çš„å·¥ä½œé€šè¿‡ä½¿ç”¨lodashçš„remove()æ–¹æ³•å®ç°ã€‚åˆ é™¤äº†æ”¶è—åï¼Œæ›´æ–°æœ¬åœ°æ”¶è—å¹¶å°†æœ€æ–°çš„æ”¶è—åˆ—è¡¨è¿”å›ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DELETE</span></span><br><span class="line"><span class="keyword">this</span>.delete = function (favorite) &#123;</span><br><span class="line">  <span class="keyword">var</span> favorites = <span class="keyword">this</span>.getFavorites();</span><br><span class="line">  _.remove(favorites, favorite); <span class="comment">// jshint ignore:line</span></span><br><span class="line">  localStorageService.<span class="keyword">set</span>(<span class="string">&#x27;Favorites&#x27;</span>, favorites);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.getFavorites();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>##About</p>
<p>â€˜Aboutâ€™èœå•é€‰é¡¹ç‚¹å‡»æ—¶ä¼šæ»‘å‡ºç•Œé¢ï¼ŒåŒ…å«ä¸€äº›åº”ç”¨çš„ä»‹ç»ä¿¡æ¯ã€‚è¿™ä¸ªé¡µé¢ä¼šåœ¨åº”ç”¨ç¨‹åºç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ˜¾ç¤ºã€‚</p>
<p><img src="/images/ionic/about_1.png"></p>
<p><img src="/images/ionic/about_2.png"></p>
<p><img src="/images/ionic/about_3.png"></p>
<p>##Login/Logout</p>
<p>å½“ç”¨æˆ·è¿˜æ²¡æœ‰ç™»é™†è¦ç™»é™†æ—¶ï¼Œç‚¹å‡»èœå•çš„â€™Loginâ€™æ—¶ä¼šæ˜¾ç¤ºç™»é™†ç•Œé¢ã€‚ä¸€æ—¦ç”¨æˆ·ç™»é™†åï¼Œå†ç‚¹å¼€èœå•ï¼Œâ€™Logoutâ€™é€‰é¡¹å°†å‡ºå±•ç¤ºã€‚</p>
<p>ä¸‹é¢æ˜¯www/templates/menu.htmléƒ¨åˆ†ä»£ç ç‰‡æ–­ï¼Œå±•ç¤ºäº†å¦‚ä½•ç”¨ng-showå’Œng-hideå®ç°ä¸Šè¿°åŠŸèƒ½ã€‚</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;ion-<span class="built_in">item</span> menu-close <span class="built_in">class</span>=<span class="string">&quot;item-icon-left&quot;</span> ng-click=<span class="string">&quot;login()&quot;</span> ng-hide=<span class="string">&quot;isLoggedIn()&quot;</span>&gt;</span><br><span class="line">    &lt;i <span class="built_in">class</span>=<span class="string">&quot;icon ion-log-in&quot;</span>&gt;&lt;/i&gt;</span><br><span class="line">    Login</span><br><span class="line">&lt;/ion-<span class="built_in">item</span>&gt;</span><br><span class="line">&lt;ion-<span class="built_in">item</span> menu-close <span class="built_in">class</span>=<span class="string">&quot;item-icon-left&quot;</span> ng-click=<span class="string">&quot;logout()&quot;</span> ng-show=<span class="string">&quot;isLoggedIn()&quot;</span>&gt;</span><br><span class="line">    &lt;i <span class="built_in">class</span>=<span class="string">&quot;icon ion-log-out&quot;</span>&gt;&lt;/i&gt;</span><br><span class="line">    Logout</span><br><span class="line">&lt;/ion-<span class="built_in">item</span>&gt;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥åœ¨www/controllers/app.jsæ–‡ä»¶ä¸­æ‰¾åˆ°isLoggedIn,loginå’Œlogoutæ–¹æ³•ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Determine if the user is logged into Instagram</span></span><br><span class="line"><span class="symbol">$scope</span>.isLoggedIn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> InstagramService.isLoggedIn();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open the login modal</span></span><br><span class="line"><span class="symbol">$scope</span>.login = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="symbol">$scope</span>.loginModal.show();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Perform the logout action when the user invokes the logout link</span></span><br><span class="line"><span class="symbol">$scope</span>.logout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  InstagramService.logout();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>isLoggedInæ–¹æ³•ä¼šè°ƒç”¨InstagramServiceçš„isLoggedIn()æ–¹æ³•æ¥è·å–å½“å‰ç™»é™†çŠ¶æ€ã€‚é€€å‡ºæ–¹æ³•ä¼šè°ƒç”¨InstagramServiceçš„logout()æ–¹æ³•æ¥è¿›è¡Œç™»è®°é€€å‡ºåŠ¨ä½œã€‚æˆ‘ä»¬ä¼šåœ¨ç¬¬å…«ç« è®²è§£æ›´å¤šå…³äºInstagramServiceç›¸å…³çš„å†…å®¹ã€‚</p>
<p>ä¸ºäº†åšæ›´å¤šå’ŒInstagramç›¸å…³å¹¶æœ‰è¶£çš„äº‹æƒ…ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æˆ·ç™»é™†åˆ°Instagramã€‚ä¸ºäº†å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª$ionicModalæ˜¾ç¤ºä¸ºä»€ä¹ˆè®©ç”¨æˆ·ç™»é™†çš„ç®€è¦çš„æè¿°ã€‚å½“é€‰æ‹©äº†ç™»é™†é€‰é¡¹ï¼Œloginæ–¹æ³•è¢«è°ƒç”¨ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ä¸€ä¸ªç™»é™†æ¨¡æ€ã€‚</p>
<p>![ç™»é™†æˆªå›¾](/images/ionic/login.png =300x)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Create the login modal that we will use later</span></span><br><span class="line">$ionicModal.fromTemplateUrl(<span class="string">&#x27;templates/modals/login.html&#x27;</span>, &#123;</span><br><span class="line">  scope: $scope,</span><br><span class="line">  animation: <span class="string">&#x27;slide-in-up&#x27;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">modal</span>) </span>&#123;</span><br><span class="line">  $scope.loginModal = modal;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Triggered in the login modal to close it</span></span><br><span class="line">$scope.closeLogin = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  InstagramService.loginCancelled();</span><br><span class="line">  $scope.loginModal.hide();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Cleanup the modal when we&#x27;re done with it!</span></span><br><span class="line">$scope.$on(<span class="string">&#x27;$destroy&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $scope.loginModal.remove();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ï¼Œç™»é™†é¡µé¢åƒä¸‹é¢æˆªå›¾ä¸­å±•ç¤ºä¸€æ ·ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬è¦ä¸Instagramé›†æˆï¼Œæˆ‘ä»¬éœ€è¦OAuthçš„æ–¹å¼è¿›è¡Œç™»é™†ã€‚</p>
<p><img src="/images/ionic/normal_login.png" alt="ç™»é™†æˆªå›¾"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-modal-view</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ion-header-bar</span> <span class="attr">class</span>=<span class="string">&quot;bar-transparent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;buttons&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button button-light button-clear button-icon button-right icon ion-close&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;closeLogin()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ion-content</span> <span class="attr">scroll</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vertical-center-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vertical-center&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row light-bg&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span>Login with Instagram to<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon ion-heart assertive&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Like Posts<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon ion-images&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> View Your Feed<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon ion-star energized&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> View Your Liked Posts<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button button-block button-positive button-outline icon-left ion-social-instagram-outline&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;loginToInstagram()&quot;</span>&gt;</span>Login with Instagram<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-modal-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”¨Oauthä»£æ›¿ä¼ ç»Ÿçš„ç™»é™†æ–¹å¼ï¼Œè®©ç”¨æˆ·çŸ¥é“ä¸€æ—¦ç™»é™†åˆ°äº†Instagram,ä»–ä»¬èƒ½åšå“ªäº›äº‹æƒ…ã€‚ä¸€æ—¦ç”¨æˆ·ç¡®å®šç™»é™†åˆ°Instagram,æˆ‘ä»¬ä¼šè°ƒç”¨www/controllers/app.jsä¸­çš„loginToInstagramæ–¹æ³•ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Perform the OAuth login to Instagram</span></span><br><span class="line"><span class="symbol">$scope</span>.loginToInstagram = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="symbol">$scope</span>.loginModal.hide();</span><br><span class="line">  InstagramService.login();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•å°†ä¼šç”¨InAppBrowser Cordovaæ’ä»¶æ‰§è¡ŒOAuthæˆæƒã€‚æˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸ªæ’ä»¶æ‰“å¼€ä¸€ä¸ªç™»é™†åˆ°Instagramçª—å£ã€‚Trendicityåº”ç”¨æ²¡æœ‰å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œå¤„ç†ã€‚</p>
<p>![Instagramç™»é™†](/images/ionic/instagram_login.png =300x)</p>
<p>##Search</p>
<p>æœç´¢å›¾æ ‡å°±æ˜¯åœ¨åˆ—è¡¨æˆ–å¡ç‰‡è§†å›¾çš„å³ä¸Šè§’çš„æ”¾å¤§é•œå›¾æ ‡ã€‚ç”¨æˆ·æœ‰ä»¥ä¸‹æŸ¥è¯¢é€‰é¡¹ï¼š</p>
<ul>
<li>Trending - æŒ‰å½“å‰åœ¨Instagramä¸Šå¸–å­çš„å—æ¬¢è¿ç¨‹åºè¿›è¡Œæ’åºã€‚</li>
<li>Nearby - å½“å‰ç”¨æˆ·æ‰€åœ¨ä½ç½®1KMèŒƒå›´å†…å‘å¸ƒçš„å¸–å­ã€‚</li>
<li>My Feed - å½“å‰ç”¨æˆ·æä¾›ç»™Instagramçš„ä¿¡æ¯ã€‚</li>
<li>My Liked Posts -å½“å‰ç”¨æˆ·å–œæ¬¢çš„å¸–å­ã€‚</li>
</ul>
<p>![search](/images/ionic/search.png =300x)</p>
<p>åœ¨HomeCtrlä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†æŸ¥è¯¢åŠŸèƒ½ã€‚ä¸ºäº†å…³æ³¨æœç´¢åŠŸèƒ½ï¼Œä¸‹é¢ä»£ç è¿›è¡Œç¨å¾®çš„å‹ç¼©ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€äº›ä½œç”¨åŸŸå˜é‡æ¥ä¿å­˜å¸–å­å’ŒæŸ¥è¯¢å˜é‡ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªjavascriptå¯¹è±¡æ¥å­˜æ”¾ï¼Œæ‰€ä»¥å½“å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯¹è±¡ä¸ä¼šä¸¢å¤±ã€‚</p>
 <figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$scope</span>.model = PostsService.getModel();</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$scope</span>.search = &#123;value:POST_TYPE.NEARBY&#125;;</span></span><br></pre></td></tr></table></figure>

<p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®$scope.getPostsæ–¹æ³•ï¼Œå®ƒå°†ä¼šæ ¹æ®æŸ¥è¯¢å€¼å†³å®šå“ªäº›æŸ¥è¯¢æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p>
 <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">$scope.getPosts = <span class="keyword">function</span>(value) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value<span class="operator"> === </span>POST_TYPE.TRENDING) &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">PostsService</span>.</span></span>find<span class="constructor">PopularPosts()</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value<span class="operator"> === </span>POST_TYPE.NEARBY) &#123;</span><br><span class="line">    $scope.find<span class="constructor">NearbyPosts()</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value<span class="operator"> === </span>POST_TYPE.USER_FEED) &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">PostsService</span>.</span></span>find<span class="constructor">UserFeedPosts()</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value<span class="operator"> === </span>POST_TYPE.LIKED) &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">PostsService</span>.</span></span>find<span class="constructor">LikedPosts()</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> é€šè¿‡$watchç›‘å¬ionicPopoverä¸­æŸ¥è¯¢å˜é‡å€¼çš„å˜åŒ–æ¥åŠæ—¶è°ƒç”¨$scope.getPostsæ–¹æ³•æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚<br> <figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$scope</span>.updatePosts = <span class="function"><span class="keyword">function</span> (<span class="params">searchValue</span>) </span>&#123;</span><br><span class="line">  <span class="symbol">$scope</span>.getPosts(searchValue);</span><br><span class="line">  <span class="symbol">$scope</span>.closePopover();</span><br><span class="line">  <span class="symbol">$io</span>nicScrollDelegate.scrollTop();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="symbol">$scope</span>.<span class="symbol">$watc</span>h(<span class="string">&#x27;search.value&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Triggered when user changes search value</span></span><br><span class="line">    <span class="symbol">$scope</span>.updatePosts(newValue);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br></pre></td></tr></table></figure></p>
<p>ä¸ºäº†å®ç°ionicPopover,æˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ fromTemplateUrl æ–¹æ³•åŠ è½½ html æ¨¡ç‰ˆã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå°†å…¶ä½œç”¨åŸŸè®¾ç½®ä¸ºå½“å‰ä½œç”¨åŸŸã€‚å½“templateåŠ è½½æ—¶ï¼Œæˆ‘ä»¬å°†popoverè®¾ç½®åˆ°è¿™ä¸ªä½œç”¨åŸŸä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬åé¢è¿›è¡Œè°ƒç”¨ã€‚</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$io</span>nicPopover.fromTemplateUrl(<span class="string">&#x27;templates/search.html&#x27;</span>, &#123;</span><br><span class="line">  scope: <span class="symbol">$scope</span>,</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">popover</span>) </span>&#123;</span><br><span class="line">  <span class="symbol">$scope</span>.popover = popover;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢è¿™æ®µ search.html æ¨¡ç‰ˆç‰‡æ®µã€‚æˆ‘ä»¬ä½¿ç”¨äº†ion-popover-view ç»„ä»¶å®šä¹‰è¿™ä¸ªè§†å›¾ã€‚æˆ‘ä»¬ä½¿ç”¨ ion-header-bar ç»„ä»¶å±•ç¤ºå¼¹å‡ºçª—å£çš„æ ‡é¢˜ã€‚æˆ‘ä»¬å°† ion-radio ç»„ä»¶åˆ—è¡¨æ”¾åˆ° ion-content ç»„ä»¶ä¸­ã€‚ion-radioç»„ä»¶é€‰æ‹©åï¼Œä¼šä½œä¸ºæœç´¢å‚è€ƒå€¼ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-popover-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ion-radio</span> <span class="attr">ng-model</span>=<span class="string">&quot;search.value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;TR&quot;</span>&gt;</span>Trending<span class="tag">&lt;/<span class="name">ion-radio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ion-radio</span> <span class="attr">ng-model</span>=<span class="string">&quot;search.value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;NB&quot;</span>&gt;</span>Nearby<span class="tag">&lt;/<span class="name">ion-radio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ion-radio</span> <span class="attr">ng-model</span>=<span class="string">&quot;search.value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UF&quot;</span>&gt;</span>My Feed<span class="tag">&lt;/<span class="name">ion-radio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ion-radio</span> <span class="attr">ng-model</span>=<span class="string">&quot;search.value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LP&quot;</span>&gt;</span>My Liked Posts<span class="tag">&lt;/<span class="name">ion-radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-popover-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·ç‚¹å‡»åœ¨templates/home.htmlä¸­å®šä¹‰çš„å¯¼èˆªæŒ‰é’®æ—¶ è¿™ä¸ª ionicPopover å°†ä¼šå¼¹å‡ºã€‚ä¸‹é¢åœ°è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-nav-buttons</span> <span class="attr">side</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button button-icon icon ion-ios-search&quot;</span> <span class="attr">ng-click</span>=<span class="string">&quot;openPopover($event)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-nav-buttons</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”±ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå½“ç”¨æˆ·ç‚¹å‡»Searchå›¾æ ‡æ—¶ï¼Œä¼šè°ƒç”¨openPopoveræ–¹æ³•ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯è®©popoveræ˜¾ç¤ºã€‚å½“é€‰æ‹©äº†ä¸€ä¸ªå€¼æ—¶ï¼Œå°†ä¼šè°ƒç”¨closePopoveræ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¦ç¡®è®¤popoveræ˜¯å·²ç»å®šä¹‰å¹¶æ˜¯æ‰“å¼€çš„ã€‚å¦‚ä½•æ¡ä»¶æ»¡è¶³ï¼Œæˆ‘ä»¬å°±å°†å…¶å…³é—­ã€‚æœ€åä¸€ä»¶äº‹æƒ…å°±æ˜¯ä¸ºpopoverè®¾ç½®ä¸€ä¸ª$destroyç›‘å¬ï¼Œå½“popoverè¢«ä»Domä¸­ç§»é™¤æ—¶è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$scope.openPopover = <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</span><br><span class="line">     $scope.popover.show($event);</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   $scope.closePopover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> ($scope.popover &amp;&amp; $scope.popover.isShown()) &#123;</span><br><span class="line">       $scope.popover.hide();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Cleanup the popover when we&#x27;re done with it!</span></span><br><span class="line">   $scope.$on(<span class="string">&#x27;$destroy&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> ($scope.popover) &#123;</span><br><span class="line">       $scope.popover.remove();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>##åŠ è½½æœåŠ¡</p>
<p>å½“ç…§ç‰‡è¿›è¡ŒåŠ è½½æ—¶ï¼Œç”¨æˆ·ä¼šä¸çŸ¥é“åº”ç”¨åœ¨åšä»€ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥é€šçŸ¥ç”¨æˆ·å½“å‰æ˜¯åœ¨åŠ è½½æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$ionicLoadingç»„ä»¶æ¥å®Œæˆè¿™ä»¶äº‹æƒ…ã€‚</p>
<p>![loading](/images/ionic/ionic_loading.png =300x)</p>
<p>ä¸€ç§èªæ˜çš„æ–¹å¼å°±æ˜¯å°† $ionicLoading ç»„ä»¶è°ƒç”¨ç”¨æ”¾åœ¨ä¸€ä¸ªHTTPæ‹¦æˆªå™¨ä¸­ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å‹ç¼©åçš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">.factory(<span class="string">&#x27;TrendicityInterceptor&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">$injector, $q</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hideLoadingModalIfNecessary = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $http = $http || $injector.get(<span class="string">&#x27;$http&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> ($http.pendingRequests.length === <span class="number">0</span>) &#123;</span><br><span class="line">        $injector.get(<span class="string">&#x27;$ionicLoading&#x27;</span>).hide();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      request: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">        $injector.get(<span class="string">&#x27;$ionicLoading&#x27;</span>).show();</span><br><span class="line">       ...</span><br><span class="line">      requestError: <span class="function"><span class="keyword">function</span>(<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">        hideLoadingModalIfNecessary();</span><br><span class="line">        <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">      &#125;,</span><br><span class="line">      response: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        hideLoadingModalIfNecessary();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      &#125;,</span><br><span class="line">      responseError: <span class="function"><span class="keyword">function</span>(<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">        hideLoadingModalIfNecessary();</span><br><span class="line">        <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“HTTPè¯·æ±‚å‘ç”Ÿæ—¶ï¼Œrequestæ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¾ç¤ºæ–‡å­— â€œLoadingâ€ã€‚ä¸ºäº†é¿å…ä¾èµ–æ­»å¾ªç¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨Angular $injectorç»„ä»¶æ¥è·å–$ionicLoadingæœåŠ¡ã€‚</p>
<p>å½“HTTPè¯·æ±‚å‡ºç°é”™è¯¯æ—¶ï¼Œè¿™é‡Œä¼šè°ƒç”¨requestErroræ–¹æ³•ã€‚æˆ‘ä»¬ä¼šè°ƒç”¨hideLoadingModalIfNecesary()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ£€æŸ¥æ˜¯å¦æœ‰HTTPè¯·æ±‚åœ¨è¢«è°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰ionicLoadingæœåŠ¡ä¼šå°†è‡ªå·±éšè—ã€‚</p>
<p>å½“HTTPå“åº”æˆåŠŸæ—¶ï¼Œä¼šè°ƒç”¨responseæ–¹æ³•ã€‚ä¹‹ååšçš„äº‹æƒ…ä¸é”™è¯¯æ—¶çš„å¤„ç†æ–¹æ³•ç±»ä¼¼ã€‚</p>
<p>å½“HTTPå“åº”é”™è¯¯æ—¶ï¼Œä¼šè°ƒç”¨responseErroræ–¹æ³•ã€‚ä¹‹ååšçš„äº‹æƒ…ä¸ä¸Šé¢ä¸¤ç§æƒ…å†µå¤„ç†æ–¹æ³•ç±»ä¼¼ã€‚</p>
<p>ä¸ºäº†ä½¿æˆ‘ä»¬çš„HTTPæ‹¦æˆªå™¨ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦è®©AngularJSçŸ¥é“å®ƒçš„å­˜åœ¨ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨www/app.jsä¸­åšè¿™ä»¶äº‹æƒ…ã€‚è¿™é‡Œæ˜¯æˆ‘ä»¬å°†æ‹¦æˆªå™¨é€šè¿‡$httpProvideræ·»åŠ åˆ°æ‹¦æˆªå™¨æ•°æ®ä¸­çš„æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$httpProvider</span>) </span>&#123;</span><br><span class="line">  $httpProvider.interceptors.push(<span class="string">&#x27;TrendicityInterceptor&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰æ˜¾ç¤ºçœŸæ­£çš„æç¤ºä¿¡æ¯ï¼Œåªæ˜¯åœ¨www/app.jsä¸­è®¾ç½®äº†ä¸€ä¸ªé»˜è®¤ä¿¡æ¯:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">.<span class="keyword">constant</span>(<span class="string">&#x27;$ionicLoadingConfig&#x27;</span>, &#123;</span><br><span class="line">  <span class="keyword">template</span>: <span class="string">&#x27;&lt;ion-spinner&gt;&lt;/ion-spinner&gt;Loading...&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ç¬¬ä¸ƒç« ä¼šè¯¦ç»†è®²è§£ï¼šè®¾è®¡åº”ç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆä¸å‘ionicLoading showæ–¹æ³•ä¸­ä¼ å…¥ä¿¡æ¯ã€‚</p>
<p>##Mapè§†å›¾é€‰é¡¹</p>
<p>å°†å½“å‰æäº¤çš„ä¿¡æ¯åœ¨ä¸€ä¸ªå¯ä»¥äº¤äº’çš„åœ°å›¾ä¸Šå±•ç¤ºã€‚ä¸€ä¸ªæ ‡è®°ä¼šå°†ç”¨æˆ·çš„ä½ç½®æ ‡åœ¨åœ°å›¾ä¸Šã€‚åˆ«çš„ç…§ç‰‡æŒ‰å®ƒçš„ä½ç½®å±•ç°åœ¨åœ°å›¾ä¸Šã€‚å½“ç‚¹å‡»è¿™ä¸ªè¿™ä¸ªæ ‡è®°æ—¶ï¼Œç›¸å…³è”çš„ç…§ç‰‡ä¼šå±•ç°å‡ºæ¥ã€‚å¦‚æœä½ ç§»åŠ¨åœ°å›¾åˆ°ä¸€ä¸ªä½ç½® ï¼Œç„¶åç‚¹å‡»å³ä¸Šè§’çš„åˆ·æ–°å›¾æ ‡ï¼›å°±ä¼šåŠ è½½å½“å‰ä½ç½®å‘¨è¾¹çš„ç…§ç‰‡ã€‚è‹¥æƒ³äº†è§£å¦‚ä½•å®ç°çš„ï¼Œè¯·çœ‹ç¬¬äº”ç« ï¼šåœ¨ionicä¸Šé›†æˆåœ°å›¾ã€‚</p>
<p>##Cardå®å›¾é€‰é¡¹</p>
<p>å¡ç‰‡è§†å›¾å°†ä»¥å¡ç‰‡å åŠ çš„æ–¹å¼æ¥å±•ç°ç…§ç‰‡ã€‚è‹¥ç”¨æˆ·ä¸å–œæ¬¢å½“å‰çš„ç…§ç‰‡ï¼Œå¯ä»¥å°†å›¾ç‰‡å‘å·¦ä¾§æ‹–æ‹½æˆ–åˆ’åŠ¨ã€‚å¦‚æœå–œæ¬¢çš„è¯å¯ä»¥å‘å³ä¾§æ‹–æ‹½æˆ–åˆ’åŠ¨ã€‚</p>
<p>è¿™äº›å¯ä»¥æ‘†åŠ¨çš„å¡åˆ¸ä¸éå¸¸å—æ¬¢è¿çš„æ‰‹æœºåº”ç”¨Tinderç›¸ä¼¼ã€‚è¿™ç§ç±»ä¼¼çš„å®ç”¨çš„åŠŸèƒ½åœ¨Tinderä¸­ç»å¸¸ä¼šè¢«ç”¨åˆ°ã€‚</p>
<p>Drifyï¼ˆè¯¥å…¬å¸è´Ÿè´£æˆ‘ä»¬çš„ionicæŠ€æœ¯ï¼‰åˆ›å§‹äººä¹‹ä¸€Max Lynchå·²ç»åˆ›å»ºäº†ä¸€ä¸ªåˆ’åŠ¨å¡ç‰‡çš„åº“ï¼Œè¿™ä¸ªåº“ç»å¸¸ä¼šè¢«ionicå¼€å‘å›¢é˜Ÿå¼•ç”¨ã€‚åœ¨ionicä¸­è¿™æ ·çš„æ•ˆæœå±•ç¤ºé€šå¸¸ä¼šæ¯”è¾ƒå—æ¬¢è¿çš„ã€‚</p>
<p>è¿™ä¸ªç±»åº“ç”¨CSSçš„åŠ¨ç”»æ¥å®ç°å¡ç‰‡å·¦å³æ‹–æ‹½å’Œæ‘†åŠ¨çš„æ•ˆæœã€‚ä»–ä¹Ÿä½¿ç”¨äº†ä¸€ä¸ªç‰©ç†æ ·å¼åŠ¨åŒ–æ•ˆæœåº“Collideæ¥å®ç°å°†å›¾ç‰‡ä¸‹æ‹‰æ—¶çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p>åœ¨ä½¿ç”¨Tinderå¡ç‰‡åº“ä¹‹å‰ï¼Œä¸€ä¸ªéå¸¸ç›¸ä¼¼çš„å¡ç‰‡åˆ’åŠ¨æ•ˆæœè¢«åˆ›å»ºã€‚æˆ‘ä»¬åªæ˜¯åœ¨è¿™é‡Œæä¸€ä¸‹å®ƒï¼Œåœ¨ä½ çœ‹åˆ°è¿™å—æ—¶ä¸è¦å¥½å¥‡ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰æ¶‰åŠåˆ°è¿™ä¸ªåº“ã€‚</p>
<p>###å·¥ä½œæ–‡ä»¶</p>
<p>ä¸è¯¥è§†å›¾ç›¸å…³çš„æ–‡ä»¶ä½ç½®åœ¨ï¼š<code>www/templates/tab-card.html</code>,<code>www/templates/card-intro.html</code>,<code>www/js/controllers/card.js</code>å’Œ<code>www/js/directives/no-touch-move.js</code>ã€‚</p>
<p>###popupä»‹ç»</p>
<p>å½“å¯¼èˆªåˆ°å¡ç‰‡å®å›¾æ—¶ï¼Œæˆ‘ä»¬å†³å®šå¼¹å‡ºå±•ç¤ºè¯´æ˜ä¿¡æ¯ï¼Œæ¥å‘ç”¨æˆ·ä»‹ç»å’Œè®©ä»–ä»¬ç†Ÿæ‚‰å¦‚ä½•ä½¿ç”¨å¡ç‰‡çš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨$ionicPopupæœåŠ¡æ¥å±•ç¤ºIonicæ ·å¼çš„å¼¹å‡ºçª—ä¿¡æ¯ã€‚è¿™ä¸ªæœåŠ¡å…è®¸ä½ å®šä¹‰å››ç§ç±»å‹çš„å¼¹å‡ºçª—ï¼š</p>
<ul>
<li><p>show(é€‰é¡¹) ï¼šé€šè¿‡åŠ è½½çš„é€‰é¡¹è®¾ç½®æ¥å®Œå…¨è‡ªå®šä¹‰å¼¹å‡ºçª—</p>
</li>
<li><p>alert(é€‰é¡¹) ï¼šå¸¦æœ‰ä¸€ä¸ªæŒ‰é’®çš„å¼¹å‡ºçª—</p>
</li>
<li><p>confirm(é€‰é¡¹)ï¼šå¸¦æœ‰ç¡®è®¤ä¿¡æ¯å’Œâ€œå–æ¶ˆâ€å’Œâ€œç¡®è®¤â€é“µé’®çš„å¼¹å‡ºçª—</p>
</li>
<li><p>prompt(é€‰é¡¹)ï¼šå’Œconfirmä¸€æ ·ï¼Œä½†æ˜¯å¤šå‡ºä¸€ä¸ªä¸ç”¨æˆ·äº¤äº’çš„è¾“å…¥æ¡†ã€‚</p>
</li>
</ul>
<p>ä¸ºæˆ‘ä»¬Trendicityåº”ç”¨ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªå¼¹å‡ºçª—å¦‚ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> Show explanation message</span><br><span class="line"><span class="variable">$ionicPopup</span>.show(&#123;</span><br><span class="line">  title: <span class="string">&#x27;Swipe Cards&#x27;</span>,</span><br><span class="line">  templateUrl: <span class="string">&#x27;templates/popups/card-intro.html&#x27;</span>,</span><br><span class="line">  scope: <span class="variable">$scope</span>,</span><br><span class="line">  buttons: [</span><br><span class="line">    &#123;</span><br><span class="line">      text: <span class="string">&#x27;Next&#x27;</span>,</span><br><span class="line">      type: <span class="string">&#x27;button-positive&#x27;</span>,</span><br><span class="line">      onTap: <span class="keyword">function</span>(e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (slidebox.currentIndex() === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="regexp">//</span> Go to <span class="keyword">next</span> slide</span><br><span class="line">          slidebox.<span class="keyword">next</span>();</span><br><span class="line"></span><br><span class="line">          <span class="regexp">//</span> Change button text</span><br><span class="line">          e.target.innerHTML = <span class="string">&#x27;OK&#x27;</span>;</span><br><span class="line"></span><br><span class="line">          e.preventDefault();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="regexp">//</span> Close popup</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¼¹å‡ºçª—çš„ä¿¡æ¯ä½“éƒ¨åˆ†é€šè¿‡templateå’ŒtemplateUrlé€‰é¡¹è¿›è¡Œå®šä¹‰ã€‚æˆ‘ä»¬è¿™é‡Œå•ç‹¬å®šä¹‰è¿™ä¸ªæ¨¡ç‰ˆæ–‡ä»¶ï¼štemplates/card-intro.html</p>
<p>æˆ‘ä»¬çš„æ¨¡ç‰ˆæ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªåˆ’åŠ¨çš„ç›’å­ï¼Œå¯ä»¥æµç•…çš„åœ¨ç…§ç‰‡ä¸ç…§ç‰‡ä¹‹é—´è¿›è¡Œåˆ’åŠ¨ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-slide-box</span> <span class="attr">does-continue</span>=<span class="string">&quot;false&quot;</span> <span class="attr">show-pager</span>=<span class="string">&quot;false&quot;</span> <span class="attr">delegate-handle</span>=<span class="string">&quot;card-intro-slidebox&quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;disableSlideBox()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-slide</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;full-image&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/swipe-right.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-slide</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-slide</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;full-image&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/swipe-left.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-slide</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-slide-box</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç›’å­ç»„ä»¶æ˜¯ç”±AngularJSæœåŠ¡$ionicSlideBoxDelegateç”Ÿæˆã€‚è¿™ä¸ªæœåŠ¡å…è®¸ä½ æ§åˆ¶è¿™ä¸ªç»„ä»¶çš„è¡Œä¸ºï¼Œå¦‚åˆ’åŠ¨æ—¶çš„æ•ˆæœå’Œæ§åˆ¶æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ã€‚å¦å¤–å½“å†æ¬¡æ¸²æŸ“è¿™ä¸ªç›’å­æ—¶è°ƒç”¨update()æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œï¼Œç¦æ­¢ç…§ç‰‡çš„è‡ªåŠ¨åˆ‡æ¢å’Œç”¨æˆ·åˆ’åŠ¨ï¼Œè€Œæ‰€æœ‰çš„æ“ä½œåªèƒ½é€šè¿‡é“µé’®æ¥è¿›è¡Œå®Œæˆã€‚</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Disable intro slidebox sliding</span></span><br><span class="line">  <span class="symbol">$scope</span>.disableSlideBox = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="symbol">$io</span>nicSlideBoxDelegate.enableSlide(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>å¼¹å‡ºçª—å£æä¾›äº†ä¸€ä¸ªå›è°ƒonTap,è¿™é‡Œå¯ä»¥è®©ç”¨æˆ·å»è‡ªå·±åšä¸€äº›äº‹æƒ…ã€‚å¦‚æœå½“å‰æ˜¯ç¬¬ä¸€ä¸ªç…§ç‰‡ï¼Œç‚¹å‡»â€œNextâ€é“µé’®ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨$ionicSlideBoxDelegate.$getByHandle(â€˜card-intro-slideboxâ€™)å®ä¾‹çš„next()æ‰“å¼€ä¸‹ä¸€å¼ ç…§ç‰‡,å¹¶ä¸”ä¿®æ”¹é“µé’®çš„æ–‡å­—ä¸ºâ€OKâ€åŒæ—¶é˜²æ­¢å¼¹å‡ºçª—å£å…³é—­ã€‚å¦å¤–ï¼Œå½“åœ¨æœ€åä¸€ä¸ªç…§ç‰‡æ—¶ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨returnå¹¶å…³é—­å¼¹å‡ºçª—å£ã€‚</p>
<p>æœ€åï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—®å¡ç‰‡è§†å›¾æ—¶ï¼Œæˆ‘ä»¬ä¼šæŸ¥çœ‹ä¸€ä¸‹æœ¬åœ°å­˜å‚¨seenCardIntroçš„å€¼æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»çœ‹è¿™ä¸ªå¡ç‰‡ã€‚</p>
<p>###Cardè§†å›¾</p>
<p>åœ¨www/templates/tab-card.htmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šå±•ç¤ºå¡ç‰‡é›†åˆã€‚æˆ‘ä»¬é€šè¿‡ng-repeatæ¥è¿­ä»£æ˜¾ç¤ºç…§ç‰‡ã€‚è®©åæˆ‘ä»¬å®šä¹‰ä¸€äº›å±æ€§æ¥å“åº”ç”¨æˆ·å¯¹å¡ç‰‡çš„æ“ä½œã€‚</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ion-view</span> <span class="attr">title</span>=<span class="string">&quot;Card View&quot;</span> <span class="attr">cache-view</span>=<span class="string">&quot;false&quot;</span> <span class="attr">no-scroll</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">ion-content</span> <span class="attr">class</span>=<span class="string">&quot;has-header padding&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-if</span>=<span class="string">&quot;model.currentPosts.length&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td-cards</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">td-card</span> <span class="attr">ng-repeat</span>=<span class="string">&quot;post in model.currentPosts&quot;</span> <span class="attr">on-destroy</span>=<span class="string">&quot;cardDestroyed($index)&quot;</span></span></span></span><br><span class="line"><span class="xml">                         on-transition-left=&quot;cardTransitionedLeft($index)&quot;</span></span><br><span class="line"><span class="xml">                         on-transition-right=&quot;cardTransitionedRight($index)&quot;&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;no-text&quot;</span>&gt;</span>NOPE<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">ng-src</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; <span class="name">post.images.low_resolution.url</span> &#125;&#125;</span><span class="xml"><span class="tag"><span class="string">&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;yes-text&quot;</span>&gt;</span>LIKE<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">td-card</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">td-cards</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ion-view</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>###Cardè§†å›¾å¯¹åº”çš„controller</p>
<p>æˆ‘ä»¬éœ€è¦CardViewCtrlä½¿ä¾§è¾¹æ»‘å‡ºèœå•å¤±æ•ˆï¼Œå› ä¸ºå®ƒä¼šä¸Tinderå¡ç‰‡åŠŸèƒ½å†²çª ã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡$ionicSidemenuDelegateæ¥è®¾ç½®å½“å†…å®¹è¿›å…¥è§†å›¾æ—¶æ‹–æ‹½ä¸å¯ç”¨ã€‚å½“ç¦»å¼€è§†å›¾æ—¶ï¼Œæˆ‘ä»¬æ¢å¤å¯ç”¨ï¼Œä½¿åˆ«çš„è§†å›¾ä¸‹å¯ä»¥æ‰“å¼€ä¾§è¾¹èœå•ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">.controller(<span class="string">&#x27;CardViewCtrl&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  $scope,</span></span></span><br><span class="line"><span class="function"><span class="params">  $ionicSideMenuDelegate,</span></span></span><br><span class="line"><span class="function"><span class="params">  $ionicPopup,</span></span></span><br><span class="line"><span class="function"><span class="params">  $ionicSlideBoxDelegate,</span></span></span><br><span class="line"><span class="function"><span class="params">  $timeout,</span></span></span><br><span class="line"><span class="function"><span class="params">  $ionicHistory,</span></span></span><br><span class="line"><span class="function"><span class="params">  localStorageService,</span></span></span><br><span class="line"><span class="function"><span class="params">  PostsService,</span></span></span><br><span class="line"><span class="function"><span class="params">  InstagramService</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Disable side-menu drag so that it doesnt interfere with our tinder cards functionality</span></span><br><span class="line">  $scope.$on(<span class="string">&#x27;$ionicView.enter&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $ionicHistory.clearHistory();</span><br><span class="line">    $ionicSideMenuDelegate.canDragContent(<span class="literal">false</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  $scope.$on(<span class="string">&#x27;$ionicView.leave&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $ionicSideMenuDelegate.canDragContent(<span class="literal">true</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!localStorageService.get(<span class="string">&#x27;seenCardIntro&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// Mark intro as seen</span></span><br><span class="line">    localStorageService.set(<span class="string">&#x27;seenCardIntro&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> slidebox = $ionicSlideBoxDelegate.$getByHandle(<span class="string">&#x27;card-intro-slidebox&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Disable intro slidebox sliding</span></span><br><span class="line">    $scope.disableSlideBox = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $ionicSlideBoxDelegate.enableSlide(<span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Show explanation message</span></span><br><span class="line">    $ionicPopup.show(&#123;</span><br><span class="line">      title: <span class="string">&#x27;Swipe Cards&#x27;</span>,</span><br><span class="line">      templateUrl: <span class="string">&#x27;templates/popups/card-intro.html&#x27;</span>,</span><br><span class="line">      scope: $scope,</span><br><span class="line">      buttons: [</span><br><span class="line">        &#123;</span><br><span class="line">          text: <span class="string">&#x27;Next&#x27;</span>,</span><br><span class="line">          type: <span class="string">&#x27;button-positive&#x27;</span>,</span><br><span class="line">          onTap: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (slidebox.currentIndex() === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// Go to next slide</span></span><br><span class="line">              slidebox.next();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Change button text</span></span><br><span class="line">              e.target.innerHTML = <span class="string">&#x27;OK&#x27;</span>;</span><br><span class="line"></span><br><span class="line">              e.preventDefault();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// Close popup</span></span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $scope.cardTransitionedLeft = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    console.log(<span class="string">&#x27;cardTransitionedLeft called with index:&#x27;</span> + index);</span><br><span class="line">    <span class="keyword">if</span> (!InstagramService.isLoggedIn()) &#123;</span><br><span class="line">      console.log(<span class="string">&#x27;not sure if you liked it before or not since you are not logged in; doing nothing!&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> post = $scope.model.currentPosts[index];</span><br><span class="line">    <span class="keyword">if</span> (post.user_has_liked) &#123; <span class="comment">// jshint ignore:line</span></span><br><span class="line">      PostsService.dislikePost(post.id)</span><br><span class="line">        .success(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          console.log(<span class="string">&#x27;you disliked it!&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      console.log(<span class="string">&#x27;you didnt like it in the first place!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $scope.cardTransitionedRight = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    console.log(<span class="string">&#x27;cardTransitionedRight called with index:&#x27;</span> + index);</span><br><span class="line">    <span class="keyword">if</span> (!InstagramService.isLoggedIn()) &#123;</span><br><span class="line">      console.log(<span class="string">&#x27;not sure if you liked it before or not since you are not logged in; if you login, we will like it for you&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> post = $scope.model.currentPosts[index];</span><br><span class="line">    <span class="keyword">if</span> (!post.user_has_liked) &#123; <span class="comment">// jshint ignore:line</span></span><br><span class="line">      PostsService.likePost(post.id)</span><br><span class="line">        .success(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          console.log(<span class="string">&#x27;you liked it!&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      console.log(<span class="string">&#x27;you already liked it previously!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  $scope.cardDestroyed = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    console.log(<span class="string">&#x27;cardDestroyed called with index:&#x27;</span> + index);</span><br><span class="line">    $scope.model.currentPosts.splice(index, <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒcardTransitionedLeftå’ŒcardTransitionRight æ–¹æ³•åŸºæœ¬ä¸Šä¸€æ ·çš„ï¼Œé™¤äº†ï¼Œå·¦æ»‘è¿›ä»£è¡¨ä¸å–œæ¬¢ï¼Œå³æ»‘æ˜¯ä»£è¡¨å–œæ¬¢ã€‚ä¸¤è€…éƒ½è¦åˆ¤æ–­æ˜¯å¦å·²ç»ç™»é™†ã€‚å¦‚ä½•ç”¨æˆ·å–œæ¬¢å½“å‰çš„å¡ç‰‡ä½†åˆæ²¡æœ‰ç™»é™†æ—¶ï¼Œä¼šè¦æ±‚ç”¨æˆ·ç™»é™†ã€‚ä¸€æ—¦ç™»é™†æˆåŠŸï¼Œè¿™ä¸ªå¡ç‰‡å°±ä¼šè¢«æ”¶è—ã€‚è¿™æ˜¯æˆ‘ä»¬å®‰å…¨è®¤è¯æ–¹æ¡ˆçš„ç»“æœã€‚ä½ å¯ä»¥é€šè¿‡ç¬¬å…­ç« èŠ‚çš„ éªŒè¯ æ¥äº†è§£æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<p>å½“ä¸€ä¸ªå¡ç‰‡ä¸€æ—¦è¿‡æ¸¡å®Œå¹¶ä¸”è¢«é”€æ¯æ—¶å°±ä¼šè°ƒç”¨cardDestroyedæ–¹æ³•ã€‚æˆ‘ä»¬è¿™é‡Œåªæ˜¯å°†å¡ç‰‡ä»ç…§ç‰‡æ•°ç»„ä¸­åˆ é™¤ã€‚</p>
<p>##Listè§†å›¾é€‰é¡¹</p>
<p>Trendicityçš„åˆ—è¡¨é€‰é¡¹æ˜¯ä¸ºäº†å±•ç¤ºionicæ ¸å¿ƒçš„åˆ—è¡¨åŠŸèƒ½è€Œå¼€å‘çš„ã€‚æ¯”è¾ƒå—æ¬¢è¿çš„ç»„ä»¶ä¸ºï¼šæ‹‰å–åˆ·æ–°ï¼Œbutton bars action sheets,è§†å›¾ä¸­çš„æ‰‹åŠ¿ã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†è§£æå¼€å‘åˆ—è¡¨çš„è¿‡ç¨‹ï¼Œå’Œä¸Šè¿°çš„ç»„ä»¶ã€‚</p>
<p>###æ¶‰åŠæ–‡ä»¶</p>
<p>åˆ—è¡¨è§†å›¾åŠŸèƒ½æ¶‰åŠçš„æ–‡ä»¶ï¼šwww/templates/tab-list.html,www/js/controllers/list.jså’Œwww/js/directives/on-dbl-top.jsã€‚è·¯ç”±åœ¨www/js/app.jsä¸­å®šä¹‰çš„ï¼š</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.state</span>(<span class="string">&#x27;app.home.list&#x27;</span>,&#123;</span><br><span class="line">        <span class="attribute">url</span>:<span class="string">&#x27;/list&#x27;</span>,</span><br><span class="line">        <span class="attribute">views</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;tab-list&#x27;</span>:&#123;</span><br><span class="line">                <span class="attribute">templateUrl</span>:<span class="string">&#x27;templates/tab-list.html&#x27;</span>,</span><br><span class="line">                <span class="attribute">controller</span>:<span class="string">&#x27;ListViewCtrl&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>###æ¨¡æ¿å¸ƒå±€</p>
<p>åˆ—è¡¨è§†å›¾æ¨¡æ¿å¯ä»¥è¢«åˆ‡åˆ†æˆä¸‰éƒ¨åˆ†ï¼šåˆ·æ–°ï¼Œå¸–å­åˆ—è¡¨ï¼Œå’ŒåŒ…å«ç”¨æˆ·å¯æ“ä½œé“µé’®çš„é“µé’®æ¡ã€‚</p>
<p>###åˆ·æ–°å¸–å­åˆ—è¡¨</p>
<p>Ionicæä¾›äº†éå¸¸æœ‰ç”¨çš„æŒ‡ä»¤ï¼Œåå­—ä¸ºion-refresherã€‚åœ¨ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ—¶ï¼Œå°†æ ‡ç­¾æ”¾åˆ°ä½ çš„è§†å›¾ä¸Šï¼Œå¹¶æ·»åŠ åœ¨è§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ ä¸€ä¸ªå¤„ç†ç”¨æˆ·äº¤äº’çš„æ–¹æ³•ï¼Œä¸€æ—¦ç”¨æˆ·å‘ä¸‹æ‹‰å–å†…å®¹æˆ–è€…è§¦å‘åˆ·æ–°æœºåˆ¶ã€‚</p>
<p>![åˆ—è¡¨è§†å›¾](/images/ionic/list_view.png =300x)</p>
<p>ä¸ºäº†ä¿å­˜ç®€å•æ˜“ç”¨ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªåˆ·æ–°é“µé’®ï¼ˆion-arrow-down-cï¼‰æ¥ä»£æ›¿é»˜è®¤çš„å›¾æ ‡,åŒæ—¶è®¾ç½®ä¸‹æ‹‰æ—¶æç¤ºçš„æ–‡å­—ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;ion-refresher <span class="attribute">pulling-icon</span>=<span class="string">&quot;ion-ios-arrow-up&quot;</span> <span class="attribute">spinner</span>=<span class="string">&quot;none&quot;</span> <span class="attribute">pulling-text</span>=<span class="string">&quot;Pull to refresh...&quot;</span> <span class="attribute">on-refresh</span>=<span class="string">&quot;doRefresh()&quot;</span>&gt;&lt;/ion-refresher&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šè¿™ä¸ªå‘½ä»¤å…è®¸ä½ é€šè¿‡ä¸‹é¢å±æ€§æ¥è¦†ç›–å®ƒé»˜è®¤çš„é…ç½®ï¼š</p>
<ul>
<li>on-refresh:ä¸€æ—¦ç”¨æˆ·ä¸‹æ‹‰æ”¾å¼€åè§¦å‘åˆ·æ–°æœºåˆ¶ã€‚</li>
<li>on-pulling:ä¸€æ—¦ç”¨æˆ·å¼€å§‹ä¸‹æ‹‰æ—¶è°ƒç”¨ã€‚</li>
<li>pulling-icon:å½“ç”¨æˆ·ä¸‹æ‹‰æ—¶æ˜¾ç¤ºçš„å›¾æ ‡ã€‚</li>
<li>pulling-text:å½“ç”¨æˆ·ä¸‹æ‹‰æ—¶æ˜¾ç¤ºçš„æ–‡æœ¬ã€‚</li>
<li>refreshing-icon:å½“åˆ·æ–°æœºåˆ¶ä¸€æ—¦è§¦å‘ï¼Œè¿™ä¸ªå›¾æ ‡å°±ä¼šæ˜¾ç¤ºã€‚</li>
<li>refreshing-text:ä¸€æ—¦æ•°æ®åˆ·æ–°åï¼Œæ˜¾ç¤ºçš„æ–‡æœ¬ã€‚</li>
<li>disable-pulling-rotation:ä¸€æ—¦on-refreshè°ƒç”¨å¼€å§‹è°ƒç”¨ï¼Œåœæ­¢æ—‹è½¬å›¾æ ‡ã€‚</li>
</ul>
<p>ionrefresherç»„ä»¶å€¼å¾—æ³¨æ„çš„æå‡å°±æ˜¯ï¼Œæ·»åŠ äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“å¾ˆå¿«è·å–åˆ°æ•°æ®æ—¶ï¼Œåˆ·æ–°æ˜¾ç¤ºæ•°æ®ä¹Ÿè¦è€—æ—¶æœ€å°‘è¦400msã€‚è¿™ç§æƒ…å†µè¶…æ—¶åˆ›é€ ä¸€ä¸ªå¹³æ»‘è¿‡æ¸¡çš„å‡åƒï¼Œä½¿ç”¨æˆ·æ„Ÿè§‰åˆ°æ•°æ®æ˜¯åˆ·æ–°äº†ã€‚</p>
<p>æˆ‘ä»¬å›åˆ°Trendicity,refresherè®¾ç½®å½“ç”¨æˆ·å¸Œæœ›è·å–æ–°çš„å¸–å­æ—¶ï¼Œè§¦å‘æ§åˆ¶å™¨çš„doRefreshæ–¹æ³•ã€‚ä¸‹é¢å°±æ˜¯åˆ·æ–°æ—¶è°ƒç”¨çš„æ–¹æ³•ï¼š</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> Refresh feed posts</span><br><span class="line"><span class="variable">$scope</span>.doRefresh = <span class="keyword">function</span>() &#123;</span><br><span class="line">  <span class="variable">$scope</span>.getPosts(<span class="variable">$scope</span>.search.value);</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span> Hide ion-refresher</span><br><span class="line">  <span class="variable">$scope</span>.<span class="variable">$broadcast</span>(<span class="string">&#x27;scroll.refreshComplete&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å°±åƒå‰é¢ç« èŠ‚è§£é‡Šçš„é‚£æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨HomeCtrlçš„getPostsæ–¹å¼</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/08/31/ionic%20%E7%AC%AC%E4%B8%89%E7%AB%A0%20Trendicity%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B/" data-id="cl7mgnxts000kt2zagstafkke" data-title="ç¬¬ä¸‰ç«  ionic å®ä¾‹ Trendicity" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/08/31/ionic%20%E7%AC%AC%E4%B8%89%E7%AB%A0%20Trendicity%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/08/31/ionic%20%E7%AC%AC%E4%B8%89%E7%AB%A0%20Trendicity%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ionic/" rel="tag">ionic</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="detail-ionic ç¬¬äºŒç«  å¼€å‘ç¯å¢ƒ å·¥å…·å’Œå·¥ä½œæµç¨‹ä»‹ç»" class="h-entry article article-type-detail" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2015/08/27/ionic%20%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D/" class="article-date">
  <time class="dt-published" datetime="2015-08-26T16:00:00.000Z" itemprop="datePublished">2015-08-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/">æ‰©å±•çŸ¥è¯†</a>â–º<a class="article-category-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E8%AF%BB%E4%B9%A6%E5%AD%A6%E4%B9%A0/">è¯»ä¹¦å­¦ä¹ </a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2015/08/27/ionic%20%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D/">ç¬¬äºŒç«  ionic å¼€å‘ç¯å¢ƒ å·¥å…·å’Œå·¥ä½œæµç¨‹ä»‹ç»</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šå­¦åˆ°è¿è¡Œä¸€ä¸ªInoicé¡¹ç›®éœ€è¦å“ªäº›æŠ€èƒ½ã€‚ä½ å°†ä¼šå®‰è£…åŸºç¡€çš„æ„å»ºæ¨¡å—ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨Ionicå‘½ä»¤è¡Œå·¥å…·(cli)åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œå­¦ä¹ å¦‚ä½•æ·»åŠ ä¸åŒçš„å¹³å°å’Œæ’ä»¶åŠå¦‚ä½•åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œä»¿çœŸå™¨å’ŒçœŸå®çš„è®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•ã€‚</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">##å®‰è£…å¿…å¤‡å·¥å…·:<span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>jså’ŒGit</span><br><span class="line"></span><br><span class="line">Ionicä½¿ç”¨åŠŸèƒ½å¼ºå¤§çš„æ¨¡å—ç®¡ç†å·¥å…·<span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>js,<span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>js æ˜¯ä¸€ä¸ªJavascriptåŸºç¡€å¹³å°ï¼Œé€šè¿‡å®ƒå¯ä»¥å¾ˆå®¹æ˜“çš„è¿›è¡Œwebåº”ç”¨çš„æ„å»ºã€‚ç”±äº<span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>jsçš„æ— å¤„ä¸åœ¨å’Œå…¶åŒ…ç®¡ç†ç‰¹æ€§ï¼Œä½¿ç”¨ionicçš„å®‰è£…å’Œéƒ¨ç½²éå¸¸ç®€å•ã€‚</span><br><span class="line"></span><br><span class="line">##å®‰è£…<span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>js</span><br><span class="line"></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Node</span>.</span></span>jsé€šè¿‡ä¸‹è½½å®‰è£…å™¨å®‰è£…åœ¨windowsä¸Šæˆ–åˆ°<span class="literal">[è¿™é‡Œ]</span>(http:<span class="comment">//nodejs.org/down-load/)ä¸‹è½½é’ˆå¯¹äºOS Xçš„å®‰è£…ç¨‹åºã€‚åœ¨OS Xä¸Šä¹Ÿå¯ä»¥é€šè¿‡Homebrewè¿›è¡Œå®‰è£…ã€‚å¦å¤–ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</span></span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">$ brew install node </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œåï¼Œä½ å¯ä»¥æ‰“ä¸€ä¸ªå‘½ä»¤è¡Œï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br></pre></td></tr></table></figure>
<p>å®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ§åˆ¶å°ã€‚å®ƒå°±åƒæ˜¯æµè§ˆå™¨ä¸­çš„javascriptæ§åˆ¶å°ä¸€æ ·ã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ªæ§åˆ¶å°ä¸­ç¼–å†™åˆæ³•çš„javascriptä»£ç ã€‚å¦‚ï¼š</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">console</span>.info(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">Hello World</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŒ‰ä¸¤æ¬¡CTRL+Cå°±å¯ä»¥é€€å‡ºNode.jsæ§åˆ¶å°</p>
<p>##å®‰è£…Git</p>
<p>NPMæ˜¯Node.jsçš„ä¾èµ–ç®¡ç†ï¼Œboweræ˜¯browserçš„ä¾èµ–ç®¡ç†ã€‚ç”±äºionicæ˜¯åŸºäºhtml5çš„ç§»åŠ¨æ··åˆåº”ç”¨å¼€å‘å·¥å…·å’ŒæœåŠ¡å¥—ä»¶ã€‚boweråªæ˜¯å®‰è£…å’Œä¾èµ–ç®¡ç†ã€‚æœ‰ä¸€äº›boweræ¨¡å—éœ€è¦Git,å› æ­¤åœ¨å¼€å§‹ä¹‹å‰ä½ å¿…é¡»è¦å…ˆå®‰è£…Git.</p>
<p>å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="http://git-scm.com/downloads">git-scm.com/downloads</a>ä¸‹è½½å„ä¸ªå¹³å°çš„Gitå®‰è£…ç¨‹åºã€‚</p>
<p>ä¸€æ—¦ä½ å®‰è£…äº†Git,æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">$ git version</span><br><span class="line">git version <span class="number">2.3</span><span class="number">.2</span> (Apple Git<span class="number">-55</span>)</span><br></pre></td></tr></table></figure>

<p>##å®‰è£…Installing Ionic<br>ç°åœ¨ä½ å·²ç»å®‰è£…äº†Node.jså’ŒGit,å®‰è£…Ionicå°±å˜çš„éå¸¸å®¹æ˜“äº†ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> -g cordova ionic</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œå‘½ä»¤å°±æ˜¯è®©NPMå®‰è£…cordovaå’ŒionicåŒ…ï¼Œå’Œä»–ä»¬æ‰€ä¾èµ–çš„æ¨¡å—ã€‚åŠ ä¸Š-gè¿™ä¸ªé€‰é¡¹ï¼Œæ„å‘³ç€NPMåœ¨å…¨å±€ä¸­å®‰è£…å®ƒä»–ä»¬ï¼Œå› æ­¤ä½ å°±å¯ä»¥åœ¨æ‰€æœ‰é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>ä¸€æ—¦NPMé€‰æ‹©å®Œï¼Œå°±ä¼šè¾“å‡ºä¸€ä¸ªå®‰è£…æ±‡æ€»ã€‚ä¸‹é¢ä½ å¯ä»¥éªŒè¯å®‰è£…ã€‚</p>
<p>##Cordova</p>
<p>ä¸‹é¢èŠ±ä¸€äº›æ—¶é—´å»è®²è§£Cordovaæ˜¯ä»€ä¹ˆï¼Œæ˜¯éå¸¸å€¼å¾—çš„ï¼Œå› ä¸ºä»–æ˜¯Ionicä¸ºä»€ä¹ˆå¦‚æ­¤å¼ºå¤§çš„æœ€é‡è¦çš„åŸå› ã€‚</p>
<p>Cordova æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„å¼€æºé¡¹ç›®ï¼Œå®ƒæ˜¯HTMLå’Œæ‰‹æœºåŸç”ŸåŠŸèƒ½ä¹‹é—´çš„æ¡¥æ¢ã€‚å®ƒä½¿å¼€å‘è€…èƒ½å¤Ÿæ„å»ºä¸€ä¸ªhtmlåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰‹æœºåŸç”Ÿçš„åŠŸèƒ½ï¼Œå¦‚ä½•åƒæœºï¼Œåœ°ç†ä½ç½®ï¼Œè®¾å¤‡çš„æ–¹å‘ç­‰ã€‚å¦å¤–ï¼ŒCordovaç›®çš„æ˜¯åˆ›å»ºä¸€äº›è·¨å¹³å°çš„æ¥å£ï¼Œä½¿ä½ åˆ›å»ºhtmlåº”ç”¨è€Œä¸ç”¨å…³å¿ƒæ˜¯iphoneåº”ç”¨è¿˜æ˜¯åœ¨androidåº”ç”¨ã€‚</p>
<p>ä½ å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="http://cordova.apache.org/">è¿™é‡Œ</a>äº†è§£å†³æ›´å¤šå…³äºCordovaçš„çŸ¥è¯†ã€‚</p>
<p>##Ionicå‘½ä»¤è¡Œ ï¼ˆCLI)</p>
<p>ä¸ºäº†ä½¿ä½ èƒ½æ›´æ–¹ä¾¿çš„ä½¿ç”¨Ionicï¼ŒIonicæä¾›äº†å‘½ä»¤è¡Œæ¥å£ã€‚</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹</li>
<li>æ·»åŠ å¹³å°</li>
<li>æ·»åŠ æ’ä»¶</li>
<li>ç¼–è¯‘å’Œåœ¨ä»¿çœŸå™¨ä¸­è¿è¡Œä½ çš„å·¥ç¨‹</li>
<li>åœ¨è®¾å¤‡ä¸Šè¿è¡Œä½ çš„</li>
<li>æ‰“åŒ…åº”ç”¨å’Œå‘å¸ƒ</li>
</ul>
<p>##åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹<br>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œå®šä½åˆ°ä½ æƒ³æŠŠæœ¬ä¹¦æ¶‰åŠåˆ°çš„ä»£ç å­˜æ”¾çš„ä½ç½®ã€‚åœ¨è¿™ç›®å½•ä¸‹é¢è¾“å…¥ä¸‹é¢çš„åˆ›å»ºåº”ç”¨çš„å‘½ä»¤ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> ionic <span class="built_in">start</span> trendicity tabs</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªionic startå‘½ä»¤å¯ä»¥è®©ä½ æŒ‡å®šä¸€ä¸ªæ¨¡ç‰ˆç”¨æ¥åˆå§‹åŒ–Ionicåº”ç”¨çš„ç»“æ„ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œä½ æŒ‡å®šäº†tabsæ¨¡ç‰ˆã€‚å¼€ç®±å³ç”¨çš„ï¼ŒIonicæ”¯æŒç©ºç™½æ¨¡ç‰ˆï¼ˆä¸æŒ‡å®šæ¨¡ç‰ˆï¼Œé»˜è®¤å°±æ˜¯ç©ºç™½çš„ï¼‰ï¼Œtabså’Œ sidemenuã€‚å¦å¤–,å¦‚ä½•ä½ æƒ³æä¾›ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡ç‰ˆï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªCodePen URL.</p>
<p>ä¸€æ—¦ä¸Šé¢é‚£ä¸ªå‘½ä»¤æ‰§è¡Œå®Œï¼Œä½ å°±å·²ç»é…ç½®å¥½äº†ä¸€ä¸ªIonicå·¥ç¨‹ï¼Œå°±ä¼šçœ‹åˆ°ä¸‹é¢ä¿¡æ¯ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Your Ionic project is <span class="built_in">read</span> <span class="built_in">to</span> go ! Some quick tips:</span><br><span class="line"></span><br><span class="line"> * cd <span class="keyword">into</span> your project: $ cd trendicity</span><br><span class="line"></span><br><span class="line"> * Setup this project <span class="built_in">to</span> use Sass: ionic setup sass</span><br><span class="line"></span><br><span class="line"> * Develop <span class="keyword">in</span> <span class="keyword">the</span> browser <span class="keyword">with</span> live reload: ionic serve</span><br><span class="line"></span><br><span class="line"> * Add <span class="keyword">a</span> <span class="built_in">platform</span> (ios <span class="keyword">or</span> Android): ionic <span class="built_in">platform</span> <span class="built_in">add</span> ios [android]</span><br><span class="line">   Note: iOS development requires OS X currently</span><br><span class="line">   See <span class="keyword">the</span> Android Platform Guide <span class="keyword">for</span> full Android installation instructions:</span><br><span class="line">   <span class="keyword">https</span>://cordova.apache.org/docs/en/edge/guide_platforms_android_index.md.html</span><br><span class="line"></span><br><span class="line"> * Build your app: ionic build &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line"> * Simulate your app: ionic emulate &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line"> * Run your app <span class="keyword">on</span> <span class="title">a</span> <span class="title">device</span>: <span class="title">ionic</span> <span class="title">run</span> &lt;<span class="title">PLATFORM</span>&gt;</span><br><span class="line"></span><br><span class="line"> * Package <span class="keyword">an</span> app <span class="keyword">using</span> Ionic package service: ionic package &lt;MODE&gt; &lt;PLATFORM&gt;</span><br><span class="line"></span><br><span class="line">For more help use ionic <span class="comment">--help or ionic docs</span></span><br><span class="line"></span><br><span class="line">Visit <span class="keyword">the</span> Ionic docs: <span class="keyword">http</span>://ionicframework.com/docs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">New! Add push notifications <span class="built_in">to</span> your Ionic app <span class="keyword">with</span> Ionic Push (alpha)!</span><br><span class="line"><span class="keyword">https</span>://apps.ionic.io/signup</span><br><span class="line">+<span class="comment">---------------------------------------------------------+</span></span><br><span class="line">+ New Ionic Updates <span class="keyword">for</span> August <span class="number">2015</span></span><br><span class="line">+</span><br><span class="line">+ The View App just landed. Preview your apps <span class="keyword">on</span> <span class="title">any</span> <span class="title">device</span></span><br><span class="line">+ <span class="keyword">http</span>://view.ionic.io</span><br><span class="line">+</span><br><span class="line">+ Invite anyone <span class="built_in">to</span> preview <span class="keyword">and</span> test your app</span><br><span class="line">+ ionic share EMAIL</span><br><span class="line">+</span><br><span class="line">+ Generate splash screens <span class="keyword">and</span> icons <span class="keyword">with</span> ionic resource</span><br><span class="line">+ <span class="keyword">http</span>://ionicframework.com/blog/automating-icons-<span class="keyword">and</span>-splash-screens/</span><br><span class="line">+</span><br><span class="line">+<span class="comment">---------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ä½ ä¼šçœ‹åˆ°ä¸€äº›å¿«æ·æç¤ºã€‚ä½ å¯ä»¥éšæ—¶æŸ¥çœ‹è¿™äº›æç¤ºï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ionic --<span class="built_in">help</span></span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°†ä¼šè¾“å‡ºä¸€ä¸ªIonicå‘½ä»¤è¡Œæ”¯æŒçš„æŒ‡ä»Šåˆ—è¡¨</p>
<p>çœ‹ä¸€ä¸‹åˆšæ‰é‚£ä¸ªå‘½ä»¤ä¸ºä½ åˆ›å»ºäº†å“ªäº›ä¸œè¥¿</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">$ cd trendicity</span><br><span class="line">$ ls -F</span><br><span class="line">total <span class="number">40</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff   <span class="number">118</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">03</span> bower.json</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff   <span class="number">864</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> config.xml</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff  <span class="number">1388</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">03</span> gulpfile.js</span><br><span class="line">drwxr-xr-x  <span class="number">4</span> Aaron  staff   <span class="number">136</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">03</span> hooks/</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff    <span class="number">42</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> ionic.project</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff   <span class="number">581</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> package.json</span><br><span class="line">drwxr-xr-x  <span class="number">4</span> Aaron  staff   <span class="number">136</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> platforms/</span><br><span class="line">drwxr-xr-x  <span class="number">9</span> Aaron  staff   <span class="number">306</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> plugins/</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> Aaron  staff   <span class="number">102</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">03</span> scss/</span><br><span class="line">drwxr-xr-x  <span class="number">8</span> Aaron  staff   <span class="number">272</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> www/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>bower.json</code>:ç®¡ç†ä½ çš„Bowerä¾èµ–</p>
<p><code>gulpfile.js</code>:Gulpæ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ã€‚æ›´å¤šçš„ä¿¡æ¯å¯å‚åœ¨<a target="_blank" rel="noopener" href="http://www.gulpjs.com/">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚è¿™ä¸ªæ–‡ä»¶ç®¡ç†æ„å»ºçš„æµç¨‹ã€‚</p>
<p><code>ionic.project</code>:ionicå·¥ç¨‹é…ç½®æ–‡ä»¶ã€‚</p>
<p><code>plugins/</code>:Ionicæ’ä»¶æ–‡ä»¶æ”¾åœ¨æ­¤ç›®å½•ä¸‹ã€‚ç¨åä½ ä¼šäº†è§£æ›´å¤šå…³äºè¿™æ’ä»¶çš„ä¿¡æ¯ã€‚</p>
<p><code>www/</code>:ä½ çš„åº”ç”¨æ–‡ä»¶æ”¾åœ¨æ­¤ç›®å½•ä¸‹ã€‚</p>
<p><code>config.xml</code>:Cordovaçš„é…ç½®æ–‡ä»¶ã€‚</p>
<p><code>hooks/</code>:Cordovaçš„hooks è¿™é‡Œé¢æœ‰ä¸€ä¸ªè¯´æ˜æ–‡ä»¶ï¼Œæˆ‘å¯ä»¥æ ¹æ®æ­¤æ–‡ä»¶æ¥åˆ›å»ºä¸€ç³»åˆ—çš„ç›®å½•ï¼Œè¿™äº›ç›®å½•é‡Œé¢å¯ä»¥åˆ›å»ºä¸€äº›è„šæœ¬ï¼Œè¿™äº›è„šæœ¬åˆ†åˆ«åœ¨ionicè¿è¡Œçš„ä¸åŒæ—¶æœŸè¿›è¡Œæ‰§è¡Œã€‚</p>
<p><code>package.json</code> :ç®¡ç†Node.jsä¾èµ–çš„æ–‡ä»¶</p>
<p><code>scss/</code>: SASS æ–‡ä»¶ã€‚</p>
<p>å¥½ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æŠŠé‡ç‚¹æ”¾åœ¨ <code>www</code> ç›®å½•ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">localhost:trendicity Aaron$ cd www</span><br><span class="line">localhost:www Aaron$ ls -F</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">drwxr-xr-x  <span class="number">3</span> Aaron  staff  <span class="number">102</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> css/</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> Aaron  staff  <span class="number">102</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> img/</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff  <span class="number">858</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> index.html</span><br><span class="line">drwxr-xr-x  <span class="number">4</span> Aaron  staff  <span class="number">136</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> js/</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> Aaron  staff  <span class="number">102</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">03</span> lib/</span><br><span class="line">drwxr-xr-x  <span class="number">8</span> Aaron  staff  <span class="number">272</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> templates/</span><br></pre></td></tr></table></figure>

<p><code>css/</code>:ä½ çš„åº”ç”¨çš„CSSæ–‡ä»¶<br><code>img/</code>:ä½ çš„åº”ç”¨ä¸­ç”¨åˆ°çš„å›¾ç‰‡<br><code>index.html</code>:ä½ çš„åº”ç”¨çš„å…¥å£<br><code>js/</code>:ä½ çš„javascriptä»£ç <br><code>lib/</code>:ç¬¬ä¸‰æ–¹åº“å’ŒIonicåº“<br><code>templates/</code>:ä½ çš„åº”ç”¨çš„HTMLæ¨¡ç‰ˆ</p>
<p>åœ¨jså¼•ä»¥ä¸ºæ–‡ä»¶å¤¹ä¸­ä¼šå‘ç°æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">localhost:js Aaron$ ls -F</span><br><span class="line">total <span class="number">16</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff  <span class="number">1916</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> app.js</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff  <span class="number">1544</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> controllers.js</span><br><span class="line">-rw-r--r--  <span class="number">1</span> Aaron  staff  <span class="number">1542</span>  <span class="number">8</span> <span class="number">30</span> <span class="number">16</span>:<span class="number">04</span> services.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è‹¥æ²¡æœ‰å‘ç°services.jsæ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚</p>
<p><code>app.js</code>:ä½ çš„åº”ç”¨çš„å…¥å£ï¼Œå®ƒåŒ…æ‹¬è·¯ç”±ä¿¡æ¯ã€‚<br><code>controllers.js</code>:åŒ…æ‹¬ä¾‹å­åº”ç”¨çš„æ‰€æœ‰çš„æ§åˆ¶å™¨ã€‚<br><code>services.js</code>:åº”ç”¨çš„å¯é‡ç”¨çš„æœåŠ¡ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„é¡¹ç›®ç»“æ„ï¼Œéšç€ä½ çš„é¡¹ç›®çš„å¢é•¿ï¼Œä½ éœ€è¦å»å®Œå–„å®ƒã€‚</p>
<p>##åœ¨æµè§ˆå™¨ä¸Šéƒ¨ç½²</p>
<p>åˆšå¼€å§‹æ—¶ï¼Œä¸é€šè¿‡ä»¿çœŸå™¨æµ‹è¯•ç›¸æ¯”ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•æ˜¯æœ€å¿«çš„æ–¹å¼ã€‚å®ƒæ˜¯å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•çš„ï¼Œå› ä¸ºIonicæ˜¯ä¸€ä¸ªåŸºäºhtml5çš„å¹³å°ã€‚å¦å¤–ï¼ŒIonicç°æœ‰çš„å†…ç½®åŠŸèƒ½è®©å…¶å˜å¾—æ›´åŠ ç®€å•ã€‚åœ¨ä½ çš„å‘½ä»¤è¡Œä¸­çš„å·¥ç¨‹ç›®å½•ä¸‹ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ã€‚</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">$ ionic serve</span><br><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**</span></span><br><span class="line"><span class="strong"> Upgrade warning - for the CLI to run correctly,      </span></span><br><span class="line"><span class="strong"> it is highly suggested to upgrade the following:     </span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong"> Please update your Node runtime to version  &gt;=0.12.x</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span></span><br><span class="line">Running live reload server: http://192.168.1.7:35729</span><br><span class="line">Watching : [ &#x27;www/<span class="strong">**/<span class="emphasis">*&#x27;, &#x27;!www/lib/<span class="strong">**/<span class="emphasis">*&#x27; ]</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Running dev server: http://192.168.1.7:8100</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">Ionic server commands, enter:</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">  restart or r to restart the client app from the root</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">  goto or g and a url to have the app navigate to the given url</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">  consolelogs or c to enable/disable console log output</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">  serverlogs or s to enable/disable server log output</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis">  quit or q to shutdown the server and exit</span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="emphasis"></span></span></span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œå°†ä¼šæ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£å¹¶ä¸”è®¿é—®ä½ çš„åº”ç”¨ã€‚æ­å–œä½ ï¼Œä½ çš„åº”ç”¨å·²ç»æˆåŠŸè¿è¡Œï¼</p>
<p>å¦‚ä½•æµè§ˆå™¨çª—å£æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€ï¼Œ Ionicé€šçŸ¥ä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªåº”ç”¨ã€‚ä½ ä¸Šé¢ä½ ä¼šçœ‹åˆ°</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.7</span>:<span class="number">35729</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å°†ä¼šç›‘è§†ä½ çš„å·¥ç¨‹æ–‡ä»¶çš„å˜åŒ–ï¼Œå› æ­¤å½“ä½ æ”¹å˜å·¥ç¨‹ä¸­çš„æ–‡ä»¶æ—¶ï¼Œè§†å›¾ä¹Ÿä¼šè‡ªåŠ¨åˆ·æ–°ã€‚ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹å·¥ç¨‹çš„ä¸€ä¸ªæ–‡ä»¶å¹¶æ³¨æ„ç€æµè§ˆå™¨çš„é‡æ–°åŠ è½½æ¥è¿›è¡Œæµ‹è¯•ã€‚æ‰“å¼€./www/templates/tab-dash.html æ–‡ä»¶å¹¶ä¸”ä¿®æ”¹ï¼š</p>
<p><code>&lt;h1&gt;Dash&lt;/Dash&gt;</code></p>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<p><code>&lt;h1&gt;Trendicity&lt;/h1&gt;</code></p>
<p>ä¿å­˜åï¼Œæµè§ˆå™¨ä¼šç«‹å³å‘ç”Ÿåˆ·æ–°ï¼Œä½ å°±ä¼šçœ‹åˆ°åˆšæ‰ä¿®æ”¹æ–‡ä»¶åçš„å˜åŒ–ã€‚</p>
<p>##ä»£ç†</p>
<p>å½“ä½ çš„åº”ç”¨éœ€è¦è®¿é—®ä¸å…è®¸è·¨åŸŸè®¿é—®çš„èµ„æºçš„APIsæ—¶ï¼Œåœ¨æµè§ˆå™¨æµ‹è¯•æ—¶ï¼Œä½ å°†ä¼šé‡åˆ°é—®é¢˜ã€‚å¹¸è¿çš„æ˜¯Ionicå›¢é˜Ÿå·²ç» é€šè¿‡ä»£ç†è¯·æ±‚çš„æ–¹å¼æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä½ åº”ç”¨çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€ionic.projectã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">cat ionic.<span class="keyword">project</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;trendicity&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app_id&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä»£ç†æ•°æ®åˆ°ä½ çš„æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat ionic.<span class="keyword">project</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;trendicity&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app_id&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;proxies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>:<span class="string">&quot;/proxied/resources&quot;</span>,</span><br><span class="line">    <span class="string">&quot;proxyUrl&quot;</span>:<span class="string">&#x27;https://api.somesite.com/resources&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­çš„pathæ˜¯ä½ æœ¬åœ°æƒ³è¢«ä»£ç†çš„è·¯å¾„ï¼Œè¿™ä¸ªproxyUrlæ˜¯çœŸæ­£çš„ä½ æƒ³è¢«è¯·æ±‚çš„API.åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œä½ ç°åœ¨å¯ä»¥è¯·æ±‚<code>http://localhost:8100/proxied/resources</code>å…¶å®æ˜¯è®¿é—®çš„<code>https://api.somesite.com/resources</code>.</p>
<p>æ³¨æ„ï¼Œä»£ç†çš„é…ç½®ä»…åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•æ—¶éœ€è¦ç”¨åˆ°ã€‚åœ¨è®¾å¤‡ä¸Šå’Œä»¿çœŸå™¨ä¸­ä¸éœ€è¦ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
<p>##æ·»åŠ å¹³å°</p>
<p>å½“ä½ å‘å¸ƒä¹‹å‰ï¼Œæˆ–è€…åœ¨ä½ æ„å»ºä¸€ä¸ªåº”ç”¨æ—¶ï¼Œä½ éœ€è¦å†³å®šä½ æƒ³å°†æ­¤åº”ç”¨éƒ¨ç½²åˆ°å“ªäº›å¹³å°ä¸Šã€‚ç„¶åå‘Šè¯‰ç»™Ionic,é€šè¿‡CLI,å®‰è£…æ„å»ºæˆè¿™æ­¤å¹³å°çš„åº”ç”¨æ—¶æ‰€å¿…é¡»çš„å…ˆå†³æ¡ä»¶ã€‚è®©æˆ‘ä»¬æ¥æ·»åŠ IOSå¹³å°ã€‚</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">$ ionic <span class="keyword">platform</span> ios</span><br></pre></td></tr></table></figure>

<p>å®ƒå°†ä¼šå®‰è£…ä¸€äº›å¿…é¡»çš„ä¾èµ–å¹¶å‡†å¤‡å°†ä½ çš„å·¥ç¨‹æ„å»ºæˆIOSå¹³å°çš„åº”ç”¨ã€‚æ³¨æ„ï¼Œå¦‚ä½•ä½ ä¸æ˜¯åœ¨Appleç”µè„‘ä¸Šï¼Œä½ æ˜¯ä¸èƒ½å¤Ÿæ·»åŠ iOSå¹³å°çš„ã€‚</p>
<p>æˆ–ï¼Œä½ å¯ä»¥æ·»åŠ Androidå¹³å°ï¼š</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">$ ionic <span class="keyword">platform</span> android</span><br></pre></td></tr></table></figure>

<p>Androidå¹³å°ä¸iOSç›¸æ¯”ï¼Œéœ€è¦å®‰è£…ä¸€äº›é¢å¤–çš„ä¸œè¥¿ å½“ä½ éƒ½æ˜¯åœ¨Appleç”µè„‘ä¸Šæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ã€‚åœ¨ç¨åçš„ç« èŠ‚ä¸­ä½ ä¼šäº†è§£åˆ°æ›´å¤šå…³äºAndroidå®‰è£…çš„ä¿¡æ¯ã€‚</p>
<p>å¦‚ä½•ä½ å†³å®šé€‰æ‹©åœ¨Androidå¹³å°ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå»ºè®®ä½ ä¸è¦ä½¿ç”¨Androidé»˜è®¤çš„ä»¿çœŸå™¨ã€‚å› ä¸ºå®ƒå¤ªæ…¢äº†ã€‚ä½ å¯ä»¥å®‰è£…ä½¿ç”¨Geny-mogionä»¿çœŸå™¨ï¼Œå®ƒæ¯”é»˜è®¤è®¿çœŸå™¨è¦å¿«ä¸€äº›ã€‚ä½ å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="http://www.genymotion.com/">è¿™é‡Œ</a>äº†è§£æ›´å¤šçš„å†…å®¹ã€‚</p>
<p>##æ„å»ºåº”ç”¨</p>
<p>ç”¨Ionicæ„å»ºåº”ç”¨æ˜¯å®¹æ˜“çš„ã€‚æ„å»ºä¸€ä¸ªiOSå¹³å°çš„åº”ç”¨ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ionic build ios</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦æ„å»ºæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°è¾“å‡ºä¸‹é¢ä¿¡æ¯ï¼š</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">** </span>BUILD SUCCEEDED</span><br></pre></td></tr></table></figure>

<p>##ç¼–è¯‘å’Œåœ¨ä»¿çœŸå™¨ä¸­è¿è¡Œä½ çš„å·¥ç¨‹<br>Ionicæ”¯æŒç›´æ¥é€šè¿‡CLIåŠ è½½è®¾å¤‡ä»¿çœŸå™¨ã€‚åŠ è½½ä½ çš„ç¼–è¯‘æ–‡ä»¶åˆ°iOSä»¿çœŸå™¨(ç¡®ä¿ä½ å·²ç»å®‰è£…äº†<a target="_blank" rel="noopener" href="https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/iOS_Simulator_Guide/">ios-sim</a>)ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ionic <span class="built_in">emulate</span> ios</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä½•ä½ ä¹‹å‰æ²¡æœ‰è¿›è¡Œç¼–è¯‘ï¼ŒIonicä¼šåˆ›å»ºiOSå¹³å°çš„ç¼–è¯‘æ–‡ä»¶ã€‚æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼ŒiOS ä»¿çœŸå™¨å°†ä¼šåŠ è½½ï¼Œå¹¶ä¸”ä½ çš„åº”ç”¨å°†ä¼šåœ¨å…¶ä¸­åŠ è½½ã€‚</p>
<p>åƒæ˜¯åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä¸€æ ·ï¼Œä½ å¯ä»¥ä¿®æ”¹ä½ çš„åº”ç”¨æ–‡ä»¶æ—¶ï¼Œè®©ä»¿çœŸå™¨ä¸­çš„åº”ç”¨è‡ªåŠ¨åˆ·æ–°ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç­‰å¾…ä»¿çœŸå™¨åŠ è½½ä½ çš„åº”ç”¨ï¼Œç„¶åä¿®æ”¹åº”ç”¨çš„æ–‡ä»¶è¿›è¡Œè§‚å¯Ÿä»¿çœŸå™¨ä¸­åº”ç”¨çš„å˜åŒ–ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ionic <span class="built_in">emulate</span> ios -livereload</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ¬¡ä¿®æ”¹å·¥ç¨‹ï¼Œéƒ½ä¼šèŠ±å¤§é‡çš„æ—¶é—´å»ç¼–è¯‘å’ŒåŠ è½½åˆ°ä»¿çœŸå™¨ã€‚</p>
<p>##åœ¨è®¾å¤‡ä¸Šè¿è¡Œ</p>
<p>ä»¿çœŸå™¨æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œä½†æ˜¯åœ¨å‘å¸ƒä¹‹å‰ï¼Œä½ ä»ç„¶æƒ³åœ¨çœŸå®çš„è®¾å¤‡ä¸Šæµ‹è¯•ä½ çš„åº”ç”¨ã€‚</p>
<p>###iOS<br>åœ¨iOSè®¾å¤‡ä¸Šéƒ¨ç½²ï¼Œéœ€è¦æœ‰ä¸€ä¸ªiOSå¼€å‘å¸æˆ·ï¼Œåœ¨Appleè®¾å¤‡ä¸Šè¿è¡ŒXCodeã€‚iOSå¼€å‘è€…è´¦æˆ·æ˜¯æ”¶è´¹çš„ã€‚ä½ å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://developer.apple.com/programs/">developer.apple.com/programs/</a>äº†è§£æ›´å¤šã€‚</p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½Xcode:(developer.apple.com/xcode/downloads/)[<a target="_blank" rel="noopener" href="https://developer.apple.com/xcode/downloads/]">https://developer.apple.com/xcode/downloads/]</a></p>
<p>ä¸€æ—¦ä½ æ­£ç¡®å®‰è£…äº†XCodeå’Œæ‹¥æœ‰ä½ è‡ªå·±çš„å¼€å‘è€…è´¦æˆ·ï¼Œåœ¨XCodeä¸­æ‰“å¼€ä½ å·¥ç¨‹çš„/platform/iosæ–‡ä»¶å¤¹ï¼Œç„¶åè¿›è¡Œæµ‹è¯•ã€‚</p>
<p>###Android</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸»è¦é›†ä¸­åœ¨æ„å»ºã€æ¨¡æ‹Ÿå’Œè¿è¡ŒiOSåº”ç”¨ç¨‹åºã€‚åŸå› æ˜¯ï¼Œå¦‚æœä½ åœ¨Appleç”µè„‘ä¸Šè¿›è¡Œå¼€å‘ï¼Œå¯åŠ¨å’Œè¿è¡Œéƒ½æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œä½†æ˜¯å®ƒé¿å…äº†ä½¿ç”¨Ionicè¿›é‡åˆ°çš„æœ€å¤§çš„ä¸€ä»¶äº‹æƒ…ã€‚ä½ ç¼–å†™ä¸€æ¬¡åº”ç”¨ï¼Œå¯ä»¥ç¼–è¯‘æˆä¸¤ä¸ªå¹³å°çš„ç‰ˆæœ¬ã€‚è®©æˆ‘ä»¬èŠ±ä¸€ç‚¹æ—¶é—´çœ‹ä¸€ä¸‹åœ¨Androidå¹³å°ä¸Šå¯åŠ¨å’Œè¿è¡Œæ—¶çš„ä¸€äº›é€‰é¡¹ã€‚</p>
<p>###Android SDKå®‰è£…</p>
<p>ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä¸‹è½½å’Œå®‰è£…Android SDK.å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="http://developer.android.com/sdk/index.html">developer.android.com/sdk/</a>ã€‚å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®‰è£…æ­¥éª¤ï¼š<a target="_blank" rel="noopener" href="http://developer.android.com/sdk/installing/">developer.android.com/sdk/installing/</a>ã€‚</p>
<p>###Ionic box</p>
<p>å¾ˆå¤šäººå‘ç°å®‰è£…Android SDKæ˜¯æ¯”è¾ƒå›°éš¾çš„è¿‡ç¨‹ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼ŒIonicå°ç»„å·²ç»åˆ›å»ºäº†ä¸€ä¸ªVagrant boxæ¥å¸®åŠ©ä½ ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚å¦‚ä½•ä½ å¯¹Vagrantä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„è¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ›å»ºè™šæ‹Ÿæœºçš„å¹³å°ï¼Œä¸»è¦æ˜¯åˆ›å»ºå¼€å‘ç¯å¢ƒã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤š:<a target="_blank" rel="noopener" href="http://www.vagrantup.com/">www.vagrantup.com</a>ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„è™šæ‹Ÿæœºè¿è¡Œå™¨ï¼Œä½†æ˜¯æœ€å¸¸ç”¨çš„æ˜¯VirtualBoxã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨Vagrant box,ä½ é¦–å…ˆå®‰è£…VirtualBox,æˆ–è€…åˆ«çš„è¢«Vagrantæ”¯ä»˜çš„è™šæ‹Ÿæœºè¿è¡Œå™¨ã€‚VirtualBoxæ˜¯å…è´¹çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸‹è½½:<a target="_blank" rel="noopener" href="http://www.virtualbox.org/wiki/Downloads">www.virtualbox.org/wiki/Downloads</a>ã€‚ä¸€æ—¦å®‰è£…å¥½äº†VirtualBoxï¼Œä¸‹è½½å¹¶å®‰è£…Vagrant:<a target="_blank" rel="noopener" href="http://www.vagrantup.com/downloads.html">www.vagrantup.com/downloads.html</a>ã€‚</p>
<p>ä¸€æ—¦ä½ å®‰è£…å¥½äº†VirtualBoxå’ŒVagrantï¼Œè¿›å…¥åˆ°ä½ çš„å·¥ç¨‹ç›®å½•ä¸‹é¢ï¼Œå…‹éš†Ionic boxèµ„æºï¼Œå¹¶ä¸”å¯åŠ¨å®ƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/driftyco/ionic-box</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ionic-box</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vagrant up</span></span><br></pre></td></tr></table></figure>
<p>ä½ ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œå¯èƒ½è¦èŠ±è´¹å‡ åˆ†é’Ÿï¼Œå› ä¸ºVagrantéœ€è¦ä¸‹è½½ä¸€ä¸ªè™šæ‹Ÿæœºé•œåƒæ–‡ä»¶ã€‚åœ¨ä½ åœ¨Ionic boxä¸Šç¼–è¯‘ä½ çš„åº”ç”¨å‰ï¼Œä½ éœ€è¦å°†ä½ çš„é¡¹ç›®ä»£ç ç›®å½•ä¸è™šæ‹Ÿæœºå…±äº«ã€‚åœ¨ä½ çš„ç¼–è¯‘å™¨ä¸­æ‰“å¼€ionic-box/Vagrantfileã€‚æ‰¾åˆ°ä¸‹é¢è¿™è¡Œï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta"># config.vm.synced_folder <span class="meta-string">&quot;../data&quot;</span>, <span class="meta-string">&quot;/vagrant_data&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="built_in">config</span>.vm.<span class="keyword">synced_folder </span><span class="string">&quot;../trendicity&quot;</span>, <span class="string">&quot;/home/vagrant/trendicity&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¿å­˜è¿™ä¸ªæ–‡ä»¶å¹¶é‡æ–°åŠ è½½ä½ çš„Vagrantå®ä¾‹ï¼š</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$vagrant</span> reload</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è®©æˆ‘ä»¬ä¸ºvagrantå®ä¾‹æ·»åŠ SSH,å¹¶é’ˆå¯¹Androidè¿›è¡Œæ„å»ºã€‚</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>vagrant ssh</span><br><span class="line">vagrant<span class="variable">@ionic</span>-<span class="symbol">android:</span>~<span class="variable">$ </span>cd trendicity/</span><br><span class="line">vagrant<span class="variable">@ionic</span>-<span class="symbol">android:</span>~<span class="regexp">/trendicity$ ionic platform android</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†ä½ çš„Androidè®¾å¤‡é€šè¿‡USBè¿æ¥åˆ°ä½ çš„ç”µè„‘ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç¡®è®¤ä½ çš„è®¾å¤‡å·²ç»è¿æ¥ä¸Šã€‚</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vagrant@ionic-android:~<span class="regexp">/trendicity$ sudo /</span>home<span class="regexp">/vagrant/</span>android-sdk-linux<span class="regexp">/platform-tools/</span>adb devices</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¡®è®¤ä½ çš„è®¾å¤‡å·²ç»è¿æ¥ä¸Šï¼Œç„¶åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤åœ¨ä½ è®¾å¤‡ä¸Šå¯åŠ¨åº”ç”¨ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="code"><pre><span class="line">vagrant<span class="symbol">@ionic</span>-android:~/trendicity$ ionic <span class="built_in">run</span> android</span><br></pre></td></tr></table></figure>

<p>å½“ä½ çœ‹åˆ°ä¸‹é¢çš„ä¿¡æ¯ï¼Œå°±è¯æ˜ä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸäº†ï¼š</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">Installing</span></span> app on device ...</span><br><span class="line"><span class="function"><span class="title">Lanuching</span></span> application ...</span><br><span class="line">LAUNCH SUCCESS  </span><br></pre></td></tr></table></figure>

<p>æ­å–œï¼ä½ å·²ç»æˆåŠŸåœ¨androidè®¾å¤‡ä¸Šè¿è¡Œäº†ä½ çš„åº”ç”¨ã€‚</p>
<p>ä¸Šé¢çœ‹ä¸Šå»åœ¨ä½ çš„è®¾å¤‡ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºæ˜¯å¾ˆå¤šéº»çƒ¦ï¼ŒåŒæ—¶å®ƒè¯æ˜äº†android sdkå®‰è£…æ˜¯å¤šä¹ˆçš„å›°éš¾ï¼Œä»¥åŠionicå›¢é˜Ÿå¦‚ä½•ä½¿å®ƒäº›å›°éš¾å˜çš„ç®€å•æ˜“ç”¨ã€‚</p>
<p>##æ·»åŠ æ’ä»¶</p>
<p>Ionicå’ŒCordovaæ˜¯éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œä½†æ˜¯ä¸ºäº†æé«˜æ€§èƒ½å’Œæœ€å°åŒ–ä½ çš„å°±åº”ç”¨ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›é»˜è®¤å®‰è£…æ‰€æœ‰ä¸œè¥¿ã€‚ä½ å¯èƒ½æ·»åŠ åˆ«çš„åŠŸèƒ½é€šè¿‡æ·»åŠ æ’ä»¶çš„æ–¹å¼ã€‚è®©æˆ‘ä»¬ç»™å°†è¦ä½¿ç”¨åœ°ç†å®šä½åŠŸèƒ½çš„åº”ç”¨æ·»åŠ åœ°ç†ä½ç½®æ’ä»¶ã€‚</p>
<p>åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ã€‚æ³¨æ„ï¼Œä½ å¯ä»¥åœ¨æœ¬åœ°å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨ionic box çš„å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">$ ionic plugin <span class="keyword">add</span><span class="bash"> org.apache.cordova.geolocation</span></span><br></pre></td></tr></table></figure>

<p>Ionicå°†ä¼šå®‰è£…ä¸€äº›å¿…é¡»çš„ç»„ä»¶ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨åœ°ç†å®šä½åŠŸèƒ½ã€‚ç¨åï¼Œå½“ä½ æ·±å…¥åˆ°æœ¬ä¹¦ä¾‹å­ Trendicityåº”ç”¨ çš„ç»†èŠ‚æ—¶ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåœ°ç†å®šä½æ’ä»¶ã€‚</p>
<p>ä½ ä¹Ÿè¦ä»¥è‡ªåŠ¨åœ¨è¿™é‡Œ<a target="_blank" rel="noopener" href="http://plugins.cordova.io/">plugins.cordova.io/</a>äº†è§£ä¸€ä¸‹åˆ«çš„æ’ä»¶ï¼Œä»¥å¤‡å°†æ¥æ›´å¥½çš„ä½¿ç”¨åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚</p>
<p>##æœ€ä½³æºä»£ç æ§åˆ¶å®è·µ</p>
<p>å› ä¸ºIonicå’ŒCordovaå®‰è£…çš„æ–‡ä»¶å¯¹ä¸åŒçš„å¹³å°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æ²¡æœ‰å¿…è¦åŠ å…¥ç‰ˆæœ¬æ§åˆ¶çš„ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œå“ªäº›ä¸œè¥¿è¦å­˜æ”¾åˆ°æˆ‘ä»¬çš„ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œè¿˜æœ‰å“ªäº›ä¸ç”¨å­˜æ”¾ã€‚</p>
<p>###Gitå’Œæ¨¡ç‰ˆåŒ–åº”ç”¨</p>
<p>å¦‚ä½•ä½ ä½¿ç”¨Git(æœ¬ä¹¦çš„ä½œè€…ä»¬å¼ºçƒˆæ¨èä½¿ç”¨Git),å’Œå¦‚ä½•é€šè¿‡Ionicå‘½ä»¤è¡Œåˆ›å»ºä½ çš„åº”ç”¨ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°å®ƒåˆ›å»ºäº†ä¸€ä¸ª<code>.gitignore</code>æ–‡ä»¶ï¼Œå®ƒé‡Œé¢åŒ…å«ä¸€äº›ä½ ä¸éœ€è¦ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶å¼•ç”¨ã€‚ä½ å¯ä»¥é€‰æ‹©è·³è¿‡æœ¬ç« å‰©ä½™çš„éƒ¨åˆ†è€Œç›´æ¥æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶<code>.gitignore</code>ï¼Œä¸‹é¢æ˜¯å®ƒçš„å†…å®¹ï¼š</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> cat .gitignore </span><br><span class="line"># Specifies intentionally untracked <span class="keyword">files</span> to ignore when <span class="keyword">using</span> Git</span><br><span class="line"># http:<span class="comment">//git-scm.com/docs/gitignore</span></span><br><span class="line"></span><br><span class="line">node_modules/</span><br><span class="line">platforms/</span><br><span class="line">plugins/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>###æ ¹ç›®å½•ä¸‹é¢çš„æ–‡ä»¶</p>
<p>æ ¹ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä½ å°±éƒ½åº”è¯¥åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚å®ƒä»¬åŒ…å«äº†é¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼Œæ²¡æœ‰å®ƒä»¬ï¼Œä½ çš„é¡¹ç›®å°†æ— æ³•æ­£ç¡®ç¼–è¯‘ã€‚</p>
<p>###åŒ…å«çš„ç›®å½•<br><code>./hooks</code>,<code>./scss</code>,å’Œæœ€é‡è¦çš„<code>./www</code> éƒ½åº”è¯¥åŠ å…¥åˆ°ä½ çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<p>###ä¸éœ€è¦åŒ…å«çš„ç›®å½•</p>
<p><code>./node_modules</code>,<code>./platforms</code>, å’Œ <code>./plugins</code> éƒ½ä¸éœ€è¦åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚ä»–ä»¬åŒ…å«äº†è®¸å¤šäºŒè¿›åˆ¶æ–‡ä»¶å’Œä¸€äº›é¢å¤–çš„ç¼–è¯‘æ—¶ç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨éƒ¨ç½²æ—¶éƒ½ä¼šé‡æ–°ç”Ÿæˆã€‚ä¹Ÿéƒ½ä¼šåœ¨ä½ åœ¨æ–°çš„æœºå™¨ä¸Šæ£€å‡ºä»£ç æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚</p>
<p>##æ€»ç»“</p>
<p>ä½ ç°åœ¨å‡†å¤‡å¼€å§‹åˆ›å»ºä½ çš„åº”ç”¨ã€‚ä½ æ‹¥æœ‰äº†åˆ›å»ºä¸€ä¸ªåº”ç”¨éœ€è¦çš„æ‰€æœ‰å·¥å…·ï¼šä½ å¯ä»¥é€šè¿‡æµè§ˆå™¨æˆ–è€…ä»¿çœŸå™¨è¿›è¡Œæµ‹è¯•ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ æ’ä»¶çš„æ–¹å¼å»è®¿é—®ä¸€äº›é«˜çº§çš„åŠŸèƒ½ï¼Œå¹¶å¯ä»¥è®©ä½ çš„åº”ç”¨åœ¨çœŸå®çš„è®¾å¤‡ä¸Šè¿›è¡Œè¿è¡Œã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2015/08/27/ionic%20%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D/" data-id="cl7mgnxtr000ft2zad6npab50" data-title="ç¬¬äºŒç«  ionic å¼€å‘ç¯å¢ƒ å·¥å…·å’Œå·¥ä½œæµç¨‹ä»‹ç»" class="article-share-link">åˆ†äº«</a>
      
      
        <a href="/2015/08/27/ionic%20%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2015/08/27/ionic%20%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%20%E5%B7%A5%E5%85%B7%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BB%8B%E7%BB%8D/" itemprop="commentCount"></span>
          ç•™è¨€
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ionic/" rel="tag">ionic</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">ä¸‹ä¸€é¡µ &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BPMN/">BPMN</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/BPMN/Flow/">Flow</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/BPMN/%E5%85%83%E7%B4%A0/">å…ƒç´ </a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B9%A6%E6%9E%B6/">ä¹¦æ¶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/">æ‰©å±•çŸ¥è¯†</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E8%AF%BB%E4%B9%A6%E5%AD%A6%E4%B9%A0/">è¯»ä¹¦å­¦ä¹ </a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/%E7%AE%97%E6%B3%95/">ç®—æ³•</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/%E8%AF%AD%E8%A8%80/">è¯­è¨€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/">é—®é¢˜æ€»ç»“</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%B9%E6%A1%88/">æ–¹æ¡ˆ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7/">æ—¥å¸¸å·¥å…·</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7/mac/">mac</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF/">è‰ºæœ¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6%E5%AD%A6%E4%B9%A0/">è¯»ä¹¦å­¦ä¹ </a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BPMN/" rel="tag">BPMN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/" rel="tag">CAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flow/" rel="tag">Flow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/" rel="tag">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protobuf/" rel="tag">Protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alfred/" rel="tag">alfred</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm/" rel="tag">arm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/" rel="tag">bug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dubbo/" rel="tag">dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastcgi/" rel="tag">fastcgi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastfs/" rel="tag">fastfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ionic/" rel="tag">ionic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/" rel="tag">jdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk8-java/" rel="tag">jdk8.java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmeter/" rel="tag">jmeter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%91%BD%E4%BB%A4/" rel="tag">linuxå‘½ä»¤</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mp3/" rel="tag">mp3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nocomment/" rel="tag">nocomment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/poi/" rel="tag">poi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/" rel="tag">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsa/" rel="tag">rsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/schedule/" rel="tag">schedule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/" rel="tag">workflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/" rel="tag">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" rel="tag">ä¸€è‡´æ€§ç®—æ³•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E7%94%9F/" rel="tag">äººç”Ÿ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/" rel="tag">äººç”Ÿæ„Ÿæ‚Ÿ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" rel="tag">äººè„¸è¯†åˆ«</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/" rel="tag">ä»£ç ä»“åº“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%81%A5%E5%BA%B7/" rel="tag">å¥åº·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E7%B4%A0/" rel="tag">å…ƒç´ </a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">åˆ†å¸ƒå¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/" rel="tag">åŠ å¯†è§£å¯†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/" rel="tag">å‹åŠ›æµ‹è¯•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/" rel="tag">å›¾ç‰‡å¤„ç†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8/" rel="tag">å­˜å‚¨</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9A%E6%97%B6/" rel="tag">å®šæ—¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">å¹¶å‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%90%E6%82%B2%E9%B8%BF/" rel="tag">å¾æ‚²é¸¿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">æ€§èƒ½æµ‹è¯•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%84%9F%E6%82%9F/" rel="tag">æ„Ÿæ‚Ÿ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">æ’åº</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/" rel="tag">æœåŠ¡æ²»ç†</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9F%A5%E6%89%BE/" rel="tag">æŸ¥æ‰¾</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%81%E7%A8%8B/" rel="tag">æµç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E/" rel="tag">æµç¨‹å¼•æ“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">æµ‹è¯•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E5%B1%B1/" rel="tag">çˆ¬å±±</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%96%91%E6%83%91/" rel="tag">ç–‘æƒ‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">ç®—æ³•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C/" rel="tag">ç»éªŒ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BB%98%E7%94%BB/" rel="tag">ç»˜ç”»</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">ç¼“å­˜</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6/" rel="tag">è½¯ä»¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E5%8A%A8/" rel="tag">è¿åŠ¨</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">è¿ç»´</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9F%B3%E4%B9%90/" rel="tag">éŸ³ä¹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%8D%A2/" rel="tag">éŸ³é¢‘è½¬æ¢</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/BPMN/" style="font-size: 18.33px;">BPMN</a> <a href="/tags/CAP/" style="font-size: 11.67px;">CAP</a> <a href="/tags/Flow/" style="font-size: 18.33px;">Flow</a> <a href="/tags/GIS/" style="font-size: 10px;">GIS</a> <a href="/tags/Protobuf/" style="font-size: 10px;">Protobuf</a> <a href="/tags/alfred/" style="font-size: 10px;">alfred</a> <a href="/tags/angularjs/" style="font-size: 15px;">angularjs</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/arm/" style="font-size: 10px;">arm</a> <a href="/tags/book/" style="font-size: 11.67px;">book</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/fastcgi/" style="font-size: 10px;">fastcgi</a> <a href="/tags/fastfs/" style="font-size: 10px;">fastfs</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/ionic/" style="font-size: 15px;">ionic</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jdk/" style="font-size: 10px;">jdk</a> <a href="/tags/jdk8-java/" style="font-size: 11.67px;">jdk8.java</a> <a href="/tags/jmeter/" style="font-size: 10px;">jmeter</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/linux%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">linuxå‘½ä»¤</a> <a href="/tags/mac/" style="font-size: 11.67px;">mac</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mp3/" style="font-size: 10px;">mp3</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/nocomment/" style="font-size: 10px;">nocomment</a> <a href="/tags/poi/" style="font-size: 10px;">poi</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/redis/" style="font-size: 11.67px;">redis</a> <a href="/tags/rpc/" style="font-size: 10px;">rpc</a> <a href="/tags/rsa/" style="font-size: 10px;">rsa</a> <a href="/tags/schedule/" style="font-size: 10px;">schedule</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" style="font-size: 10px;">ä¸€è‡´æ€§ç®—æ³•</a> <a href="/tags/%E4%BA%BA%E7%94%9F/" style="font-size: 13.33px;">äººç”Ÿ</a> <a href="/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/" style="font-size: 10px;">äººç”Ÿæ„Ÿæ‚Ÿ</a> <a href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" style="font-size: 10px;">äººè„¸è¯†åˆ«</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/" style="font-size: 10px;">ä»£ç ä»“åº“</a> <a href="/tags/%E5%81%A5%E5%BA%B7/" style="font-size: 10px;">å¥åº·</a> <a href="/tags/%E5%85%83%E7%B4%A0/" style="font-size: 16.67px;">å…ƒç´ </a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 16.67px;">åˆ†å¸ƒå¼</a> <a href="/tags/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/" style="font-size: 10px;">åŠ å¯†è§£å¯†</a> <a href="/tags/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">å‹åŠ›æµ‹è¯•</a> <a href="/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/" style="font-size: 11.67px;">å›¾ç‰‡å¤„ç†</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">å¤šçº¿ç¨‹</a> <a href="/tags/%E5%AD%98%E5%82%A8/" style="font-size: 10px;">å­˜å‚¨</a> <a href="/tags/%E5%AE%9A%E6%97%B6/" style="font-size: 10px;">å®šæ—¶</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">å·¥å…·</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">å¹¶å‘</a> <a href="/tags/%E5%BE%90%E6%82%B2%E9%B8%BF/" style="font-size: 10px;">å¾æ‚²é¸¿</a> <a href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">æ€§èƒ½æµ‹è¯•</a> <a href="/tags/%E6%84%9F%E6%82%9F/" style="font-size: 11.67px;">æ„Ÿæ‚Ÿ</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">æ’åº</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/" style="font-size: 11.67px;">æœåŠ¡æ²»ç†</a> <a href="/tags/%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">æŸ¥æ‰¾</a> <a href="/tags/%E6%B5%81%E7%A8%8B/" style="font-size: 18.33px;">æµç¨‹</a> <a href="/tags/%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E/" style="font-size: 18.33px;">æµç¨‹å¼•æ“</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">æµ‹è¯•</a> <a href="/tags/%E7%88%AC%E5%B1%B1/" style="font-size: 10px;">çˆ¬å±±</a> <a href="/tags/%E7%96%91%E6%83%91/" style="font-size: 11.67px;">ç–‘æƒ‘</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 18.33px;">ç®—æ³•</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">ç»éªŒ</a> <a href="/tags/%E7%BB%98%E7%94%BB/" style="font-size: 10px;">ç»˜ç”»</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 11.67px;">ç¼“å­˜</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size: 10px;">è½¯ä»¶</a> <a href="/tags/%E8%BF%90%E5%8A%A8/" style="font-size: 10px;">è¿åŠ¨</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 11.67px;">è¿ç»´</a> <a href="/tags/%E9%9F%B3%E4%B9%90/" style="font-size: 10px;">éŸ³ä¹</a> <a href="/tags/%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%8D%A2/" style="font-size: 10px;">éŸ³é¢‘è½¬æ¢</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">ä¹æœˆ 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">ä¹æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">å››æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">ä¸‰æœˆ 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">åæœˆ 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">ä¹æœˆ 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">ä¸€æœˆ 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">åäºŒæœˆ 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">åä¸€æœˆ 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">åæœˆ 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">ä¹æœˆ 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">å…«æœˆ 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">ä¸€æœˆ 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/11/14/%E6%B5%81%E7%A8%8B-%E6%B4%BB%E5%8A%A8%E8%8A%82%E7%82%B9/">æµç¨‹-æ´»åŠ¨èŠ‚ç‚¹</a>
          </li>
        
          <li>
            <a href="/2022/11/13/%E6%B5%81%E7%A8%8B-%E4%BA%8B%E4%BB%B6/">æµç¨‹-äº‹ä»¶</a>
          </li>
        
          <li>
            <a href="/2022/11/12/%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E%E5%8F%91%E5%B1%95/">æµç¨‹å¼•æ“å‘å±•</a>
          </li>
        
          <li>
            <a href="/2022/11/11/%E6%B5%81%E7%A8%8B-%E7%BD%91%E5%85%B3Gateway/">æµç¨‹-ç½‘å…³Gateway</a>
          </li>
        
          <li>
            <a href="/2022/11/10/BPMN2.0/">BPMN2.0</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 ä¸‡æ¾<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'true' == true;
    var verify = 'true' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "b13h0PpoiVVieODkmdrjUw2R-gzGzoHsz",
        appKey: "NMiO8n8rxtwYIaUdndXwbcKH",
        placeholder: "åœ£å›ï¼Œç»™äº›å»ºè®®",
        pageSize:'10',
        avatar:'mm',
        lang:'zh-cn'
    });
</script>

  </div>
</body>
</html>